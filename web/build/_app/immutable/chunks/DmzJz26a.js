import"./DsnmJJEf.js";import{p as R,h as C,i as I,V as _t,g as t,c as X,r as Y,s as k,t as tt,j as d,a as V,f as B,u as c,n as ot}from"./D0CSSuTl.js";import{a as T,f as U,t as rt,c as pt}from"./Bd1JH_Ov.js";import{i as H}from"./D8NIUdeB.js";import{p as E,a as z,s as N,r as ht}from"./zonMEKN6.js";import{M as ut}from"./B2VKg7zy.js";import{g as mt}from"./CfdSAoAU.js";import{d as bt,s as et}from"./C8vxa4mj.js";import{C as $t}from"./DCmy867i.js";import{D as yt}from"./BCf5NZQ6.js";import{h as Ct,r as G,s as J,bQ as wt,ba as Dt,bn as xt}from"./D-UYCH9y.js";import{b as K,L as nt}from"./DU5vAHPb.js";import{$ as Q}from"./DWQ0JXRY.js";import{d as it,D as at,u as ct}from"./CJGyQpNN.js";import{g as lt,a as Tt,t as kt}from"./ChL-L15l.js";import{W as dt}from"./DUXNbmIP.js";import{h as ft}from"./DLePdI2u.js";import{k as st}from"./BP6NvnZ7.js";import{F as St}from"./BMcevgEe.js";import{F as Mt}from"./BgQCgJ0_.js";import{S as Ot}from"./i7F918yQ.js";import{f as At}from"./CF_nq223.js";import{m as It}from"./BHTYC334.js";import{C as zt}from"./BVcN3VUI.js";var Pt=U('<div><button type="button" class="w-8 text-xl font-bold leading-none" title="Toggle sign"> </button> <input type="number" min="0" class="w-1/3"/> <input type="number" min="0" max="23" class="w-1/3"/> <input type="number" min="0" max="59" class="w-1/3"/></div>');function Ft(S,s){R(s,!0);const h=()=>z(Q,"$t",o),[o,b]=N();let w=E(s,"value",15),$=E(s,"class",3,""),f=ht(s,["$$slots","$$events","$$legacy","value","class"]);function g(r){const u=it.fromObject({minutes:Math.abs(r)}).shiftTo("days","hours","minutes");return{sign:r<0?-1:1,days:u.days===0?null:u.days,hours:u.hours===0?null:u.hours,minutes:u.minutes===0?null:u.minutes}}function n(r,u,Z,W){return r*it.fromObject({days:u??0,hours:Z??0,minutes:W??0}).shiftTo("minutes").minutes}const i=g(w());let l=C(I(i.sign)),a=C(I(i.days)),m=C(I(i.hours)),D=C(I(i.minutes));_t(()=>{w(n(t(l),t(a),t(m),t(D)))});function x(){d(l,-t(l))}var e=Pt();Ct(e,()=>({class:`flex gap-2 ${$()}`,...f}));var v=X(e);v.__click=x;var P=X(v,!0);Y(v);var F=k(v,2);G(F);var M=k(F,2);G(M);var A=k(M,2);G(A),Y(e),tt((r,u,Z)=>{et(P,t(l)>=0?"+":"-"),J(F,"placeholder",r),J(M,"placeholder",u),J(A,"placeholder",Z)},[()=>h()("days"),()=>h()("hours"),()=>h()("minutes")]),K(F,()=>t(a),r=>d(a,r)),K(M,()=>t(m),r=>d(m,r)),K(A,()=>t(D),r=>d(D,r)),T(S,e),V(),b()}bt(["click"]);var Zt=U("<!> <!>",1),Lt=U("<!> <!>",1),jt=U('<!> <!> <div class="w-full"><!></div>',1);function Bt(S,s){R(s,!0);const h=()=>z(ct,"$user",b),o=()=>z(Q,"$t",b),[b,w]=N();let $=E(s,"initialDate",19,()=>at.now()),f=C(!1),g=C(0),n=C(I($().toFormat("yyyy-MM-dd'T'HH:mm:ss.SSS")));const i=c(()=>Tt(t(n)));let l=C(I(lt($(),s.initialTimeZone,t(i)))),a=c(()=>lt($(),s.initialTimeZone,t(i),t(l)));const m=async()=>{const x=dt(s.assets,h());try{if(t(f)&&(t(g)||t(a))){await st({assetBulkUpdateDto:{ids:x,dateTimeRelative:t(g),timeZone:t(a)?.value}}),s.onClose(!0);return}const e=kt(t(n),t(a));await st({assetBulkUpdateDto:{ids:x,dateTimeOriginal:e}}),s.onClose(!0)}catch(e){ft(e,o()("errors.unable_to_change_date")),s.onClose(!1)}},D=c(()=>at.fromISO(t(n),{zone:t(a)?.value,setZone:!0}));{let x=c(()=>o()("edit_date_and_time")),e=c(()=>o()("confirm")),v=c(()=>!t(D).isValid);St(S,{get title(){return t(x)},get icon(){return wt},onClose:()=>s.onClose(!1),onSubmit:m,get submitText(){return t(e)},get disabled(){return t(v)},size:"small",children:(P,F)=>{var M=jt(),A=B(M);{let _=c(()=>o()("edit_date_and_time_by_offset"));Mt(A,{get label(){return t(_)},children:(y,p)=>{Ot(y,{"data-testid":"edit-by-offset-switch",class:"mb-2",get checked(){return t(f)},set checked(L){d(f,L,!0)}})},$$slots:{default:!0}})}var r=k(A,2);{var u=_=>{var y=Zt(),p=B(y);nt(p,{for:"relativedatetime",class:"block mb-1",children:(O,vt)=>{ot();var j=rt();tt(q=>et(j,q),[()=>o()("offset")]),T(O,j)},$$slots:{default:!0}});var L=k(p,2);Ft(L,{class:"immich-form-input w-full text-gray-700 mb-2",id:"relativedatetime",get value(){return t(g)},set value(O){d(g,O,!0)}}),T(_,y)},Z=_=>{var y=Lt(),p=B(y);nt(p,{for:"datetime",class:"block mb-1",children:(O,vt)=>{ot();var j=rt();tt(q=>et(j,q),[()=>o()("date_and_time")]),T(O,j)},$$slots:{default:!0}});var L=k(p,2);yt(L,{class:"immich-form-input w-full mb-2",id:"datetime",type:"datetime-local",get value(){return t(n)},set value(O){d(n,O,!0)}}),T(_,y)};H(r,_=>{t(f)?_(u):_(Z,!1)})}var W=k(r,2),gt=X(W);{let _=c(()=>o()("timezone")),y=c(()=>o()("search_timezone"));$t(gt,{get label(){return t(_)},get options(){return t(i)},get placeholder(){return t(y)},onSelect:p=>d(l,p,!0),get selectedOption(){return t(a)},set selectedOption(p){d(a,p)}})}Y(W),T(P,M)},$$slots:{default:!0}})}V(),w()}function ce(S,s){R(s,!0);const h=()=>z(Q,"$t",o),[o,b]=N();let w=E(s,"menuItem",3,!1);const{clearSelect:$,getOwnedAssets:f}=mt(),g=async()=>{const a=f(),m=a.length===1?At(a[0].localDateTime):at.now();await It.show(Bt,{initialDate:m,assets:a})&&$()};var n=pt(),i=B(n);{var l=a=>{{let m=c(()=>h()("change_date"));ut(a,{get text(){return t(m)},get icon(){return Dt},onClick:g})}};H(i,a=>{w()&&a(l)})}T(S,n),V(),b()}var Et=U("<!> <!>",1);function de(S,s){R(s,!0);const h=()=>z(ct,"$user",b),o=()=>z(Q,"$t",b),[b,w]=N();let $=E(s,"menuItem",3,!1);const{clearSelect:f,getOwnedAssets:g}=mt();let n=C(!1);async function i(e){if(d(n,!1),!e)return;const v=dt(g(),h());try{await st({assetBulkUpdateDto:{ids:v,latitude:e.lat,longitude:e.lng}}),f()}catch(P){ft(P,o()("errors.unable_to_update_location"))}}var l=Et(),a=B(l);{var m=e=>{{let v=c(()=>o()("change_location"));ut(e,{get text(){return t(v)},get icon(){return xt},onClick:()=>d(n,!0)})}};H(a,e=>{$()&&e(m)})}var D=k(a,2);{var x=e=>{zt(e,{onClose:i})};H(D,e=>{t(n)&&e(x)})}T(S,l),V(),w()}export{ce as C,de as a};
