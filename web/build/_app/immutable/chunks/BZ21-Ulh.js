import{P as B}from"./0qPXRVhz.js";import{h as d,i as x,g as r,j as l,d as A}from"./D0CSSuTl.js";import{H as N,I as H,J as j,K as Q,L as W,g as m,M as G}from"./DUXNbmIP.js";import{B as q,e as v}from"./BpCm29KX.js";import{P as K}from"./IOA7-Wrn.js";import{a as S}from"./DxRnQWdm.js";import{S as X}from"./5Inb98wy.js";import{p as Y,u as I}from"./CJGyQpNN.js";import{o as $}from"./WQ1yKytR.js";import{t as g,h as p}from"./DLePdI2u.js";import{g as y}from"./DWQ0JXRY.js";import{a5 as ee,aA as oe,aB as te,aC as ie,aD as ae,aE as se,b as ne,aF as re,aG as le,aH as ce,aI as de,ai as me,az as he,ab as fe,A as ue,aJ as ge,au as pe}from"./D-UYCH9y.js";import{h as ye,O as Pe,P as we,A as n,Q as M,n as Ae,b as ve,R as D}from"./BP6NvnZ7.js";import{m as Se}from"./BHTYC334.js";const _=new K("asset-viewer-state",!1);class Ie extends q{#e=d(x({currentRotation:0,currentZoom:1,enable:!0,currentPositionX:0,currentPositionY:0}));#o=d();get imgRef(){return r(this.#o)}set imgRef(e){l(this.#o,e,!0)}#t=d(!1);get isShowActivityPanel(){return r(this.#t)}set isShowActivityPanel(e){l(this.#t,e,!0)}#i=d(!1);get isPlayingMotionPhoto(){return r(this.#i)}set isPlayingMotionPhoto(e){l(this.#i,e,!0)}#a=d(!1);get isShowEditor(){return r(this.#a)}set isShowEditor(e){l(this.#a,e,!0)}get isShowDetailPanel(){return _.current}get zoomState(){return r(this.#e)}set zoomState(e){l(this.#e,e,!0),this.emit("ZoomChange",e)}get zoom(){return r(this.#e).currentZoom}set zoom(e){this.zoomState={...this.zoomState,currentZoom:e}}canZoomIn(){return this.hasListeners("Zoom")&&this.zoom<=1}canZoomOut(){return this.hasListeners("Zoom")&&this.zoom>1}canCopyImage(){return N()&&!!i.imgRef}set isShowDetailPanel(e){_.current=e}onZoomChange(e){l(this.#e,e,!0)}toggleActivityPanel(){this.closeDetailPanel(),this.isShowActivityPanel=!this.isShowActivityPanel}closeActivityPanel(){this.isShowActivityPanel=!1}toggleDetailPanel(){this.closeActivityPanel(),this.isShowDetailPanel=!this.isShowDetailPanel}closeDetailPanel(){this.isShowDetailPanel=!1}openEditor(){this.closeActivityPanel(),this.isShowEditor=!0}closeEditor(){this.isShowEditor=!1}}const i=new Ie,Ue=(o,e)=>{const t=G(),s=A(I),c=!!(s&&s.id===e.ownerId),h={title:o("share"),icon:pe,type:o("assets"),$if:()=>!!(A(I)&&!e.isTrashed&&e.visibility!==Ae.Locked),onAction:()=>Se.show(X,{assetIds:[e.id]})},a={title:o("download"),icon:ee,shortcuts:{key:"d",shift:!0},type:o("assets"),$if:()=>!!s,onAction:()=>b(e,{edited:!0})},f={title:o("download_original"),icon:ge,type:o("assets"),$if:()=>!!s&&e.isEdited,onAction:()=>b(e,{edited:!1})},P={...a,$if:()=>!s&&t&&t.allowDownload},w={title:o("play_motion_photo"),icon:de,type:o("assets"),$if:()=>!!e.livePhotoVideoId&&!i.isPlayingMotionPhoto,onAction:()=>{i.isPlayingMotionPhoto=!0}},R={title:o("stop_motion_photo"),icon:ce,type:o("assets"),$if:()=>!!e.livePhotoVideoId&&i.isPlayingMotionPhoto,onAction:()=>{i.isPlayingMotionPhoto=!1}},O={title:o("to_favorite"),icon:he,type:o("assets"),$if:()=>c&&!e.isFavorite,onAction:()=>Me(e),shortcuts:[{key:"f"}]},C={title:o("unfavorite"),icon:me,type:o("assets"),$if:()=>c&&e.isFavorite,onAction:()=>_e(e),shortcuts:[{key:"f"}]},E={title:o("asset_offline"),icon:ue,type:o("assets"),color:"danger",$if:()=>!!e.isOffline,onAction:()=>i.toggleDetailPanel()},F={title:o("zoom_image"),icon:le,$if:()=>i.canZoomIn(),onAction:()=>i.emit("Zoom")},z={title:o("zoom_image"),icon:re,$if:()=>i.canZoomOut(),onAction:()=>i.emit("Zoom")},V={title:o("copy_image"),icon:ne,$if:()=>i.canCopyImage(),onAction:()=>i.emit("Copy")},Z={title:o("info"),icon:fe,type:o("assets"),$if:()=>e.hasMetadata,onAction:()=>i.toggleDetailPanel(),shortcuts:[{key:"i"}]},L={title:o("editor"),icon:se,$if:()=>!t&&c&&e.type===M.Image&&!e.livePhotoVideoId&&e.exifInfo?.projectionType!==B.EQUIRECTANGULAR&&!e.originalPath.toLowerCase().endsWith(".insp")&&!e.originalPath.toLowerCase().endsWith(".gif")&&!e.originalPath.toLowerCase().endsWith(".svg"),onAction:()=>i.openEditor()},T={title:m(o,n.RefreshFaces),icon:ae,onAction:()=>u({name:n.RefreshFaces,assetIds:[e.id]})},J={title:m(o,n.RefreshMetadata),icon:ie,onAction:()=>u({name:n.RefreshMetadata,assetIds:[e.id]})},k={title:m(o,n.RegenerateThumbnail),icon:te,onAction:()=>u({name:n.RegenerateThumbnail,assetIds:[e.id]})},U={title:m(o,n.TranscodeVideo),icon:oe,onAction:()=>u({name:n.TranscodeVideo,assetIds:[e.id]}),$if:()=>e.type===M.Video};return{Share:h,Download:a,DownloadOriginal:f,SharedLinkDownload:P,Offline:E,Info:Z,Favorite:O,Unfavorite:C,PlayMotionPhoto:w,StopMotionPhoto:R,ZoomIn:F,ZoomOut:z,Copy:V,Edit:L,RefreshFacesJob:T,RefreshMetadataJob:J,RegenerateThumbnailJob:k,TranscodeVideoJob:U}},b=async(o,{edited:e})=>{const t=await y(),s=[{filename:o.originalFileName,id:o.id,size:o.exifInfo?.fileSizeInByte||0}],c=a=>a.originalPath.includes("encoded-video");if(o.livePhotoVideoId){const a=await ye({...S.params,id:o.livePhotoVideoId});(!c(a)||A(Y)?.download.includeEmbeddedVideos)&&s.push({filename:a.originalFileName,id:o.livePhotoVideoId,size:a.exifInfo?.fileSizeInByte||0})}const h=H(S.params);for(const[a,{filename:f,id:P}]of s.entries()){a!==0&&await j(500);try{g.success(t("downloading_asset_filename",{values:{filename:o.originalFileName}})),Q(W()+`/assets/${P}/original`+(h?`?${h}&edited=${e}`:`?edited=${e}`),f)}catch(w){p(w,t("errors.error_downloading",{values:{filename:f}}))}}},Me=async o=>{const e=await y();try{const t=await D({id:o.id,updateAssetDto:{isFavorite:!0}});g.success(e("added_to_favorites")),v.emit("AssetUpdate",t)}catch(t){p(t,e("errors.unable_to_add_remove_favorites",{values:{favorite:o.isFavorite}}))}},_e=async o=>{const e=await y();try{const t=await D({id:o.id,updateAssetDto:{isFavorite:!1}});g.success(e("removed_from_favorites")),v.emit("AssetUpdate",t)}catch(t){p(t,e("errors.unable_to_add_remove_favorites",{values:{favorite:o.isFavorite}}))}},Be=async o=>{const[e]=await $({multiple:!1});await Pe({assetCopyDto:{sourceId:o,targetId:e}}),await we({assetBulkDeleteDto:{ids:[o],force:!0}}),v.emit("AssetReplace",{oldAssetId:o,newAssetId:e})},u=async o=>{const e=await y();try{await ve({assetJobsDto:o}),g.success(m(e,o.name))}catch(t){p(t,e("errors.unable_to_submit_job"))}};export{i as a,Be as b,Ue as g,b as h};
