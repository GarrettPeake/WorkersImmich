import"./DsnmJJEf.js";import{p as jt,i as qt,j as r,f as K,t as G,g as e,a as Gt,h as P,ae as Nt,u as S,s as T,c as x,n as Qt,r as _,a1 as Ut,d as Jt}from"./D0CSSuTl.js";import{d as Kt,o as Wt,e as ht,s as W}from"./C8vxa4mj.js";import{i as z}from"./D8NIUdeB.js";import{e as Xt}from"./DLePdI2u.js";import{t as Yt,a as L,f as B,c as Zt}from"./Bd1JH_Ov.js";import{F as te,a as mt,u as ee,r as oe,I as re,w as ae,s as u,q as X,f as se,ac as ie,G as ne,a0 as le}from"./D-UYCH9y.js";import{a as N}from"./IOA7-Wrn.js";import{p as g,c as gt,s as ce,a as de}from"./zonMEKN6.js";import{s as bt}from"./BVZhy_zG.js";import{g as ue}from"./DcdhlkRn.js";import{$ as wt}from"./DWQ0JXRY.js";import{L as fe}from"./DU5vAHPb.js";function ve(f,a={}){const{onFocusOut:$}=a,M=I=>{$&&(!I.relatedTarget||I.relatedTarget instanceof Node&&!f.contains(I.relatedTarget))&&$(I)};return f.addEventListener("focusout",M),{destroy(){f.removeEventListener("focusout",M)}}}const pe=f=>f.map(a=>a===""?{label:Jt(wt)("unknown"),value:""}:{label:a,value:a}),Fe=f=>f===void 0?void 0:pe([f])[0];var he=B('<div class="absolute inset-y-0 start-0 flex items-center ps-3"><div class="dark:text-immich-dark-fg/75"><!></div></div>'),me=B('<li role="option" class="text-start w-full px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 cursor-default aria-selected:bg-gray-200 aria-selected:dark:bg-gray-700"> </li>'),ge=B('<li class="text-start w-full px-4 py-2 hover:bg-gray-200 dark:hover:bg-gray-700 transition-all cursor-pointer aria-selected:bg-gray-200 aria-selected:dark:bg-gray-700 wrap-break-words" role="option"> </li>'),be=B("<!> <!>",1),we=B('<!> <div class="relative w-full dark:text-gray-300 text-gray-700 text-base"><div><!> <input aria-autocomplete="list" autocomplete="off" role="combobox" type="text"/> <div><!></div></div> <ul role="listbox" tabindex="-1"><!></ul></div>',1);function De(f,a){jt(a,!0);const $=()=>de(wt,"$t",M),[M,I]=ce();let xt=g(a,"hideLabel",3,!1),_t=g(a,"disabled",3,!1),yt=g(a,"options",19,()=>[]),h=g(a,"selectedOption",15),kt=g(a,"placeholder",3,""),Y=g(a,"allowCreate",3,!1),Lt=g(a,"defaultFirstOption",3,!1),Z=g(a,"onSelect",3,()=>{}),It=g(a,"forceFocus",3,!1),tt=ue(),v=P(!1),H=P(!1),c=S(()=>h()?.label||""),s=P(void 0),R=qt([]),y=P(void 0),j=P(void 0);const et=`combobox-${tt}`,V=`listbox-${tt}`,ot=15,Ot=225,rt=new IntersectionObserver(t=>{t[0].intersectionRatio<1&&r(v,!1)},{threshold:.5});Wt(()=>{if(!e(y))return;rt.observe(e(y));const t=e(y)?.closest(".overflow-y-auto, .overflow-y-scroll");return t?.addEventListener("scroll",k,{passive:!0}),window.visualViewport?.addEventListener("resize",k,{passive:!0}),window.visualViewport?.addEventListener("scroll",k,{passive:!0}),()=>{rt.disconnect(),t?.removeEventListener("scroll",k),window.visualViewport?.removeEventListener("resize",k),window.visualViewport?.removeEventListener("scroll",k)}});const Ct=t=>{It()&&t.focus()},Et=()=>{r(H,!0),r(c,""),F()},St=()=>{r(c,h()?h().label:""),r(H,!1),O()},F=()=>{r(v,!0),r(j,nt(),!0)},O=()=>{r(v,!1),r(s,void 0)},at=async t=>{e(b).length===0?r(s,0):e(s)===void 0?r(s,t===1?0:e(b).length-1,!0):r(s,(e(s)+t+e(b).length)%e(b).length),await Ut(),R[e(s)]?.scrollIntoView({block:"nearest"})},$t=t=>{F(),r(c,t.currentTarget.value),r(s,Lt()?0:void 0,!0),R[0]?.scrollIntoView({block:"nearest"})};let st=t=>{h(t),r(c,t.label),Z()(t),O()};const Ht=()=>{e(y)?.focus(),r(s,void 0),h(void 0),r(c,""),Z()(h())},Vt=t=>{const o=window.visualViewport;if(!t)return;const n=t.left+(o?.offsetLeft||0),l=o?.offsetTop||0;if(e(C)==="top")return{bottom:`${window.innerHeight-t.top-l}px`,left:`${n}px`,width:`${t.width}px`,maxHeight:it(t.top-ot)};const d=(o?.height||0)-t.bottom;return{top:`${t.bottom+l}px`,left:`${n}px`,width:`${t.width}px`,maxHeight:it(d-ot)}},it=t=>`min(${t}px,18rem)`,k=()=>{e(v)&&r(j,nt(),!0)},Ft=(t,o)=>{if(!t)return"bottom";const n=o?.height||0,l=n-t.bottom,w=t.top,d=n&&Math.floor(n)!==Math.floor(window.innerHeight);return l<=Ot&&w>l&&!d?"top":"bottom"},nt=()=>e(y)?.getBoundingClientRect();let b=S(()=>{const t=yt().filter(o=>o.label.toLowerCase().includes(e(c).toLowerCase()));return Y()&&e(c)!==""&&t.filter(o=>o.label===e(c)).length===0&&t.unshift({label:e(c),value:e(c)}),t}),D=S(()=>Vt(e(j))),C=S(()=>Ft(e(j),visualViewport));var lt=we();ht("resize",Nt,k);var ct=K(lt);{let t=S(()=>xt()?"sr-only":"");fe(ct,{get class(){return`block mb-1 ${e(t)??""} text-xs text-neutral-500 font-light`},get for(){return et},children:(o,n)=>{Qt();var l=Yt();G(()=>W(l,a.label)),L(o,l)},$$slots:{default:!0}})}var q=T(ct,2),Q=x(q),dt=x(Q);{var Dt=t=>{var o=he(),n=x(o),l=x(n);mt(l,{get icon(){return ee},"aria-hidden":!0}),_(n),_(o),L(t,o)};z(dt,t=>{e(H)&&t(Dt)})}var i=T(dt,2);oe(i);let ut;i.__input=$t,gt(i,t=>r(y,t),()=>e(y)),N(i,t=>Ct?.(t)),N(i,(t,o)=>bt?.(t,o),()=>[{shortcut:{key:"ArrowUp"},onShortcut:()=>{F(),at(-1)}},{shortcut:{key:"ArrowDown"},onShortcut:()=>{F(),at(1)}},{shortcut:{key:"ArrowDown",alt:!0},onShortcut:()=>{F()}},{shortcut:{key:"Enter"},onShortcut:()=>{e(s)!==void 0&&e(b).length>0&&st(e(b)[e(s)]),O()}},{shortcut:{key:"Escape"},onShortcut:t=>{t.stopPropagation(),O()}}]);var U=T(i,2);let ft;var At=x(U);{var Pt=t=>{{let o=S(()=>$()("clear_value"));re(t,{shape:"round",color:"secondary",variant:"ghost",onclick:Ht,get"aria-label"(){return e(o)},get icon(){return ae},size:"small"})}},Tt=t=>{var o=Zt(),n=K(o);{var l=w=>{mt(w,{get icon(){return le},"aria-hidden":!0})};z(n,w=>{e(v)||w(l)},!0)}L(t,o)};z(At,t=>{h()?t(Pt):t(Tt,!1)})}_(U),_(Q);var E=T(Q,2);let vt,pt;var zt=x(E);{var Bt=t=>{var o=be(),n=K(o);{var l=d=>{var p=me();u(p,"aria-disabled",!0),p.__click=O;var A=x(p,!0);_(p),G(m=>{u(p,"aria-selected",e(s)===0),u(p,"id",`${V}-0`),W(A,m)},[()=>Y()?e(c):$()("no_results")]),L(d,p)};z(n,d=>{e(b).length===0&&d(l)})}var w=T(n,2);Xt(w,19,()=>e(b),d=>d.id||d.label,(d,p,A)=>{var m=ge();m.__click=()=>st(e(p));var Mt=x(m,!0);_(m),gt(m,(J,Rt)=>R[Rt]=J,J=>R?.[J],()=>[e(A)]),G(()=>{u(m,"aria-selected",e(A)===e(s)),u(m,"id",`${V}-${e(A)}`),W(Mt,e(p).label)}),L(d,m)}),L(t,o)};z(zt,t=>{e(v)&&t(Bt)})}_(E),_(q),N(q,(t,o)=>ve?.(t,o),()=>({onFocusOut:St})),N(q,(t,o)=>bt?.(t,o),()=>[{shortcut:{key:"Escape"},onShortcut:t=>{t.stopPropagation(),O()}}]),G(()=>{u(i,"placeholder",kt()),i.disabled=_t(),u(i,"aria-activedescendant",e(s)||e(s)===0?`${V}-${e(s)}`:""),u(i,"aria-controls",V),u(i,"aria-expanded",e(v)),ut=X(i,1,"immich-form-input text-sm w-full pe-12! transition-all",null,ut,{"!ps-8":e(H),"!rounded-b-none":e(v)&&e(C)==="bottom","!rounded-t-none":e(v)&&e(C)==="top","cursor-pointer":!e(H)}),u(i,"id",et),se(i,e(c)),ft=X(U,1,"absolute end-0 top-0 h-full flex px-4 justify-center items-center content-between",null,ft,{"pe-2":h(),"pointer-events-none":!h()}),u(E,"id",V),vt=X(E,1,"fixed z-1 text-start text-sm w-full overflow-y-auto bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-900",null,vt,{"rounded-b-xl":e(C)==="bottom","rounded-t-xl":e(C)==="top",shadow:e(C)==="bottom",border:e(v)}),pt=ie(E,"",pt,{top:e(D)?.top,bottom:e(D)?.bottom,left:e(D)?.left,width:e(D)?.width,"max-height":e(D)?.maxHeight})}),ht("focus",i,Et),te(1,E,()=>ne,()=>({duration:250})),L(f,lt),Gt(),I()}Kt(["input","click"]);export{De as C,pe as a,Fe as b,ve as f};
