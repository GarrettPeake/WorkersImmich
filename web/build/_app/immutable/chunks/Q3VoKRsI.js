import"./DsnmJJEf.js";import{s as D,d as Le,e as Be,o as Ye}from"./C8vxa4mj.js";import{d as He,p as he,f as Q,c as i,r as l,s as E,t as P,a as ye,g as e,V as Oe,u as W,h as ae,j as O,i as Ce,e as Je,n as ve,aQ as Pe}from"./D0CSSuTl.js";import{i as T}from"./D8NIUdeB.js";import{e as Ne,i as De}from"./DLePdI2u.js";import{a as o,f as A,c as ne,t as me}from"./Bd1JH_Ov.js";import{a as pe}from"./IOA7-Wrn.js";import{q as fe,p as Te,s as ie,a as be,aY as ze,ag as Xe,r as Ze,B as et,co as tt,T as Ee}from"./D-UYCH9y.js";import{b as at}from"./DU5vAHPb.js";import{a as _e,s as Ie,p as ue}from"./zonMEKN6.js";import{i as st}from"./DFvk55M8.js";import{i as rt}from"./B9MV_P2E.js";import{n as ge}from"./CS-10t6W.js";import{$ as xe}from"./DWQ0JXRY.js";import{y as lt,D as nt}from"./DUXNbmIP.js";import{a2 as ot,N as it}from"./BP6NvnZ7.js";import{m as ut}from"./DW5CvR3c.js";import{M as ct,a as dt,b as vt}from"./BHTYC334.js";const Ue={block:"center",behavior:"smooth"};var K=(b=>(b.SECTION="section",b.MESSAGE="message",b.NEW_ALBUM="newAlbum",b.ALBUM_ITEM="albumItem",b))(K||{});const mt=b=>b==="newAlbum"||b==="albumItem",oe=He(xe);class ft{shared;sortBy;orderBy;constructor(a,x,c){this.shared=a,this.sortBy=x,this.orderBy=c}toModalRows(a,x,c,S,L){const v=!this.shared&&a.length===0?x:[],_=[{type:"newAlbum",selected:S===0}],g=rt(a.length>0&&c.length>0?c.filter(m=>ge(m.albumName).includes(ge(a))):c,{sortBy:this.sortBy,orderBy:this.orderBy});if(g.length>0){if(v.length>0){_.push({type:"section",text:oe("recent").toUpperCase()});const r=1;for(const[d,h]of x.entries())_.push({type:"albumItem",selected:S===d+r,multiSelected:L.includes(h.id),album:h})}this.shared||_.push({type:"section",text:(a.length===0?oe("all_albums"):oe("albums")).toUpperCase()});const m=1+v.length;for(const[r,d]of g.entries())_.push({type:"albumItem",selected:S===r+m,multiSelected:L.includes(d.id),album:d})}else c.length>0?_.push({type:"message",text:oe("no_albums_with_name_yet")}):_.push({type:"message",text:oe("no_albums_yet")});return _}}var pt=A("<span> </span>"),bt=A("<span> </span> <!>",1);function _t(b,a){he(a,!0);const x=()=>_e(xe,"$t",c),[c,S]=Ie();var L=bt(),v=Q(L),_=i(v,!0);l(v);var g=E(v,2);{var m=r=>{var d=pt(),h=i(d);l(d),P(U=>D(h,`â€¢ ${U??""}`),[()=>x()("shared")]),o(r,d)};T(g,r=>{a.album.shared&&r(m)})}P(r=>D(_,r),[()=>x()("items_count",{values:{count:a.album.assetCount}})]),o(b,L),ye(),S()}var gt=A('<img data-testid="album-image" draggable="false"/>'),ht=A('<div class="rounded-full"><!></div>'),yt=A('<button type="button" class="absolute right-0 top-4 p-3 focus:outline-none hover:cursor-pointer" role="checkbox"><!></button>'),xt=A('<div role="group"><button type="button"><span class="h-16 w-16 shrink-0 rounded-xl bg-slate-300"><!></span> <span class="flex h-full flex-col items-start justify-center overflow-hidden"><span class="w-full shrink overflow-hidden text-ellipsis whitespace-nowrap"> <b> </b> </span> <span class="flex gap-1 text-sm"><!></span></span></button> <!></div>');function wt(b,a){he(a,!0);let x=ue(a,"searchQuery",3,""),c=ue(a,"selected",3,!1),S=ue(a,"multiSelected",3,!1);const L=t=>{Oe(()=>{c()&&t.scrollIntoView(Ue)})},v=W(()=>{let{albumName:t}=a.album,n=ge(t).indexOf(ge(x())),C=x().length;return[t.slice(0,n),t.slice(n,n+C),t.slice(n+C)]}),_=t=>{t?.stopPropagation(),t?.preventDefault(),a.onMultiSelect()};let g=W(()=>ut.pointerCoarse),m=ae(!1);const r=()=>{e(g)||O(m,!0)},d=()=>{O(m,!1)};let h=null;const U=t=>t.preventDefault(),z=[],$=()=>{if(h){clearTimeout(h),h=null;for(const t of z)t();z.length=0}};function M(t,{onLongPress:n}){let C=!1;const R=()=>{C=!1,h=setTimeout(()=>{n(),t.addEventListener("contextmenu",U,{once:!0}),z.push(()=>t.removeEventListener("contextmenu",U)),C=!0},350)},f=p=>{C&&(p.stopPropagation(),p.preventDefault())};return t.addEventListener("click",f),t.addEventListener("pointerdown",R,!0),t.addEventListener("pointerup",$,{capture:!0,passive:!0}),{destroy:()=>{t.removeEventListener("click",f),t.removeEventListener("pointerdown",R,!0),t.removeEventListener("pointerup",$,!0)}}}var N=xt(),I=i(N);I.__click=function(...t){a.onAlbumClick?.apply(this,t)};let se;var re=i(I),we=i(re);{var s=t=>{var n=gt();fe(n,1,Te(["h-full w-full rounded-xl object-cover transition-all duration-300 hover:shadow-lg"])),P(C=>{ie(n,"src",C),ie(n,"alt",a.album.albumName)},[()=>lt({id:a.album.albumThumbnailAssetId})]),o(t,n)};T(we,t=>{a.album.albumThumbnailAssetId&&t(s)})}l(re);var y=E(re,2),G=i(y),q=i(G,!0),Y=E(q),ke=i(Y,!0);l(Y);var le=E(Y,1,!0);l(G);var ce=E(G,2),V=i(ce);_t(V,{get album(){return a.album}}),l(ce),l(y),l(I),pe(I,t=>L?.(t)),pe(I,(t,n)=>M?.(t,n),()=>({onLongPress:()=>_()}));var j=E(I,2);{var F=t=>{var n=yt();n.__click=_,ie(n,"tabindex",-1);var C=i(n);{var R=p=>{var w=ht(),k=i(w);be(k,{get icon(){return ze},size:"24",class:"text-primary"}),l(w),o(p,w)},f=p=>{be(p,{get icon(){return ze},size:"24",class:"text-gray-300 hover:text-primary/75"})};T(C,p=>{S()?p(R):p(f,!1)})}l(n),P(()=>ie(n,"aria-checked",c())),o(t,n)};T(j,t=>{(e(m)||S())&&t(F)})}l(N),P(()=>{fe(N,1,Te(["relative flex w-full text-start justify-between transition-colors hover:bg-gray-200 dark:hover:bg-gray-700 rounded-xl my-2 hover:cursor-pointer",{"bg-primary/10 hover:bg-primary/10":S()}])),se=fe(I,1,"flex w-full gap-4 px-2 py-2 text-start",null,se,{"bg-gray-200":c(),"dark:bg-gray-700":c()}),D(q,e(v)[0]),D(ke,e(v)[1]),D(le,e(v)[2])}),Be("mouseenter",N,r),Be("mouseleave",N,d),o(b,N),ye()}Le(["click"]);var kt=A("<b> </b>"),At=A('<button type="button"><div class="flex h-12 w-12 items-center justify-center"><!></div> <p> <!></p></button>');function St(b,a){he(a,!0);const x=()=>_e(xe,"$t",c),[c,S]=Ie();let L=ue(a,"searchQuery",3,""),v=ue(a,"selected",3,!1);const _=M=>{Oe(()=>{v()&&M.scrollIntoView(Ue)})};var g=At();g.__click=()=>a.onNewAlbum(L());let m;var r=i(g),d=i(r);be(d,{get icon(){return Xe},size:"30"}),l(r);var h=E(r,2),U=i(h),z=E(U);{var $=M=>{var N=kt(),I=i(N,!0);l(N),P(()=>D(I,L())),o(M,N)};T(z,M=>{L().length>0&&M($)})}l(h),l(g),pe(g,M=>_?.(M)),P(M=>{m=fe(g,1,"flex w-full items-center gap-4 px-6 py-2 transition-colors hover:bg-gray-200 dark:hover:bg-gray-700 rounded-xl",null,m,{"bg-gray-200":v(),"dark:bg-gray-700":v()}),D(U,`${M??""} `)},[()=>x()("new_album")]),o(b,g),ye(),S()}Le(["click"]);var Mt=A('<div class="flex animate-pulse gap-4 px-6 py-2"><div class="h-12 w-12 rounded-xl bg-slate-200"></div> <div class="flex flex-col items-start justify-center gap-2"><span class="h-4 w-36 animate-pulse bg-slate-200"></span> <div class="flex animate-pulse gap-1"><span class="h-3 w-8 bg-slate-200"></span> <span class="h-3 w-20 bg-slate-200"></span></div></div></div>'),Ct=A('<p class="px-5 py-3 text-xs"> </p>'),Et=A('<p class="px-5 py-1 text-sm"> </p>'),Lt=A('<input class="border-b-4 border-immich-bg px-6 py-2 text-2xl focus:border-immich-primary dark:border-immich-dark-gray dark:focus:border-immich-dark-primary"/> <div class="immich-scrollbar overflow-y-auto"></div>',1),It=A('<div class="mb-2 flex max-h-100 flex-col"><!></div> <!>',1),Bt=A('<div class="flex justify-around w-full"><div class="flex gap-4"><div class="flex gap-1 place-items-center"><span class="bg-gray-300 dark:bg-gray-500 rounded p-1"><!></span> <!></div> <div class="flex gap-1 place-items-center"><span class="bg-gray-300 dark:bg-gray-500 rounded p-1"><!></span> <!></div></div></div>'),Pt=A("<!> <!>",1);function Jt(b,a){he(a,!0);const x=()=>_e(nt,"$albumViewSettings",S),c=()=>_e(xe,"$t",S),[S,L]=Ie();let v=ae(Ce([])),_=ae(Ce([])),g=ae(!0),m=ae(""),r=ae(-1);Ye(async()=>{O(v,await ot({shared:a.shared||void 0}),!0),O(_,e(v).sort((s,y)=>new Date(s.updatedAt)>new Date(y.updatedAt)?-1:1).slice(0,3),!0),O(g,!1)});const d=Ce([]),h=W(()=>d.length>0),U=new ft(a.shared,x().sortBy,x().sortOrder),z=W(()=>U.toModalRows(e(m),e(_),e(v),e(r),d)),$=W(()=>e(z).filter(s=>mt(s.type)).length),M=async s=>{const y=await it({createAlbumDto:{albumName:s}});a.onClose([y])},N=s=>{if(e(h)){I(s);return}if(s){a.onClose([s]);return}a.onClose()},I=s=>{const y=s??e(z).find(({selected:q})=>q)?.album;if(!y)return;const G=d.indexOf(y.id);if(G===-1){d.push(y.id);return}d.splice(G,1)},se=()=>{const s=new Set(e(v).filter(({id:y})=>d.includes(y)));s.size>0?a.onClose([...s]):a.onClose()},re=async()=>{const s=e(z).find(({selected:y})=>y);if(s){switch(s.type){case K.NEW_ALBUM:{await M(e(m));break}case K.ALBUM_ITEM:{if(e(h)){se();break}s.album&&a.onClose([s.album]);break}}O(r,-1)}},we=async s=>{switch(s.key){case"ArrowUp":{s.preventDefault(),e(r)>0?Pe(r,-1):O(r,e($)-1);break}case"ArrowDown":{s.preventDefault(),e(r)<e($)-1?Pe(r):O(r,0);break}case"Enter":{s.preventDefault(),await re();break}case"Control":{s.preventDefault(),I();break}default:O(r,-1)}};{let s=W(()=>a.shared?c()("add_to_shared_album"):c()("add_to_album"));ct(b,{get title(){return e(s)},get onClose(){return a.onClose},size:"small",children:(y,G)=>{var q=Pt(),Y=Q(q);dt(Y,{children:(le,ce)=>{var V=It(),j=Q(V),F=i(j);{var t=f=>{var p=ne(),w=Q(p);Ne(w,16,()=>({length:3}),De,(k,B)=>{var u=Mt();o(k,u)}),o(f,p)},n=f=>{var p=Lt(),w=Q(p);Ze(w),w.__keydown=we,Je(()=>at(w,()=>e(m),B=>O(m,B))),pe(w,B=>st?.(B));var k=E(w,2);Ne(k,21,()=>e(z),De,(B,u)=>{var H=ne(),Re=Q(H);{var Qe=J=>{{let de=W(()=>e(u).selected||!1);St(J,{get selected(){return e(de)},onNewAlbum:M,get searchQuery(){return e(m)}})}},Ve=J=>{var de=ne(),je=Q(de);{var We=X=>{var Z=Ct(),Ae=i(Z,!0);l(Z),P(()=>D(Ae,e(u).text)),o(X,Z)},$e=X=>{var Z=ne(),Ae=Q(Z);{var Ge=ee=>{var te=Et(),Se=i(te,!0);l(te),P(()=>D(Se,e(u).text)),o(ee,te)},qe=ee=>{var te=ne(),Se=Q(te);{var Fe=Me=>{{let Ke=W(()=>e(u).selected||!1);wt(Me,{get album(){return e(u).album},get selected(){return e(Ke)},get multiSelected(){return e(u).multiSelected},get searchQuery(){return e(m)},onAlbumClick:()=>N(e(u).album),onMultiSelect:()=>I(e(u).album)})}};T(Se,Me=>{e(u).type===K.ALBUM_ITEM&&e(u).album&&Me(Fe)},!0)}o(ee,te)};T(Ae,ee=>{e(u).type===K.MESSAGE?ee(Ge):ee(qe,!1)},!0)}o(X,Z)};T(je,X=>{e(u).type===K.SECTION?X(We):X($e,!1)},!0)}o(J,de)};T(Re,J=>{e(u).type===K.NEW_ALBUM?J(Qe):J(Ve,!1)})}o(B,H)}),l(k),P(B=>ie(w,"placeholder",B),[()=>c()("search")]),o(f,p)};T(F,f=>{e(g)?f(t):f(n,!1)})}l(j);var C=E(j,2);{var R=f=>{et(f,{size:"small",shape:"round",fullWidth:!0,onclick:se,children:(p,w)=>{ve();var k=me();P(B=>D(k,B),[()=>c()("add_to_albums_count",{values:{count:d.length}})]),o(p,k)},$$slots:{default:!0}})};T(C,f=>{e(h)&&f(R)})}o(le,V)},$$slots:{default:!0}});var ke=E(Y,2);vt(ke,{children:(le,ce)=>{var V=Bt(),j=i(V),F=i(j),t=i(F),n=i(t);be(n,{get icon(){return tt},size:"1rem"}),l(t);var C=E(t,2);Ee(C,{size:"tiny",children:(k,B)=>{ve();var u=me();P(H=>D(u,H),[()=>c()("to_select")]),o(k,u)},$$slots:{default:!0}}),l(F);var R=E(F,2),f=i(R),p=i(f);Ee(p,{size:"tiny",children:(k,B)=>{ve();var u=me("CTRL");o(k,u)},$$slots:{default:!0}}),l(f);var w=E(f,2);Ee(w,{size:"tiny",children:(k,B)=>{ve();var u=me();P(H=>D(u,H),[()=>c()("to_multi_select")]),o(k,u)},$$slots:{default:!0}}),l(R),l(j),l(V),o(le,V)},$$slots:{default:!0}}),o(y,q)},$$slots:{default:!0}})}ye(),L()}Le(["keydown"]);export{Jt as A,_t as a};
