import{d as c,u as d,g as p,j as f}from"./D0CSSuTl.js";import{s as $,g as i}from"./gvLJu3l0.js";import{p as l}from"./CG4KAGH3.js";import{e as b}from"./BpCm29KX.js";import{R as g}from"./gegweU97.js";import{h as k,af as U,ag as I}from"./BP6NvnZ7.js";const A=()=>{const t=$;return{page:{subscribe:t.page.subscribe},navigating:{subscribe:t.navigating.subscribe},updated:t.updated}},u={subscribe(t){return A().page.subscribe(t)}},V={subscribe(t){return A().navigating.subscribe(t)}},R=t=>JSON.stringify(t);class m{#t=new Map;async getOrFetch(s,e,a=R,r){const n=a(s),o=this.#t.get(n);if(o)return o;const h=await e(s);return h&&r&&this.#t.set(n,h),h}clear(){this.#t.clear()}}class L{#t=new m;#s=new m;constructor(){b.on({AssetEditsApplied:()=>{this.#t.clear(),this.#s.clear()}})}async getAsset(s,e=!0){return this.#t.getOrFetch(s,k,R,e)}async getAssetOcr(s){return this.#s.getOrFetch({id:s},U,e=>e.id,!0)}clearAssetCache(){this.#t.clear()}clearOcrCache(){this.#s.clear()}invalidate(){this.clearAssetCache(),this.clearOcrCache()}}const O=new L,z=t=>new URL(t,globalThis.location.href).origin!==globalThis.location.origin,w=t=>!!t?.startsWith("/(user)/photos/[[assetId=id]]"),P=t=>!!t?.startsWith("/(user)/share/[key]")||!!t?.startsWith("/(user)/s/[slug]"),K=t=>!!t?.startsWith("/(user)/albums/[albumId=id]"),_=t=>!!t?.startsWith("/(user)/people/[personId]"),B=t=>!!t?.startsWith("/(user)/locked"),D=t=>!!(t?.route?.id?.endsWith("/[[assetId=id]]")&&"assetId"in(t?.params||{}));function H({assetId:t,slug:s,key:e}){return t?O.getAsset({id:t,slug:s,key:e},!1):void 0}function S(){const t=c(u);return w(t.route.id)?g.photos()+t.url.search:t.url.pathname.replace(/(\/photos.*)$/,"")+t.url.search}function y(t){const s=c(u),e=new URLSearchParams(s.url.search);e.delete("at");const r=e.toString()==""?"":"?"+e.toString();return w(s.route.id)?`${g.viewAsset({id:t})}${r}`:`${s.url.pathname.replace(/\/photos\/[^/]+$/,"")}/photos/${t}${r}`}function C(t,s){const e=c(u),a=new URL(t,e.url),{at:r}=s||{at:null};if(!r)return a.pathname;const n=new URLSearchParams(e.url.search);return r&&n.set("at",r),a.pathname+"?"+n.toString()}function v(){const s=c(u).url;return s.pathname+s.search+s.hash}function W(t){return t.targetRoute==="current"&&"assetId"in t}function F(t){return t.targetRoute==="current"&&"assetId"in t&&"assetGridRouteSearchParams"in t}async function M(t,s){const{assetId:e}=t,a=e?y(e):S(),r=v();(a!==r||s?.forceNavigate)&&await i(a,s)}async function T(t,s){const{assetId:e,assetGridRouteSearchParams:a}=t,r=e?y(e):S(),n=C(r,a),o=v();(n!==o||s?.forceNavigate)&&await i(n,s)}function X(t,s){if(F(t))return T(t,s);if(W(t))return M(t,s);throw`Invalid navigation: ${JSON.stringify(t)}`}const Y=async(t,s)=>{s.searchParams.has(t)&&(s.searchParams.delete(t),await i(s,{keepFocus:!0}))},Z=async(t,s)=>{const e=globalThis.location.href,a=new URL(e);a.searchParams.set(t,s),await i(a,{keepFocus:!0})};class G{#t=d(()=>P(l.route?.id));get isSharedLink(){return p(this.#t)}set isSharedLink(s){f(this.#t,s)}#s=d(()=>this.isSharedLink?{key:l.params.key,slug:l.params.slug}:{});get params(){return p(this.#s)}set params(s){f(this.#s,s)}async logout(){let s;try{const e=await I();e.redirectUri&&(s=e.redirectUri)}catch(e){console.log("Error logging out:",e)}s=s??g.login();try{s.startsWith("/")?await i(s):globalThis.location.href=s}finally{b.emit("AuthLogout")}}}const q=new G;export{q as a,X as b,K as c,P as d,B as e,Y as f,H as g,y as h,_ as i,z as j,O as k,D as l,V as n,u as p,Z as s};
