import{x as $,y as N,p as O,f as x,b as I,g as J,a as S,u as D}from"./D0CSSuTl.js";import"./DsnmJJEf.js";import{c as P,a as W}from"./Bd1JH_Ov.js";import{s as F}from"./CMI33r64.js";import{T,i as j,ag as E,bo as z,bp as M,bq as R,br as U,bs as B}from"./D-UYCH9y.js";import{g as q}from"./gvLJu3l0.js";import{e as h}from"./BpCm29KX.js";import{R as v}from"./gegweU97.js";import{h as w,t as A}from"./DLePdI2u.js";import{g as _}from"./DWQ0JXRY.js";import{ab as k,ac as K,ad as G,ae as H,a7 as b,K as C}from"./BP6NvnZ7.js";import{m as L}from"./BHTYC334.js";function ft(t,e,r,o,n){$&&N();var s=e.$$slots?.[r],i=!1;s===!0&&(s=e[r==="default"?"children":r],i=!0),s===void 0?n!==null&&n(t):s(t,i?()=>o:o)}function dt(t){const e={};t.children&&(e.default=!0);for(const r in t.$$slots)e[r]=!0;return e}function mt(t,e){O(e,!0);{let r=D(()=>j("text-dark/75",e.class));T(t,{size:"small",get class(){return J(r)},children:(o,n)=>{var s=P(),i=x(s);F(i,()=>e.children??I),W(o,s)},$$slots:{default:!0}})}S()}const ut=(t,e)=>t.filter(r=>r.supportedContexts.includes(e)),gt=(t,e)=>t.filter(r=>r.supportedContexts.includes(e)),pt=(t,e,r,o,n)=>{const s={},i=[];for(let a=0;a<n;a++)i.push(t[`${e}_${a}`]??{});const[u]=i.splice(r,1);i.splice(o,0,u);for(let a=0;a<i.length;a++)s[`${e}_${a}`]=i[a];return s},yt=(t,e,r,o)=>{const n={};let s=0;for(let i=0;i<o;i++)i!==r&&(n[`${e}_${s}`]=t[`${e}_${i}`]??{},s++);return n},ht=(t,e)=>{const r={};if(e.filters&&t=="filter")for(const[o,n]of e.filters.entries())r[`filter_${o}`]=n.filterConfig??{};if(e.actions&&t=="action")for(const[o,n]of e.actions.entries())r[`action_${o}`]=n.actionConfig??{};return r},wt=(t,e,r,o,n,s,i,u)=>{const a=n.map((c,l)=>({[c.methodName]:i[`filter_${l}`]??{}})),g=s.map((c,l)=>({[c.methodName]:u[`action_${l}`]??{}}));return{name:t,description:e,enabled:r,triggerType:o,filters:a,actions:g}},_t=(t,e,r,o)=>{try{const n=JSON.parse(t),s=e.find(c=>c.type===n.triggerType),i=[],u={};if(Array.isArray(n.filters))for(const[c,l]of n.filters.entries()){const d=Object.keys(l)[0],f=r.find(p=>p.methodName===d);f&&(i.push(f),u[`filter_${c}`]=l[d])}const a=[],g={};if(Array.isArray(n.actions))for(const[c,l]of n.actions.entries()){const d=Object.keys(l)[0],f=o.find(p=>p.methodName===d);f&&(a.push(f),g[`action_${c}`]=l[d])}return{success:!0,data:{name:n.name??"",description:n.description??"",enabled:n.enabled??!1,trigger:s,filters:i,actions:a,filterConfigs:u,actionConfigs:g}}}catch(n){return{success:!1,error:n instanceof Error?n.message:"Invalid JSON"}}},bt=(t,e,r,o,n,s,i,u,a)=>{if(e!==t.enabled||r!==(t.name??"")||o!==(t.description??"")||n!==t.triggerType)return!0;const g=t.filters?.map(m=>m.pluginFilterId)??[],c=s.map(m=>m.id);if(JSON.stringify(g)!==JSON.stringify(c))return!0;const l=t.actions?.map(m=>m.pluginActionId)??[],d=i.map(m=>m.id);if(JSON.stringify(l)!==JSON.stringify(d))return!0;const f={};for(const[m,y]of(t.filters??[]).entries())f[`filter_${m}`]=y.filterConfig??{};if(JSON.stringify(f)!==JSON.stringify(u))return!0;const p={};for(const[m,y]of(t.actions??[]).entries())p[`action_${m}`]=y.actionConfig??{};return JSON.stringify(p)!==JSON.stringify(a)},Ct=async(t,e,r,o,n,s,i,u,a)=>{const g=s.map((d,f)=>({pluginFilterId:d.id,filterConfig:u[`filter_${f}`]??{}})),c=i.map((d,f)=>({pluginActionId:d.id,actionConfig:a[`action_${f}`]??{}}));return k({id:t,workflowUpdateDto:{name:e,description:r,enabled:o,filters:g,actions:c,triggerType:n}})},At=t=>({Create:{title:t("create_workflow"),icon:E,onAction:()=>Q({name:t("untitled_workflow"),triggerType:K.AssetCreate,filters:[],actions:[],enabled:!1})}}),kt=(t,e)=>{const r={title:e.enabled?t("disable"):t("enable"),icon:e.enabled?z:M,color:e.enabled?"danger":"primary",onAction:async()=>{await V(e)}},o={title:t("edit"),icon:U,onAction:()=>q(v.viewWorkflow(e))},n={title:t("delete"),icon:R,color:"danger",onAction:async()=>{await X(e)}};return{ToggleEnabled:r,Edit:o,Delete:n}},$t=(t,e,r)=>({title:t(e?"hide_schema":"show_schema"),icon:B,onAction:r}),Q=async t=>{const e=await _();try{const r=await G({workflowCreateDto:t});h.emit("WorkflowCreate",r)}catch(r){w(r,e("errors.unable_to_create"))}},V=async t=>{const e=await _();try{const r=await k({id:t.id,workflowUpdateDto:{enabled:!t.enabled}});return h.emit("WorkflowUpdate",r),A.success(e("workflow_updated")),r}catch(r){w(r,e("errors.unable_to_update_workflow"))}},X=async t=>{const e=await _();if(!await L.showDialog({prompt:e("workflow_delete_prompt"),confirmColor:"danger"}))return!1;try{return await H({id:t.id}),h.emit("WorkflowDelete",t),A.success(e("workflow_deleted")),!0}catch(o){return w(o,e("errors.unable_to_delete_workflow")),!1}},Nt=async(t,e)=>{if(!t)return;const r=e==="album-picker";try{if(Array.isArray(t)&&t.length>0)return r?await Promise.all(t.map(o=>b({id:o}))):await Promise.all(t.map(o=>C({id:o})));if(typeof t=="string"&&t)return r?await b({id:t}):await C({id:t})}catch(o){console.error("Failed to fetch picker metadata:",o)}};export{mt as C,kt as a,$t as b,dt as c,ut as d,gt as e,Nt as f,At as g,Ct as h,ht as i,wt as j,bt as k,pt as l,_t as p,yt as r,ft as s};
