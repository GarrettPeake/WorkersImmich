import"./DsnmJJEf.js";import{e as ce,s as Ae,d as Ot,o as Pt}from"./C8vxa4mj.js";import{p as lt,h as se,i as St,V as Ht,j as K,g as r,f as ve,s as w,c as l,r as d,a as dt,t as U,u as P}from"./D0CSSuTl.js";import{a6 as zt,Z as Oe,y as Je,a4 as Dt,l as Ft,a7 as $e,a8 as Ut}from"./DUXNbmIP.js";import{i as v}from"./D8NIUdeB.js";import{a as i,c as xe,f as p,t as Pe}from"./Bd1JH_Ov.js";import{cp as jt,cq as Vt,q as Q,s as ue,a as G,v as Nt,bt as Rt,ac as Ce,p as ee,ai as qt,ax as Bt,cr as Gt,cs as Kt,ct as Yt,F as Se,ad as He,aI as Xt,aH as et,aY as ze}from"./D-UYCH9y.js";import{a as tt}from"./IOA7-Wrn.js";import{p as u,c as ut,s as Qt,a as De}from"./zonMEKN6.js";import{P as Wt}from"./0qPXRVhz.js";import{a as at,h as rt}from"./DxRnQWdm.js";import{m as Zt}from"./DW5CvR3c.js";import{m as Jt,t as $t}from"./BRztk81V.js";import{g as ea}from"./CF_nq223.js";import{n as ta,F as st}from"./BP6NvnZ7.js";import{I as nt}from"./CLpfTz4o.js";import{d as Fe}from"./CJGyQpNN.js";function aa(c){let{PI:t,min:y,max:m,cos:C,round:j}=Math,V=c[0]|c[1]<<8|c[2]<<16,W=c[3]|c[4]<<8,me=(V&63)/63,Y=(V>>6&63)/31.5-1,ne=(V>>12&63)/31.5-1,x=(V>>18&31)/31,A=V>>23,N=(W>>3&63)/63,pe=(W>>9&63)/63,ie=W>>15,te=m(3,ie?A?5:7:W&7),J=m(3,ie?W&7:A?5:7),fe=A?(c[5]&15)/15:1,he=(c[5]>>4)/15,oe=A?6:5,Z=0,$=(R,L,_)=>{let H=[];for(let z=0;z<L;z++)for(let ae=z?0:1;ae*L<R*(L-z);ae++)H.push(((c[oe+(Z>>1)]>>((Z++&1)<<2)&15)/7.5-1)*_);return H},_e=$(te,J,x),ye=$(3,3,N*1.25),k=$(3,3,pe*1.25),b=A&&$(5,5,he),M=ra(c),f=j(M>1?32:32*M),S=j(M>1?32/M:32),h=new Uint8Array(f*S*4),I=[],O=[];for(let R=0,L=0;R<S;R++)for(let _=0;_<f;_++,L+=4){let H=me,z=Y,ae=ne,le=fe;for(let n=0,T=m(te,A?5:3);n<T;n++)I[n]=C(t/f*(_+.5)*n);for(let n=0,T=m(J,A?5:3);n<T;n++)O[n]=C(t/S*(R+.5)*n);for(let n=0,T=0;n<J;n++)for(let D=n?0:1,re=O[n]*2;D*J<te*(J-n);D++,T++)H+=_e[T]*I[D]*re;for(let n=0,T=0;n<3;n++)for(let D=n?0:1,re=O[n]*2;D<3-n;D++,T++){let E=I[D]*re;z+=ye[T]*E,ae+=k[T]*E}if(A)for(let n=0,T=0;n<5;n++)for(let D=n?0:1,re=O[n]*2;D<5-n;D++,T++)le+=b[T]*I[D]*re;let we=H-2/3*z,be=(3*H-we+ae)/2,X=be-ae;h[L]=m(0,255*y(1,be)),h[L+1]=m(0,255*y(1,X)),h[L+2]=m(0,255*y(1,we)),h[L+3]=m(0,255*y(1,le))}return{w:f,h:S,rgba:h}}function ra(c){let t=c[3],y=c[2]&128,m=c[4]&128,C=m?y?5:7:t&7,j=m?t&7:y?5:7;return C/j}function sa(c,t){return it(c,t),{update(y){it(c,y)}}}const it=(c,t)=>{const y=c.getContext("2d");if(!y)return;const{w:m,h:C,rgba:j}=aa(zt(t.base64ThumbHash)),V=y.createImageData(m,C);c.width=m,c.height=C,V.data.set(j),y.putImageData(V,0,0)};var na=p("<video autoplay loop></video>",2),ia=p('<span class="pt-2"><!></span>'),oa=p('<!> <div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white text-shadow-[1px_1px_6px_rgb(0_0_0)]"><!> <span class="pe-2 pt-2 drop-shadow-[1px_1px_6px_rgb(0_0_0)]"><!></span></div>',1);function ot(c,t){lt(t,!0);let y=u(t,"durationInSeconds",3,0),m=u(t,"enablePlayback",15,!1),C=u(t,"playbackOnIconHover",3,!1),j=u(t,"showTime",3,!0),V=u(t,"curve",3,!1),W=u(t,"playIcon",3,jt),me=u(t,"pauseIcon",3,Vt),Y=se(St(y())),ne=se(!0),x=se(!1),A=se(void 0);Ht(()=>{m()||(K(Y,y()),r(A)&&(r(A).src=""))});const N=()=>{C()&&m(!0)},pe=()=>{C()&&m(!1)};var ie=oa(),te=ve(ie);{var J=k=>{var b=na();let M;b.muted=!0,ut(b,f=>K(A,f),()=>r(A)),U(()=>{M=Q(b,1,"h-full w-full object-cover",null,M,{"rounded-xl":V()}),ue(b,"src",t.url)}),ce("play",b,()=>{K(ne,!1),K(x,!1)}),ce("error",b,()=>{r(A)?.src&&(K(x,!0),K(ne,!1))}),ce("timeupdate",b,({currentTarget:f})=>{const S=f.duration-f.currentTime;K(Y,Math.min(Math.ceil(Number.isNaN(S)?Number.POSITIVE_INFINITY:S),y()),!0)}),i(k,b)};v(te,k=>{m()&&k(J)})}var fe=w(te,2),he=l(fe);{var oe=k=>{var b=ia(),M=l(b);{var f=h=>{var I=Pe();U(O=>Ae(I,O),[()=>Fe.fromObject({seconds:r(Y)}).toFormat("m:ss")]),i(h,I)},S=h=>{var I=xe(),O=ve(I);{var R=_=>{var H=Pe();U(z=>Ae(H,z),[()=>Fe.fromObject({seconds:r(Y)}).toFormat("mm:ss")]),i(_,H)},L=_=>{var H=Pe();U(z=>Ae(H,z),[()=>Fe.fromObject({seconds:r(Y)}).toFormat("h:mm:ss")]),i(_,H)};v(O,_=>{r(Y)<3600?_(R):_(L,!1)},!0)}i(h,I)};v(M,h=>{r(Y)<60?h(f):h(S,!1)})}d(b),i(k,b)};v(he,k=>{j()&&k(oe)})}var Z=w(he,2),$=l(Z);{var _e=k=>{var b=xe(),M=ve(b);{var f=h=>{Nt(h,{})},S=h=>{var I=xe(),O=ve(I);{var R=_=>{G(_,{get icon(){return Rt},size:"24",class:"text-red-600"})},L=_=>{G(_,{get icon(){return me()},size:"24"})};v(O,_=>{r(x)?_(R):_(L,!1)},!0)}i(h,I)};v(M,h=>{r(ne)?h(f):h(S,!1)})}i(k,b)},ye=k=>{G(k,{get icon(){return W()},size:"24"})};v($,k=>{m()?k(_e):k(ye,!1)})}d(Z),d(fe),ce("mouseenter",Z,N),ce("mouseleave",Z,pe),i(c,ie),dt()}var la=p("<div></div>"),da=p('<div id="a"></div>'),ua=p('<div class="absolute bottom-2 start-2"><!></div>'),ca=p('<div class="absolute bottom-1 end-2 max-w-[50%]"><p class="text-xs font-medium text-white drop-shadow-lg max-w-[100%] truncate"> </p></div>'),va=p("<div><!></div>"),ma=p('<div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white"><span class="pe-2 pt-2"><!></span></div>'),fa=p('<div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white"><span class="pe-2 pt-2"><!></span></div>'),ha=p('<div><span class="pe-2 pt-2 flex place-items-center gap-1"><p> </p> <!></span></div>'),_a=p('<a class="absolute w-full top-0 bottom-0" aria-label="Thumbnail URL"></a>'),ba=p('<div class="absolute top-0 h-full w-full pointer-events-none"><!></div>'),ga=p('<div class="absolute top-0 h-full w-full pointer-events-none"><!></div>'),xa=p('<div class="absolute top-0 h-full w-full pointer-events-none"><div class="absolute h-full w-full bg-linear-to-b from-black/25 via-[transparent_25%]"></div> <!> <div class="absolute end-0 top-0 flex place-items-center gap-1 text-xs font-medium text-white"><span class="pe-2 pt-2"><!></span></div></div>'),pa=p('<canvas data-testid="thumbhash" draggable="false"></canvas>'),ya=p('<div class="absolute top-0 h-full w-full bg-immich-primary opacity-40"></div>'),wa=p('<div class="rounded-full bg-[#D9DCEF] dark:bg-[#232932]"><!></div>'),ka=p('<button type="button" role="checkbox"><!></button>'),Ia=p('<div data-thumbnail-focus-container="" role="link"><div data-outline=""></div> <div><div><div><!> <!> <!> <!> <!> <!> <!> <!></div> <!> <!> <!> <!></div> <!> <!></div></div>');function Ra(c,t){lt(t,!0);const y=()=>De(Ft,"$locale",j),m=()=>De(ea,"$getAltText",j),C=()=>De(Ut,"$playVideoThumbnailOnHover",j),[j,V]=Qt();let W=u(t,"groupIndex",3,0),me=u(t,"thumbnailSize",3,void 0),Y=u(t,"thumbnailWidth",3,void 0),ne=u(t,"thumbnailHeight",3,void 0),x=u(t,"selected",3,!1),A=u(t,"selectionCandidate",3,!1),N=u(t,"disabled",3,!1),pe=u(t,"disableLinkMouseOver",3,!1),ie=u(t,"readonly",3,!1),te=u(t,"showArchiveIcon",3,!1),J=u(t,"showStackedIcon",3,!0),fe=u(t,"albumUsers",19,()=>[]),he=u(t,"onClick",3,void 0),oe=u(t,"onSelect",3,void 0),Z=u(t,"onMouseEvent",3,void 0),$=u(t,"imageClass",3,""),_e=u(t,"brokenAssetClass",3,""),ye=u(t,"dimmed",3,!1),{IMAGE_THUMBNAIL:{THUMBHASH_FADE_DURATION:k}}=Dt,b=P(()=>Zt.pointerCoarse),M=se(void 0),f=se(!1),S=se(!1),h=se(!1),I=P(()=>me()||Y()||235),O=P(()=>me()||ne()||235),R=P(()=>fe()?.find(e=>e.id===t.asset.ownerId)??null);const L=e=>{e?.stopPropagation(),e?.preventDefault(),N()||oe()?.(Oe(t.asset))},_=()=>{if(x()){L();return}he()?.(Oe(t.asset))},H=e=>{if(e.ctrlKey||e.metaKey){window.open(rt(t.asset.id),"_blank");return}e.stopPropagation(),e.preventDefault(),_()},z=()=>{r(b)||(K(f,!0),Z()?.({isMouseOver:!0,selectedGroupIndex:W()}))},ae=()=>{K(f,!1),Z()?.({isMouseOver:!1,selectedGroupIndex:W()})};let le=null;const we=e=>e.preventDefault(),be=[],X=()=>{if(le){clearTimeout(le),le=null;for(const e of be)e();be.length=0}};let n=0,T=0;function D(e,{onLongPress:a}){let s=!1;const g=o=>{n=o.clientX,T=o.clientY,s=!1,le=setTimeout(()=>{a(),e.addEventListener("contextmenu",we,{once:!0}),be.push(()=>e.removeEventListener("contextmenu",we)),s=!0},350)},q=o=>{s&&(o.stopPropagation(),o.preventDefault())};return e.addEventListener("click",q),e.addEventListener("pointerdown",g,!0),e.addEventListener("pointerup",X,{capture:!0,passive:!0}),{destroy:()=>{e.removeEventListener("click",q),e.removeEventListener("pointerdown",g,!0),e.removeEventListener("pointerup",X,!0)}}}function re(e){(Math.abs(n-e.clientX)>=10||Math.abs(T-e.clientY)>=10)&&X()}Pt(()=>(document.addEventListener("scroll",X,{capture:!0,passive:!0}),document.addEventListener("wheel",X,{capture:!0,passive:!0}),document.addEventListener("contextmenu",X,{capture:!0,passive:!0}),document.addEventListener("pointermove",re,{capture:!0,passive:!0}),()=>{document.removeEventListener("scroll",X,!0),document.removeEventListener("wheel",X,!0),document.removeEventListener("contextmenu",X,!0),document.removeEventListener("pointermove",re,!0)}));var E=Ia();E.__keydown=e=>{e.key==="Enter"&&_(),e.key==="x"&&oe()?.(t.asset),document.activeElement===r(M)&&e.key==="Escape"&&Jt(a=>a.dataset.thumbnailFocusContainer===void 0,"next")},E.__click=H,ue(E,"tabindex",0);let Ue;var je=l(E),Le=w(je,2);Ce(Le,"",{},{width:"inherit",height:"inherit"});var Te=l(Le),Me=l(Te),Ve=l(Me);{var ct=e=>{var a=la();U(()=>Q(a,1,ee(["absolute h-full w-full bg-linear-to-b from-black/25 via-[transparent_25%] opacity-0 transition-opacity group-hover:opacity-100",{"rounded-xl":x()}]))),i(e,a)};v(Ve,e=>{!r(b)&&!N()&&e(ct)})}var Ne=w(Ve,2);{var vt=e=>{var a=da();U(()=>Q(a,1,ee(["absolute h-full w-full bg-gray-700/40",{"rounded-xl":x()}]))),i(e,a)};v(Ne,e=>{ye()&&!r(f)&&e(vt)})}var Re=w(Ne,2);{var mt=e=>{var a=ua(),s=l(a);G(s,{"data-icon-favorite":!0,get icon(){return qt},size:"24",class:"text-white"}),d(a),i(e,a)};v(Re,e=>{!at.isSharedLink&&t.asset.isFavorite&&e(mt)})}var qe=w(Re,2);{var ft=e=>{var a=ca(),s=l(a),g=l(s,!0);d(s),d(a),U(()=>Ae(g,r(R).name)),i(e,a)};v(qe,e=>{r(R)&&e(ft)})}var Be=w(qe,2);{var ht=e=>{var a=va(),s=l(a);G(s,{"data-icon-archive":!0,get icon(){return Bt},size:"24",class:"text-white"}),d(a),U(()=>Q(a,1,ee(["absolute start-2",t.asset.isFavorite?"bottom-10":"bottom-2"]))),i(e,a)};v(Be,e=>{!at.isSharedLink&&te()&&t.asset.visibility===ta.Archive&&e(ht)})}var Ge=w(Be,2);{var _t=e=>{var a=ma(),s=l(a),g=l(s);G(g,{"data-icon-equirectangular":!0,get icon(){return Gt},size:"24"}),d(s),d(a),i(e,a)};v(Ge,e=>{t.asset.isImage&&t.asset.projectionType===Wt.EQUIRECTANGULAR&&e(_t)})}var Ke=w(Ge,2);{var bt=e=>{var a=fa(),s=l(a),g=l(s);G(g,{"data-icon-playable":!0,get icon(){return Kt},size:"24"}),d(s),d(a),i(e,a)};v(Ke,e=>{t.asset.isImage&&t.asset.duration&&!t.asset.duration.includes("0:00:00.000")&&e(bt)})}var gt=w(Ke,2);{var xt=e=>{var a=ha(),s=l(a),g=l(s),q=l(g,!0);d(g);var o=w(g,2);G(o,{"data-icon-stack":!0,get icon(){return Yt},size:"24"}),d(s),d(a),U(F=>{Q(a,1,ee(["absolute flex place-items-center gap-1 text-xs font-medium text-white",t.asset.isImage&&!t.asset.livePhotoVideoId?"top-0 end-0":"top-7 end-1"])),Ae(q,F)},[()=>t.asset.stack.assetCount.toLocaleString(y())]),i(e,a)};v(gt,e=>{t.asset.stack&&J()&&e(xt)})}d(Me);var Ye=w(Me,2);{var pt=e=>{var a=_a();a.__click=s=>s.preventDefault(),ue(a,"tabindex",-1),Ce(a,"",{},{cursor:"unset"}),U(s=>ue(a,"href",s),[()=>rt(t.asset.id)]),i(e,a)};v(Ye,e=>{!r(b)&&r(f)&&!pe()&&e(pt)})}var Xe=w(Ye,2);{let e=P(()=>Je({id:t.asset.id,size:st.Thumbnail,cacheKey:t.asset.thumbhash})),a=P(()=>m()(t.asset));nt(Xe,{get class(){return $()},get brokenAssetClass(){return _e()},get url(){return r(e)},get altText(){return r(a)},get widthStyle(){return`${r(I)??""}px`},get heightStyle(){return`${r(O)??""}px`},get curve(){return x()},onComplete:s=>(K(S,!0),K(h,s,!0))})}var Qe=w(Xe,2);{var yt=e=>{var a=ba(),s=l(a);{let g=P(()=>$e({id:t.asset.id,cacheKey:t.asset.thumbhash})),q=P(()=>r(f)&&C()),o=P(()=>t.asset.duration?$t(t.asset.duration):0),F=P(()=>!C());ot(s,{get url(){return r(g)},get enablePlayback(){return r(q)},get curve(){return x()},get durationInSeconds(){return r(o)},get playbackOnIconHover(){return r(F)}})}d(a),i(e,a)},wt=e=>{var a=xe(),s=ve(a);{var g=o=>{var F=ga(),ke=l(F);{let Ie=P(()=>$e({id:t.asset.livePhotoVideoId,cacheKey:t.asset.thumbhash})),de=P(()=>r(f)&&C()),B=P(()=>!C());ot(ke,{get url(){return r(Ie)},get enablePlayback(){return r(de)},get pauseIcon(){return et},get playIcon(){return Xt},showTime:!1,get curve(){return x()},get playbackOnIconHover(){return r(B)}})}d(F),i(o,F)},q=o=>{var F=xe(),ke=ve(F);{var Ie=de=>{var B=xa(),ge=w(l(B),2);{let Ct=P(()=>Je({id:t.asset.id,size:st.Original,cacheKey:t.asset.thumbhash})),Mt=P(()=>m()(t.asset));nt(ge,{get class(){return $()},get brokenAssetClass(){return _e()},get url(){return r(Ct)},get altText(){return r(Mt)},get widthStyle(){return`${r(I)??""}px`},get heightStyle(){return`${r(O)??""}px`},get curve(){return x()}})}var Ee=w(ge,2),Ze=l(Ee),Et=l(Ze);G(Et,{"data-icon-playable-pause":!0,get icon(){return et},size:"24"}),d(Ze),d(Ee),d(B),i(de,B)};v(ke,de=>{t.asset.isImage&&t.asset.duration&&!t.asset.duration.includes("0:00:00.000")&&r(f)&&de(Ie)},!0)}i(o,F)};v(s,o=>{t.asset.isImage&&t.asset.livePhotoVideoId?o(g):o(q,!1)},!0)}i(e,a)};v(Qe,e=>{t.asset.isVideo?e(yt):e(wt,!1)})}var kt=w(Qe,2);{var It=e=>{var a=pa();let s,g;tt(a,(q,o)=>sa?.(q,o),()=>({base64ThumbHash:t.asset.thumbhash})),U(()=>{s=Q(a,1,"absolute top-0 object-cover",null,s,{"rounded-xl":x()}),g=Ce(a,"",g,{width:`${r(I)??""}px`,height:`${r(O)??""}px`})}),Se(2,a,()=>He,()=>({duration:k})),i(e,a)};v(kt,e=>{(!r(S)||r(h))&&t.asset.thumbhash&&e(It)})}d(Te);var We=w(Te,2);{var At=e=>{var a=ya();Se(1,a,()=>He,()=>({duration:100})),Se(2,a,()=>He,()=>({duration:100})),i(e,a)};v(We,e=>{A()&&e(At)})}var Lt=w(We,2);{var Tt=e=>{var a=ka();a.__click=L,ue(a,"tabindex",-1);var s=l(a);{var g=o=>{G(o,{"data-icon-select":!0,get icon(){return ze},size:"24",class:"text-zinc-800"})},q=o=>{var F=xe(),ke=ve(F);{var Ie=B=>{var ge=wa(),Ee=l(ge);G(Ee,{"data-icon-select":!0,get icon(){return ze},size:"24",class:"text-primary"}),d(ge),i(B,ge)},de=B=>{G(B,{"data-icon-select":!0,get icon(){return ze},size:"24",class:"text-white/80 hover:text-white"})};v(ke,B=>{x()?B(Ie):B(de,!1)},!0)}i(o,F)};v(s,o=>{N()?o(g):o(q,!1)})}d(a),U(()=>{Q(a,1,ee(["absolute p-2 focus:outline-none",{"cursor-not-allowed":N()}])),ue(a,"aria-checked",x()),a.disabled=N()}),i(e,a)};v(Lt,e=>{!ie()&&(r(f)||x()||A())&&e(Tt)})}d(Le),d(E),tt(E,(e,a)=>D?.(e,a),()=>({onLongPress:()=>oe()?.(Oe(t.asset))})),ut(E,e=>K(M,e),()=>r(M)),U(()=>{Q(E,1,ee(["focus-visible:outline-none flex overflow-hidden",N()?"bg-gray-300":"dark:bg-neutral-700 bg-neutral-200"]),"svelte-upau3b"),ue(E,"data-asset",t.asset.id),Ue=Ce(E,"",Ue,{width:`${r(I)??""}px`,height:`${r(O)??""}px`}),Q(je,1,ee(["pointer-events-none absolute z-1 size-full outline-hidden outline-4 -outline-offset-4 outline-immich-primary",{"rounded-xl":x()}]),"svelte-upau3b"),Q(Le,1,ee(["group absolute top-0 bottom-0",{"cursor-not-allowed":N(),"cursor-pointer":!N()}])),Q(Te,1,ee(["absolute h-full w-full select-none bg-transparent transition-transform",{"scale-[0.85]":x()},{"rounded-xl":x()}]))}),ce("mouseenter",E,z),ce("mouseleave",E,ae),i(c,E),dt(),V()}Ot(["keydown","click"]);export{Ra as T};
