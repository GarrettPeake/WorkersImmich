import{g as G}from"./gvLJu3l0.js";import{e as T}from"./BpCm29KX.js";import{s as me}from"./D1613R3V.js";import"./DsnmJJEf.js";import{p as Y,c as h,n as q,t as x,s as U,g as o,r as w,u as l,a as ee,f as ae,j as ne,h as ie,d as le}from"./D0CSSuTl.js";import{s as D}from"./C8vxa4mj.js";import{t as z,a as d,f as P,c as ve}from"./Bd1JH_Ov.js";import{a as te,s as se}from"./zonMEKN6.js";import{c as ge}from"./DUXNbmIP.js";import{T as H,I as he,b as we,W as ye,K as ue,bL as _e,aO as Ae,bM as be,bm as $e,ab as Ce,aZ as Ue}from"./D-UYCH9y.js";import{$ as re,g as I}from"./DWQ0JXRY.js";import{B as xe}from"./BlxJl2x7.js";import{C as De}from"./DZu0po9D.js";import{i as ce}from"./D8NIUdeB.js";import{F as Q}from"./DS0yfrVF.js";import{C as fe,m as L}from"./BHTYC334.js";import{R as X}from"./gegweU97.js";import{D as Pe,u as de}from"./CJGyQpNN.js";import{t as O,h as S}from"./DLePdI2u.js";import{al as ke,am as oe,an as Re,ao as Me,ap as Te}from"./BP6NvnZ7.js";import{C as Ie}from"./3Su-ePg-.js";import{L as Oe}from"./DU5vAHPb.js";import{A as Se}from"./B2XNhc0s.js";import{F as Be}from"./BgQCgJ0_.js";import{I as Fe}from"./s_2UW97Q.js";var Le=P('<div class="flex flex-col gap-4"><!> <div class="flex justify-center gap-2 items-center"><!> <!></div> <!></div>');function je(s,e){Y(e,!0);const t=()=>te(re,"$t",a),[a,r]=se();{let n=l(()=>t()("password_reset_success")),m=l(()=>t()("done"));xe(s,{get title(){return o(n)},get icon(){return ye},get onClose(){return e.onClose},size:"small",get closeText(){return o(m)},children:(g,k)=>{var u=Le(),f=h(u);H(f,{children:(c,p)=>{q();var i=z();x(b=>D(i,b),[()=>t()("admin.user_password_has_been_reset")]),d(c,i)},$$slots:{default:!0}});var y=U(f,2),R=h(y);De(R,{color:"primary",children:(c,p)=>{q();var i=z();x(()=>D(i,e.newPassword)),d(c,i)},$$slots:{default:!0}});var A=U(R,2);{let c=l(()=>t()("copy_password")),p=l(()=>t()("copy_password"));he(A,{get icon(){return we},shape:"round",color:"secondary",variant:"ghost",onclick:()=>ge(e.newPassword),get title(){return o(c)},get"aria-label"(){return o(p)}})}w(y);var M=U(y,2);H(M,{children:(c,p)=>{q();var i=z();x(b=>D(i,b),[()=>t()("admin.user_password_reset_description")]),d(c,i)},$$slots:{default:!0}}),w(u),d(g,u)},$$slots:{default:!0}})}ee(),r()}var qe=P("<b> </b>"),ze=P("<b> </b>"),Ee=P("<!> <!>",1),Je=P('<div class="flex flex-col gap-4"><!> <div class="flex items-center gap-2"><!> <!></div> <!></div>');function Ke(s,e){Y(e,!0);const t=()=>te(re,"$t",a),[a,r]=se();let n=ie(!1),m=ie(""),g=l(()=>o(n)&&o(m)!==e.user.email);const k=async u=>{if(!u){e.onClose();return}await Ze(e.user,{force:o(n)})&&e.onClose()};{const u=R=>{var A=Je(),M=h(A);H(M,{children:(v,E)=>{var B=ve(),J=ae(B);{var F=_=>{{const $=(N,V)=>{let W=()=>V?.().message;var C=qe(),Z=h(C,!0);w(C),x(()=>D(Z,W())),d(N,C)};let K=l(()=>({user:e.user.name}));Q(_,{key:"admin.user_delete_immediately",get values(){return o(K)},children:$,$$slots:{default:!0}})}},j=_=>{{const $=(N,V)=>{let W=()=>V?.().message;var C=ze(),Z=h(C,!0);w(C),x(()=>D(Z,W())),d(N,C)};let K=l(()=>({user:e.user.name,delay:me.value.userDeleteDelay}));Q(_,{key:"admin.user_delete_delay",get values(){return o(K)},children:$,$$slots:{default:!0}})}};ce(J,_=>{o(n)?_(F):_(j,!1)})}d(v,B)},$$slots:{default:!0}});var c=U(M,2),p=h(c);Ie(p,{id:"queue-user-deletion-checkbox",color:"secondary",get checked(){return o(n)},set checked(v){ne(n,v,!0)}});var i=U(p,2);{let v=l(()=>t()("admin.user_delete_immediately_checkbox"));Oe(i,{get label(){return o(v)},for:"queue-user-deletion-checkbox"})}w(c);var b=U(c,2);{var pe=v=>{var E=Ee(),B=ae(E);Se(B,{color:"danger",icon:!1,children:(F,j)=>{q();var _=z();x($=>D(_,$),[()=>t()("admin.force_delete_user_warning")]),d(F,_)},$$slots:{default:!0}});var J=U(B,2);{let F=l(()=>t()("admin.confirm_email_below",{values:{email:e.user.email}}));Be(J,{get label(){return o(F)},children:(j,_)=>{Fe(j,{get value(){return o(m)},set value($){ne(m,$,!0)}})},$$slots:{default:!0}})}d(v,E)};ce(b,v=>{o(n)&&v(pe)})}w(A),d(R,A)};let f=l(()=>t()("delete_user")),y=l(()=>o(n)?t()("permanently_delete"):t()("delete"));fe(s,{get icon(){return ue},get title(){return o(f)},get confirmText(){return o(y)},onClose:k,get disabled(){return o(g)},prompt:u,$$slots:{prompt:!0}})}ee(),r()}var Ne=P("<b> </b>"),Ve=P("<p><!></p>");function We(s,e){Y(e,!0);const t=()=>te(re,"$t",a),[a,r]=se(),n=async m=>{if(!m)return;await Ge(e.user)&&e.onClose()};{const m=u=>{var f=Ve(),y=h(f);{const R=(M,c)=>{let p=()=>c?.().message;var i=Ne(),b=h(i,!0);w(i),x(()=>D(b,p())),d(M,i)};let A=l(()=>({user:e.user.name}));Q(y,{key:"admin.user_restore_description",get values(){return o(A)},children:R,$$slots:{default:!0}})}w(f),d(u,f)};let g=l(()=>t()("restore_user")),k=l(()=>t()("restore"));fe(s,{get icon(){return _e},get title(){return o(g)},get confirmText(){return o(k)},confirmColor:"primary",size:"small",onClose:n,prompt:m,$$slots:{prompt:!0}})}ee(),r()}const Ct=s=>({Create:{title:s("create_user"),type:s("command"),icon:Ue,onAction:()=>G(X.newUser()),shortcuts:{shift:!0,key:"n"}}}),Ut=(s,e)=>{const t={icon:Ce,title:s("details"),onAction:()=>G(X.viewUser(e))},a={icon:$e,title:s("edit"),onAction:()=>G(X.editUser(e))},r={icon:ue,title:s("delete"),type:s("command"),color:"danger",$if:()=>le(de).id!==e.id&&!e.deletedAt,onAction:()=>L.show(Ke,{user:e}),shortcuts:{key:"Backspace"}},n=u=>Pe.fromISO(u).plus({days:me.value.userDeleteDelay}).toJSDate(),m={icon:_e,title:s("restore"),type:s("command"),color:"primary",data:{title:s("admin.user_restore_scheduled_removal",{values:{date:n(e.deletedAt)}})},$if:()=>!!e.deletedAt&&e.status===Re.Deleted,onAction:()=>L.show(We,{user:e})},g={icon:be,title:s("reset_password"),type:s("command"),$if:()=>le(de).id!==e.id,onAction:()=>Qe(e)},k={icon:Ae,type:s("command"),title:s("reset_pin_code"),onAction:()=>Xe(e)};return{Detail:t,Update:a,Delete:r,Restore:m,ResetPassword:g,ResetPinCode:k}},xt=async s=>{const e=await I();try{const t=await ke({userAdminCreateDto:s});return T.emit("UserAdminCreate",t),O.success(),t}catch(t){S(t,e("errors.unable_to_create_user"))}},Dt=async(s,e)=>{const t=await I();try{const a=await oe({id:s.id,userAdminUpdateDto:e});return T.emit("UserAdminUpdate",a),O.success(),!0}catch(a){return S(a,t("errors.unable_to_update_user")),!1}},Ze=async(s,e)=>{const t=await I();try{const a=await Te({id:s.id,userAdminDeleteDto:e});return T.emit("UserAdminDelete",a),O.success(),!0}catch(a){S(a,t("errors.unable_to_delete_user"))}},Ge=async s=>{const e=await I();try{const t=await Me({id:s.id});return T.emit("UserAdminRestore",t),O.success(),!0}catch(t){return S(t,e("errors.unable_to_restore_user")),!1}},He=(s=16)=>{let e="";const t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ,.-{}+!#$%/()=?";for(let a=0;a<s;a++){let r=crypto.getRandomValues(new Uint32Array(1))[0];r=r/2**32,r=Math.floor(r*t.length),e+=t[r]}return e},Qe=async s=>{const e=await I(),t=e("admin.confirm_user_password_reset",{values:{user:s.name}});if(await L.showDialog({prompt:t}))try{const r={password:He(),shouldChangePassword:!0},n=await oe({id:s.id,userAdminUpdateDto:r});T.emit("UserAdminUpdate",n),O.success(),await L.show(je,{newPassword:r.password})}catch(r){S(r,e("errors.unable_to_reset_password"))}},Xe=async s=>{const e=await I(),t=e("admin.confirm_user_pin_code_reset",{values:{user:s.name}});if(await L.showDialog({prompt:t}))try{const r=await oe({id:s.id,userAdminUpdateDto:{pinCode:null}});T.emit("UserAdminUpdate",r),O.success(e("pin_code_reset_successfully"))}catch(r){S(r,e("errors.unable_to_reset_pin_code"))}};export{Ct as a,Dt as b,Ut as g,xt as h};
