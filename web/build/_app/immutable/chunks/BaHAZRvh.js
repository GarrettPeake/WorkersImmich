const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_app/immutable/chunks/7ZR7F41Y.js","_app/immutable/chunks/DsnmJJEf.js","_app/immutable/chunks/C8vxa4mj.js","_app/immutable/chunks/D0CSSuTl.js","_app/immutable/chunks/DIeogL5L.js","_app/immutable/chunks/Bd1JH_Ov.js","_app/immutable/chunks/D8NIUdeB.js","_app/immutable/chunks/orVkzVhB.js","_app/immutable/chunks/DLePdI2u.js","_app/immutable/chunks/BP6NvnZ7.js","_app/immutable/chunks/7tRQeUtl.js","_app/immutable/chunks/zonMEKN6.js","_app/immutable/chunks/D-UYCH9y.js","_app/immutable/chunks/CMI33r64.js","_app/immutable/chunks/gvLJu3l0.js","_app/immutable/chunks/BUApaBEI.js","_app/immutable/assets/Logo.REF6zmWd.css","_app/immutable/chunks/IOA7-Wrn.js","_app/immutable/chunks/dsDpGkcL.js","_app/immutable/chunks/BRztk81V.js","_app/immutable/chunks/0qPXRVhz.js","_app/immutable/chunks/DUXNbmIP.js","_app/immutable/chunks/DxRnQWdm.js","_app/immutable/chunks/CG4KAGH3.js","_app/immutable/chunks/BpCm29KX.js","_app/immutable/chunks/gegweU97.js","_app/immutable/chunks/DWQ0JXRY.js","_app/immutable/chunks/CJGyQpNN.js","_app/immutable/chunks/BVZhy_zG.js","_app/immutable/chunks/CIJfCxLq.js","_app/immutable/chunks/C_T4m_n1.js","_app/immutable/chunks/B2VKg7zy.js","_app/immutable/chunks/DcdhlkRn.js","_app/immutable/chunks/Q3VoKRsI.js","_app/immutable/chunks/DU5vAHPb.js","_app/immutable/chunks/DFvk55M8.js","_app/immutable/chunks/B9MV_P2E.js","_app/immutable/chunks/CwqKZNgJ.js","_app/immutable/chunks/DPMzVlQx.js","_app/immutable/chunks/CS-10t6W.js","_app/immutable/chunks/DW5CvR3c.js","_app/immutable/chunks/BHTYC334.js","_app/immutable/chunks/Tw41aoDi.js","_app/immutable/chunks/Bqqp8sy9.js","_app/immutable/chunks/CF_nq223.js","_app/immutable/chunks/WQ1yKytR.js","_app/immutable/chunks/DnqqNi3p.js","_app/immutable/chunks/oXVv5nIS.js","_app/immutable/chunks/ChL-L15l.js","_app/immutable/chunks/CoqJY867.js","_app/immutable/chunks/DS0yfrVF.js","_app/immutable/chunks/3Su-ePg-.js","_app/immutable/chunks/s_2UW97Q.js","_app/immutable/assets/Input.idyGuON4.css","_app/immutable/chunks/69_IOA4Y.js","_app/immutable/chunks/9chJ2bcr.js","_app/immutable/chunks/B8RZOa0L.js","_app/immutable/chunks/Dgf_MdoC.js","_app/immutable/chunks/BZ21-Ulh.js","_app/immutable/chunks/5Inb98wy.js","_app/immutable/chunks/FpAj0Eak.js","_app/immutable/chunks/BjFPDMuz.js","_app/immutable/chunks/msCV69PI.js","_app/immutable/chunks/CgXU4mBI.js","_app/immutable/chunks/D1613R3V.js","_app/immutable/chunks/Biw8UfMB.js","_app/immutable/chunks/BMcevgEe.js","_app/immutable/chunks/BgQCgJ0_.js","_app/immutable/chunks/BzOEcAd-.js","_app/immutable/chunks/i7F918yQ.js","_app/immutable/chunks/CLpfTz4o.js","_app/immutable/chunks/Cr9S0fVn.js","_app/immutable/chunks/BmJQ54Se.js","_app/immutable/chunks/D3D47pl8.js","_app/immutable/chunks/BOLL51yO.js","_app/immutable/chunks/GXf5CvES.js","_app/immutable/chunks/BitKOkE8.js","_app/immutable/chunks/jZIyHVjf.js","_app/immutable/chunks/CG2BHJh0.js","_app/immutable/chunks/DKzKigBY.js","_app/immutable/chunks/Cq6696VF.js","_app/immutable/chunks/C3VE5xEq.js","_app/immutable/chunks/BcI9YXFA.js","_app/immutable/assets/Textarea.CRksyXnO.css","_app/immutable/assets/activity-viewer.CwxlvmcY.css","_app/immutable/chunks/CbJ1QVsO.js","_app/immutable/assets/thumbnail.Di7rqjOL.css","_app/immutable/chunks/BVcN3VUI.js","_app/immutable/chunks/C0GZEybY.js","_app/immutable/chunks/DCmy867i.js","_app/immutable/chunks/CC3fx6b-.js","_app/immutable/chunks/BCf5NZQ6.js","_app/immutable/chunks/DxfhPdFw.js","_app/immutable/chunks/D5KKc-uL.js","_app/immutable/chunks/BbpJDI0d.js","_app/immutable/chunks/GyRE5G4-.js","_app/immutable/chunks/DDy4N4G7.js","_app/immutable/chunks/XSsqx5Lk.js","_app/immutable/chunks/Dt4pkAJO.js","_app/immutable/assets/asset-viewer.CSooJwqO.css"])))=>i.map(i=>d[i]);
import"./DsnmJJEf.js";import{d as cs,s as kt,e as rt,o as ee,a as Ne}from"./C8vxa4mj.js";import{h as v,g as e,j as d,u as S,i as Rt,d as Hs,p as Gt,c as U,s as Z,b as We,r as B,t as Q,a as Dt,f as ut,V as gt,ae as _e,W as Cs,a1 as us,$ as Wt,n as Es}from"./D0CSSuTl.js";import{a as H,f as z,c as Tt}from"./Bd1JH_Ov.js";import{i as tt}from"./D8NIUdeB.js";import{h as Os,e as Te,a as Ps}from"./DLePdI2u.js";import{s as se}from"./CMI33r64.js";import{P as Ls,a as hs}from"./IOA7-Wrn.js";import{s as mt,ac as J,F as Lt,eM as Ws,d3 as Fs,q as Ht,p as Ie,a as we,aY as Rs,eN as Bs,G as Vs,bp as Je,ad as pe,eO as Us}from"./D-UYCH9y.js";import{b as Qe}from"./Dgf_MdoC.js";import{s as Vt,a as ht,p as W,c as Fe,e as zs,d as ds}from"./zonMEKN6.js";import{g as Ns,b as Ys,a as Ks}from"./gvLJu3l0.js";import{p as $e}from"./CG4KAGH3.js";import{r as js}from"./CrEwRPGF.js";import{T as qs}from"./CbJ1QVsO.js";import{u as fs}from"./WQ1yKytR.js";import{S as Xs,f as Zs}from"./D3ODmHbk.js";import{ar as Mt,bY as ts,bZ as Js,h as ms,n as es}from"./BP6NvnZ7.js";import{a4 as Qs,a0 as Ft,aq as Re,h as gs,n as ss,f as $s,e as ti,aa as ei,o as si,s as ii,b as xe}from"./DUXNbmIP.js";import{s as Ye,d as oi,p as ps,t as It,e as ri,h as ni,j as vs,k as ai,l as ys,f as is,m as li,n as ci}from"./CF_nq223.js";import"./BUApaBEI.js";import{a as Bt,k as ke,b as ve,l as He}from"./DxRnQWdm.js";import{$ as Ke}from"./DWQ0JXRY.js";import{a as ui,s as Ce}from"./Cc6nBHMJ.js";import{m as Be}from"./DW5CvR3c.js";import{S as Ct,g as hi,m as ws,P as di}from"./BRztk81V.js";import{c as Ve,u as Ee,b as ye,e as fi,g as mi,a as gi,A as pi,d as vi}from"./ChL-L15l.js";import{_ as yi,A as ot}from"./0qPXRVhz.js";import{a as wi}from"./Biw8UfMB.js";import{a as be}from"./Cr9S0fVn.js";import{s as bi}from"./BVZhy_zG.js";import{C as bs,I as Ai}from"./D3D47pl8.js";import{e as Ue}from"./BpCm29KX.js";import{f as Si}from"./oXVv5nIS.js";import{c as Ti,R as Ii}from"./gegweU97.js";import{D as Mi}from"./BCf5NZQ6.js";import{D as ie}from"./CJGyQpNN.js";import{F as Gi}from"./BMcevgEe.js";import{V as Di}from"./By_QSbKk.js";import{H as os,m as Oe}from"./BHTYC334.js";import{S as _i}from"./BEqGsB-Y.js";import{d as ze}from"./Dts20Tr4.js";import{g as xi}from"./MMtgDOP-.js";import{i as ki}from"./DDy4N4G7.js";var Hi="Expected a function";function Ci(c,t,s){var i=!0,o=!0;if(typeof c!="function")throw new TypeError(Hi);return Ti(s)&&(i="leading"in s?!!s.leading:i,o="trailing"in s?!!s.trailing:o),ze(c,t,{leading:i,maxWait:t,trailing:o})}class Ei{#t=v(0);get topSectionHeight(){return e(this.#t)}set topSectionHeight(t){d(this.#t,t,!0)}#o=v(0);get bodySectionHeight(){return e(this.#o)}set bodySectionHeight(t){d(this.#o,t,!0)}#i=v(0);get bottomSectionHeight(){return e(this.#i)}set bottomSectionHeight(t){d(this.#i,t,!0)}#n=S(()=>this.topSectionHeight+this.bodySectionHeight+this.bottomSectionHeight);get totalViewerHeight(){return e(this.#n)}set totalViewerHeight(t){d(this.#n,t)}#e=S(()=>({top:e(this.#a),bottom:e(this.#a)+this.viewportHeight}));get visibleWindow(){return e(this.#e)}set visibleWindow(t){d(this.#e,t)}#r=v(0);#u=v(0);#a=v(0);#l=v(235);#c=v(48);#s=v(12);#h=v(!1);#d=v(!1);#f=ze(()=>d(this.#h,!1),1e3);#m=ze(()=>this.suspendTransitions=!1,1e3);#p=S(()=>({spacing:2,heightTolerance:.5,rowHeight:e(this.#l),rowWidth:Math.floor(this.viewportWidth)}));constructor(){this.setLayoutOptions()}get scrollTop(){return 0}get justifiedLayoutOptions(){return e(this.#p)}get maxScrollPercent(){const t=this.totalViewerHeight;return(t-this.viewportHeight)/t}get maxScroll(){return this.totalViewerHeight-this.viewportHeight}#v(t){return e(this.#c)==t?!1:(d(this.#c,t,!0),!0)}get headerHeight(){return e(this.#c)}#y(t){return e(this.#s)==t?!1:(d(this.#s,t,!0),!0)}get gap(){return e(this.#s)}#g(t){return e(this.#l)==t?!1:(d(this.#l,t,!0),!0)}get rowHeight(){return e(this.#l)}set scrolling(t){d(this.#h,t,!0),t&&(this.suspendTransitions=!0,this.#f())}get scrolling(){return e(this.#h)}set suspendTransitions(t){d(this.#d,t,!0),t&&this.#m()}get suspendTransitions(){return e(this.#d)}set viewportWidth(t){const s=t!==e(this.#u);d(this.#u,t,!0),this.suspendTransitions=!0,this.updateViewportGeometry(s)}get viewportWidth(){return e(this.#u)}set viewportHeight(t){d(this.#r,t,!0),d(this.#d,!0),this.updateViewportGeometry(!1)}get viewportHeight(){return e(this.#r)}get hasEmptyViewport(){return this.viewportWidth===0||this.viewportHeight===0}updateIntersections(){}updateViewportGeometry(t){}setLayoutOptions({headerHeight:t=48,rowHeight:s=235,gap:i=12}={}){let o=!1;o||=this.#v(t),o||=this.#y(i),o||=this.#g(s),o&&this.refreshLayout()}updateSlidingWindow(){const t=this.scrollTop;e(this.#a)!==t&&(d(this.#a,t,!0),this.updateIntersections())}refreshLayout(){this.updateIntersections()}destroy(){}}class As{#t={};unprocessedAssets=[];changedDayGroups=new Set;newDayGroups=new Set;getDayGroup({year:t,month:s,day:i}){return this.#t[t]?.[s]?.[i]}setDayGroup(t,{year:s,month:i,day:o}){this.#t[s]||(this.#t[s]={}),this.#t[s][i]||(this.#t[s][i]={}),this.#t[s][i][o]=t}get existingDayGroups(){return Ye(this.changedDayGroups,this.newDayGroups)}get updatedBuckets(){const t=new Set;for(const s of this.changedDayGroups)t.add(s.monthGroup);return t}get bucketsWithNewDayGroups(){const t=new Set;for(const s of this.newDayGroups)t.add(s.monthGroup);return t}sort(t,s=Mt.Desc){for(const i of this.changedDayGroups)i.sortAssets(s);for(const i of this.newDayGroups)i.sortAssets(s);this.newDayGroups.size>0&&t.sortDayGroups()}}const{TIMELINE:{INTERSECTION_EXPAND_TOP:Ss,INTERSECTION_EXPAND_BOTTOM:Ts}}=Qs;function Oi(c,t){const s=rs(c,t,0,0);let i=!1;s||(i=rs(c,t,Ss,Ts)),t.intersecting=s||i,t.actuallyIntersecting=s,(i||s)&&c.clearDeferredLayout(t)}function je(c,t,s,i){return c>=s&&c<i||t>=s&&t<i||c<s&&t>=i}function rs(c,t,s,i){const o=t.top,l=o+t.height,h=c.visibleWindow.top-s,m=c.visibleWindow.bottom+i;return je(o,l,h,m)}function Pi(c,t,s,i=Ss,o=Ts){const l=c.visibleWindow.top-c.headerHeight-i,h=c.visibleWindow.bottom+c.headerHeight+o,m=t+s;return je(t,m,l,h)}function Pt(c,t,s){const{invalidateHeight:i,noDefer:o=!1}=s;if(i&&(t.isHeightActual=!1),!t.isLoaded){const l=c.viewportWidth;if(!t.isHeightActual){const h=1.5*t.assetsCount*c.rowHeight*.7,m=Math.ceil(h/l),A=c.headerHeight+Math.max(1,m)*c.rowHeight;t.height=A}return}Li(c,t,o)}function Li(c,t,s=!1){let i=0,o=0,l=0,h=0,m=0;const A=c.justifiedLayoutOptions;for(const n of t.dayGroups){n.layout(A,s);const I=n.width+(m>0?c.gap:0);o+I<=c.viewportWidth?(n.row=h,n.col=m++,n.left=o,n.top=i,o+=n.width+c.gap):(i+=l,o=0,h++,m=0,n.row=h,n.col=m,n.left=0,n.top=i,m++,o+=n.width+c.gap),l=n.height+c.headerHeight}i+=l,t.height=i,t.isHeightActual=!0}async function Wi(c,t,s,i){if(t.getFirstAsset())return;const o=oi(t.yearMonth),l=await ts({...Bt.params,...s,timeBucket:o},{signal:i});if(!l)return;if(s.timelineAlbumId){const m=await ts({...Bt.params,albumId:s.timelineAlbumId,timeBucket:o},{signal:i});if(!m)return;for(const A of m.id)c.albumAssets.add(A)}const h=t.addAssets(l,!0);h.length>0&&console.error(`Warning: getTimeBucket API returning assets not in requested month: ${t.yearMonth.month}, ${JSON.stringify(h.map(m=>({id:m.id,localDateTime:m.localDateTime})))}`)}async function ns(c,t,s="asset",i){const o=await c.findMonthGroupForAsset(t);if(!o)return;const l=o.findAssetById(t);if(l)switch(s){case"asset":return Fi(c,l,o,i);case"day":return Ri(c,l,o,i);case"month":return Bi(c,o,i);case"year":return Vi(c,o,i)}}function Ae(c,t){for(const s of c.months){const i=s.findAssetById({id:t});if(i)return{monthGroup:s,asset:i}}}function Pe(c,t){return c.months.find(s=>s.yearMonth.year===t.year&&s.yearMonth.month===t.month)}async function Fi(c,t,s,i){const o=s.findDayGroupForAsset(t);for await(const l of c.assetsIterator({startMonthGroup:s,startDayGroup:o,startAsset:t,direction:i}))if(t.id!==l.id)return l}async function Ri(c,t,s,i){const o=s.findDayGroupForAsset(t);for await(const l of c.assetsIterator({startMonthGroup:s,startDayGroup:o,startAsset:t,direction:i}))if(l.localDateTime.day!==t.localDateTime.day)return l}async function Bi(c,t,s){for(const i of c.monthGroupIterator({startMonthGroup:t,direction:s}))if(i.yearMonth.month!==t.yearMonth.month){const{value:o,done:l}=await c.assetsIterator({startMonthGroup:i,direction:s}).next();return l?void 0:o}}async function Vi(c,t,s){for(const i of c.monthGroupIterator({startMonthGroup:t,direction:s}))if(i.yearMonth.year!==t.yearMonth.year){const{value:o,done:l}=await c.assetsIterator({startMonthGroup:i,direction:s}).next();return l?void 0:o}}async function Ui(c,t,s){let{asset:i,monthGroup:o}=Ae(c,t.id)??{};if(!o||!i)return[];let{asset:l,monthGroup:h}=Ae(c,s.id)??{};if(!h||!l)return[];const m=c.getAssetOrder();ps(m===Mt.Desc,i.localDateTime,l.localDateTime)<0&&([i,l]=[l,i],[o,h]=[h,o]);const A=[],n=o.findDayGroupForAsset(i);for await(const I of c.assetsIterator({startMonthGroup:o,startDayGroup:n,startAsset:i}))if(A.push(I),I.id===l.id)break;return A}function zi(c,t){for(const s of c.months){const{year:i,month:o}=s.yearMonth;if(o===t.month&&i===t.year)return s}}function Ni(c,t){const s=ie.fromObject({year:t.year,month:t.month});let i,o=Number.MAX_SAFE_INTEGER;for(const l of c){const h=ie.fromObject({year:l.yearMonth.year,month:l.yearMonth.month}),m=Math.abs(h.diff(s,"months").months);m<o&&(o=m,i=l)}return i}class Yi{#t=[];#o=[];#i;#n=Ci(()=>{const{add:t,update:s,remove:i}=this.#r();t.length>0&&this.#i.upsertAssets(t),s.length>0&&this.#i.upsertAssets(s),i.length>0&&this.#i.removeAssets(i),this.#t=[]},2500);constructor(t){this.#i=t}connectWebsocketEvents(){this.#o.push(Ft.on("on_upload_success",t=>this.#e({type:"add",values:[It(t)]})),Ft.on("on_asset_trash",t=>this.#e({type:"trash",values:t})),Ft.on("on_asset_update",t=>this.#e({type:"update",values:[It(t)]})),Ft.on("on_asset_delete",t=>this.#e({type:"delete",values:[t]})))}disconnectWebsocketEvents(){for(const t of this.#o)t();this.#o=[]}#e(...t){this.#t.push(...t),this.#n()}#r(){const t={add:[],update:[],remove:[]};for(const{type:s,values:i}of this.#t)switch(s){case"add":{t.add.push(...i);break}case"update":{t.update.push(...i);break}case"delete":case"trash":{t.remove.push(...i);break}}return t}}class Ki{#t;#o=S(()=>{if(!this.position)return!1;const t=this.#t.monthGroup.timelineManager,s=this.#t.absoluteDayGroupTop+this.position.top;return Pi(t,s,this.position.height)});get intersecting(){return e(this.#o)}set intersecting(t){d(this.#o,t)}#i=v();get position(){return e(this.#i)}set position(t){d(this.#i,t)}#n=v();get asset(){return e(this.#n)}set asset(t){d(this.#n,t,!0)}#e=S(()=>this.asset.id);get id(){return e(this.#e)}set id(t){d(this.#e,t)}constructor(t,s){this.#t=t,this.asset=s}}class ji{monthGroup;index;groupTitle;day;#t=v(Rt([]));get viewerAssets(){return e(this.#t)}set viewerAssets(t){d(this.#t,t,!0)}#o=v(0);get height(){return e(this.#o)}set height(t){d(this.#o,t,!0)}#i=v(0);get width(){return e(this.#i)}set width(t){d(this.#i,t,!0)}#n=S(()=>this.viewerAssets.some(t=>t.intersecting));get intersecting(){return e(this.#n)}set intersecting(t){d(this.#n,t)}#e=v(0);#r=v(0);#u=v(0);#a=v(0);#l=!1;constructor(t,s,i,o){this.index=s,this.monthGroup=t,this.day=i,this.groupTitle=o}get top(){return e(this.#e)}set top(t){d(this.#e,t,!0)}get left(){return e(this.#r)}set left(t){d(this.#r,t,!0)}get row(){return e(this.#u)}set row(t){d(this.#u,t,!0)}get col(){return e(this.#a)}set col(t){d(this.#a,t,!0)}get deferredLayout(){return this.#l}set deferredLayout(t){this.#l=t}sortAssets(t=Mt.Desc){const s=ps.bind(void 0,t===Mt.Asc);this.viewerAssets.sort((i,o)=>s(i.asset.fileCreatedAt,o.asset.fileCreatedAt))}getFirstAsset(){return this.viewerAssets[0]?.asset}*assetsIterator(t={}){const s=(t?.direction??"earlier")==="earlier";let i=t?.startAsset?this.viewerAssets.findIndex(o=>o.asset.id===t.startAsset.id):s?0:this.viewerAssets.length-1;for(;i>=0&&i<this.viewerAssets.length;)yield this.viewerAssets[i].asset,i+=s?1:-1}getAssets(){return this.viewerAssets.map(t=>t.asset)}runAssetCallback(t,s){if(t.size===0)return{moveAssets:[],processedIds:new Ct,unprocessedIds:t,changedGeometry:!1};const i=new Ct(t),o=new Ct,l=[];let h=!1;for(const m of i){const A=this.viewerAssets.findIndex(y=>y.id==m);if(A===-1)continue;const n=this.viewerAssets[A].asset,I={...n.localDateTime};let C=s(n)?.remove??!1;const G=n.localDateTime;if(I.year!==G.year||I.month!==G.month||I.day!==G.day){const{year:y,month:O,day:N}=G;C=!0,l.push({asset:n,date:{year:y,month:O,day:N}})}i.delete(m),o.add(m),(C||this.monthGroup.timelineManager.isExcluded(n))&&(this.viewerAssets.splice(A,1),h=!0)}return{moveAssets:l,processedIds:o,unprocessedIds:i,changedGeometry:h}}layout(t,s){if(!s&&!this.monthGroup.intersecting&&!this.monthGroup.timelineManager.isScrollingOnLoad){this.#l=!0;return}const i=this.viewerAssets.map(l=>l.asset),o=xi(i,t);this.width=o.containerWidth,this.height=i.length===0?0:o.containerHeight;for(let l=0;l<this.viewerAssets.length;l++)this.viewerAssets[l].position=o.getPosition(l)}get absoluteDayGroupTop(){return this.monthGroup.top+e(this.#e)}}function Is(c,t){if(!c)return!1;let s=!1;for(const i in t){if(!Object.prototype.hasOwnProperty.call(t,i)||i==="__proto__"||i==="constructor")continue;const o=c[i]instanceof Date;typeof c[i]=="object"&&!o?s=s||Is(c[i],t[i]):c[i]!==t[i]&&(c[i]=t[i],s=!0)}return s}function Le(c,t){return c===void 0?!1:c!==t}class as{#t=v(!1);#o=v(!1);get actuallyIntersecting(){return e(this.#o)}set actuallyIntersecting(t){d(this.#o,t,!0)}#i=v(!1);get isLoaded(){return e(this.#i)}set isLoaded(t){d(this.#i,t,!0)}#n=v(Rt([]));get dayGroups(){return e(this.#n)}set dayGroups(t){d(this.#n,t,!0)}timelineManager;#e=v(0);#r=v(0);#u=0;#a=Mt.Desc;#l=v(0);get percent(){return e(this.#l)}set percent(t){d(this.#l,t,!0)}#c=S(()=>this.isLoaded?this.dayGroups.reduce((t,s)=>t+s.viewerAssets.length,0):this.#u);get assetsCount(){return e(this.#c)}set assetsCount(t){d(this.#c,t)}loader;#s=v(!1);get isHeightActual(){return e(this.#s)}set isHeightActual(t){d(this.#s,t,!0)}monthGroupTitle;yearMonth;constructor(t,s,i,o,l=Mt.Desc){this.timelineManager=t,this.#u=i,this.#a=l,this.yearMonth=s,this.monthGroupTitle=ri(ni(s)),this.loader=new bs(()=>{this.isLoaded=!0},()=>{this.dayGroups=[],this.isLoaded=!1},this.#h),o&&(this.isLoaded=!0)}set intersecting(t){e(this.#t)!==t&&(d(this.#t,t,!0),t?this.timelineManager.loadMonthGroup(this.yearMonth):this.cancel())}get intersecting(){return e(this.#t)}get lastDayGroup(){return this.dayGroups.at(-1)}getFirstAsset(){return this.dayGroups[0]?.getFirstAsset()}getAssets(){return this.dayGroups.reduce((t,s)=>t.concat(s.getAssets()),[])}sortDayGroups(){return this.#a===Mt.Asc?this.dayGroups.sort((t,s)=>t.day-s.day):this.dayGroups.sort((t,s)=>s.day-t.day)}runAssetCallback(t,s){if(t.size===0)return{moveAssets:[],processedIds:new Ct,unprocessedIds:t,changedGeometry:!1};const{dayGroups:i}=this;let o=!1,l=new Ct(t);const h=new Ct,m=[];let A=i.length;for(;A--;)if(l.size>0){const n=i[A],{moveAssets:I,processedIds:x,changedGeometry:C}=n.runAssetCallback(t,s);I.length>0&&m.push(I),l=Ye(l,x);for(const G of x)h.add(G);o=o||C,n.viewerAssets.length===0&&(i.splice(A,1),o=!0)}return{moveAssets:m.flat(),unprocessedIds:l,processedIds:h,changedGeometry:o}}addAssets(t,s){const i=new As;for(let o=0;o<t.id.length;o++){const{localDateTime:l,fileCreatedAt:h}=vs(t.fileCreatedAt[o],t.localOffsetHours[o]),m={city:t.city[o],country:t.country[o],duration:t.duration[o],id:t.id[o],visibility:t.visibility[o],isFavorite:t.isFavorite[o],isImage:t.isImage[o],isTrashed:t.isTrashed[o],isVideo:!t.isImage[o],livePhotoVideoId:t.livePhotoVideoId[o],localDateTime:l,fileCreatedAt:h,ownerId:t.ownerId[o],projectionType:t.projectionType[o],ratio:t.ratio[o],stack:t.stack?.[o]?{id:t.stack[o][0],primaryAssetId:t.id[o],assetCount:Number.parseInt(t.stack[o][1])}:null,thumbhash:t.thumbhash[o],people:null};t.latitude?.[o]&&t.longitude?.[o]&&(m.latitude=t.latitude?.[o],m.longitude=t.longitude?.[o]),this.addTimelineAsset(m,i)}if(s)return i.unprocessedAssets;for(const o of i.existingDayGroups)o.sortAssets(this.#a);return i.newDayGroups.size>0&&this.sortDayGroups(),i.sort(this,this.#a),i.unprocessedAssets}addTimelineAsset(t,s){const{localDateTime:i}=t,{year:o,month:l}=this.yearMonth;if(l!==i.month||o!==i.year){s.unprocessedAssets.push(t);return}let h=s.getDayGroup(i)||this.findDayGroupByDay(i.day);if(h)s.setDayGroup(h,i);else{const A=ai(ys(i));h=new ji(this,this.dayGroups.length,i.day,A),this.dayGroups.push(h),s.setDayGroup(h,i),s.newDayGroups.add(h)}const m=new Ki(h,t);h.viewerAssets.push(m),s.changedDayGroups.add(h)}get viewId(){const{year:t,month:s}=this.yearMonth;return t+"-"+s}set height(t){if(e(this.#e)===t)return;const s=this.timelineManager,i=s.months.indexOf(this),o=t-e(this.#e);d(this.#e,t,!0);const l=s.months[i-1];if(l){const I=e(l.#r)+e(l.#e);e(this.#r)!==I&&d(this.#r,I)}if(o===0)return;for(let I=i+1;I<s.months.length;I++){const x=this.timelineManager.months[I],C=e(x.#r)+o;e(x.#r)!==C&&d(x.#r,C)}if(!s.viewportTopMonthIntersection)return;const{month:h,monthBottomViewportRatio:m,viewportTopRatioInMonth:A}=s.viewportTopMonthIntersection,n=h?s.months.indexOf(h):-1;if(!(!h||n<=0||i>n)){if(i<n||m<1)s.scrollBy(o);else if(i===n){const I=this.top+t*A;s.scrollTo(I)}}}get height(){return e(this.#e)}get top(){return e(this.#r)+this.timelineManager.topSectionHeight}#h(t){const s=Hs(Ke);Os(t,s("errors.failed_to_load_assets"))}findDayGroupForAsset(t){for(const s of this.dayGroups)if(s.viewerAssets.some(i=>i.id===t.id))return s}findDayGroupByDay(t){return this.dayGroups.find(s=>s.day===t)}findAssetAbsolutePosition(t){this.timelineManager.clearDeferredLayout(this);for(const s of this.dayGroups){const i=s.viewerAssets.find(o=>o.id===t);if(i){if(!i.position){console.warn("No position for asset");return}return{top:this.top+s.top+i.position.top+this.timelineManager.headerHeight,height:i.position.height}}}}*assetsIterator(t){const s=t?.direction??"earlier";let{startAsset:i}=t??{};const o=s==="earlier";let l=t?.startDayGroup?this.dayGroups.indexOf(t.startDayGroup):o?0:this.dayGroups.length-1;for(;l>=0&&l<this.dayGroups.length;)yield*this.dayGroups[l].assetsIterator({startAsset:i,direction:s}),i=void 0,l+=o?1:-1}findAssetById(t){for(const s of this.assetsIterator())if(s.id===t.id)return s}findClosest(t){const s=is(t);let i,o=1/0;for(const l of this.assetsIterator()){const h=is(l.localDateTime),m=Math.abs(s.diff(h).as("milliseconds"));m<o&&(o=m,i=l)}return i}cancel(){this.loader?.cancel()}}class Se extends Ei{#t=v(60);get bottomSectionHeight(){return e(this.#t)}set bottomSectionHeight(t){d(this.#t,t,!0)}#o=S(()=>{let t=0;for(const s of this.months)t+=s.height;return t});get bodySectionHeight(){return e(this.#o)}set bodySectionHeight(t){d(this.#o,t)}#i=S(()=>{let t=0;for(const s of this.months)t+=s.assetsCount;return t});get assetCount(){return e(this.#i)}set assetCount(t){d(this.#i,t)}#n=v(!1);get isInitialized(){return e(this.#n)}set isInitialized(t){d(this.#n,t,!0)}isScrollingOnLoad=!1;#e=v(Rt([]));get months(){return e(this.#e)}set months(t){d(this.#e,t,!0)}albumAssets=new Ct;#r=v(Rt([]));get scrubberMonths(){return e(this.#r)}set scrubberMonths(t){d(this.#r,t,!0)}#u=v(0);get scrubberTimelineHeight(){return e(this.#u)}set scrubberTimelineHeight(t){d(this.#u,t,!0)}viewportTopMonthIntersection;#a=S(()=>this.maxScrollPercent<.5);get limitedScroll(){return e(this.#a)}set limitedScroll(t){d(this.#a,t)}initTask=new bs(()=>{this.isInitialized=!0,!(this.#s.albumId||this.#s.personId)&&this.connect()},()=>{this.disconnect(),this.isInitialized=!1},()=>{});static#l={};#c;#s=Se.#l;#h=!1;#d=v();#f=new Ls("album-show-asset-owners",!1);#m=[];get showAssetOwners(){return this.#f.current}setShowAssetOwners(t){this.#f.current=t}toggleShowAssetOwners(){this.#f.current=!this.#f.current}constructor(){super(),this.#m.push(Ue.on({AssetUpdate:t=>this.upsertAssets([It(t)])}))}get scrollTop(){return e(this.#d)?.scrollTop??0}set scrollableElement(t){d(this.#d,t,!0)}scrollTo(t){e(this.#d)?.scrollTo({top:t}),this.updateSlidingWindow()}scrollBy(t){e(this.#d)?.scrollBy(0,t),this.updateSlidingWindow()}async*assetsIterator(t){const s=t?.direction??"earlier";let{startDayGroup:i,startAsset:o}=t??{};for(const l of this.monthGroupIterator({direction:s,startMonthGroup:t?.startMonthGroup}))await this.loadMonthGroup(l.yearMonth,{cancelable:!1}),yield*l.assetsIterator({startDayGroup:i,startAsset:o,direction:s}),i=o=void 0}*monthGroupIterator(t){const s=t?.direction==="earlier";let i=t?.startMonthGroup?this.months.indexOf(t.startMonthGroup):s?0:this.months.length-1;for(;i>=0&&i<this.months.length;)yield this.months[i],i+=s?1:-1}connect(){if(this.#c)throw new Error("TimelineManager already connected");this.#c=new Yi(this),this.#c.connectWebsocketEvents()}disconnect(){this.#c&&(this.#c.disconnectWebsocketEvents(),this.#c=void 0)}#p(t){if(!t)return 0;const s=this.visibleWindow.bottom-this.visibleWindow.top,o=t.top+t.height-this.visibleWindow.top;return Ve(o/s,0,1)}#v(t){return t?Ve((this.visibleWindow.top-t.top)/t.height,0,1):0}updateIntersections(){if(this.#h||!this.isInitialized||this.visibleWindow.bottom===this.visibleWindow.top)return;this.#h=!0;for(const o of this.months)Oi(this,o);const t=this.months.find(o=>o.actuallyIntersecting),s=this.#v(t),i=this.#p(t);this.viewportTopMonthIntersection={month:t,monthBottomViewportRatio:i,viewportTopRatioInMonth:s},this.#h=!1}clearDeferredLayout(t){if(t.dayGroups.some(i=>i.deferredLayout)){Pt(this,t,{invalidateHeight:!0,noDefer:!0});for(const i of t.dayGroups)i.deferredLayout=!1}}async#y(){const t=await Js({...Bt.params,...this.#s});this.months=t.map(s=>{const i=new Xs(s.timeBucket);return new as(this,{year:i.getUTCFullYear(),month:i.getUTCMonth()+1},s.count,!1,this.#s.order)}),this.albumAssets.clear(),this.updateViewportGeometry(!1)}async updateOptions(t){t.deferInit||this.#s!==Se.#l&&ki(this.#s,t)||(await this.initTask.reset(),await this.#g(t),this.updateViewportGeometry(!1),this.#b())}async#g(t){this.isInitialized=!1,this.months=[],this.albumAssets.clear(),await this.initTask.execute(async()=>{this.#s=t,await this.#y()},!0)}destroy(){this.disconnect(),this.isInitialized=!1;for(const t of this.#m)t();super.destroy()}async updateViewport(t){if(t.height===0&&t.width===0||this.viewportHeight===t.height&&this.viewportWidth===t.width)return;this.initTask.executed||await(this.initTask.loading?this.initTask.waitUntilCompletion():this.#g(this.#s));const s=t.width!==this.viewportWidth;this.viewportHeight=t.height,this.viewportWidth=t.width,this.updateViewportGeometry(s)}updateViewportGeometry(t){if(!(!this.isInitialized||this.hasEmptyViewport)){for(const s of this.months)Pt(this,s,{invalidateHeight:t});this.updateIntersections(),t&&this.#b()}}#b(){this.scrubberMonths=this.months.map(t=>({assetCount:t.assetsCount,year:t.yearMonth.year,month:t.yearMonth.month,title:t.monthGroupTitle,height:t.height})),this.scrubberTimelineHeight=this.totalViewerHeight}async loadMonthGroup(t,s){let i=!0;s&&(i=s.cancelable);const o=Pe(this,t);if(!o||o.loader?.executed)return;await o.loader?.execute(async h=>{await Wi(this,o,this.#s,h)},i)==="LOADED"&&(Pt(this,o,{invalidateHeight:!1}),this.updateIntersections())}upsertAssets(t){const i=this.#S(t).filter(o=>!this.isExcluded(o));this.addAssetsUpsertSegments([...i])}async findMonthGroupForAsset(t){this.isInitialized||await this.initTask.waitUntilExecution();const{id:s}=t;let{monthGroup:i}=Ae(this,s)??{};if(i)return i;const o=li(t)?t:await ms({...Bt.params,id:s}).catch(()=>null);if(!o)return;const l=It(o);if(!this.isExcluded(l)&&(i=await this.#A(l.localDateTime,{cancelable:!1}),i?.findAssetById({id:s})))return i}async#A(t,s){return await this.loadMonthGroup(t,s),Pe(this,t)}getMonthGroupByAssetId(t){return Ae(this,t)?.monthGroup}async getRandomAsset(t){const s=t??Math.floor(Math.random()*this.assetCount);let i=0,o;for(const h of this.months){if(s<i+h.assetsCount){o=h;break}i+=h.assetsCount}if(!o)return;await this.loadMonthGroup(o.yearMonth,{cancelable:!1});let l;for(const h of o.dayGroups){if(s<i+h.viewerAssets.length){l=h;break}i+=h.viewerAssets.length}if(l)return l.viewerAssets[s-i].asset}update(t,s){return this.#w(new Set(t),s)}removeAssets(t){return[...this.#w(new Set(t),()=>({remove:!0})).notUpdated]}upsertSegmentForAsset(t){let s=Pe(this,t.localDateTime);return s||(s=new as(this,t.localDateTime,1,!0,this.#s.order),this.months.push(s)),s}addAssetsUpsertSegments(t){if(t.length===0)return;const s=new As,i=this.months.length;for(const o of t)this.upsertSegmentForAsset(o).addTimelineAsset(o,s);this.months.length!==i&&this.postCreateSegments(),this.postUpsert(s)}#S(t){const s=new Map(t.map(h=>[h.id,h])),i=new Set(s.keys()),o=this.#w(i,h=>{Is(h,s.get(h.id))}),l=[];for(const h of o.notUpdated)l.push(s.get(h));return l}#w(t,s){if(t.size===0)return{updated:new Set,notUpdated:t,changedGeometry:!1};const i=new Set;let o=new Set(t);const l=new Set,h=[];for(const n of this.months){if(o.size===0)break;const I=n.runAssetCallback(o,s);I.moveAssets.length>0&&h.push(I.moveAssets),I.changedGeometry&&i.add(n),o=Ye(o,I.processedIds);for(const x of I.processedIds)l.add(x)}const m=[];for(const n of h)for(const I of n)m.push(I.asset);this.addAssetsUpsertSegments(m);const A=i.size>0;for(const n of i)Pt(this,n,{invalidateHeight:!0});return A&&this.updateIntersections(),{updated:l,notUpdated:o,changedGeometry:A}}refreshLayout(){for(const t of this.months)Pt(this,t,{invalidateHeight:!0});this.updateIntersections()}getFirstAsset(){return this.months[0]?.getFirstAsset()}async getLaterAsset(t,s="asset"){return await ns(this,t,s,"later")}async getEarlierAsset(t,s="asset"){return await ns(this,t,s,"earlier")}async getClosestAssetToDate(t){let s=zi(this,t);if(!s&&(s=Ni(this.months,t),!s))return;await this.loadMonthGroup(t,{cancelable:!1});const i=s.findClosest(t);if(i)return i;for await(const o of this.assetsIterator({startMonthGroup:s}))return o}async retrieveRange(t,s){return Ui(this,t,s)}isExcluded(t){return Le(this.#s.visibility,t.visibility)||Le(this.#s.isFavorite,t.isFavorite)||Le(this.#s.isTrashed,t.isTrashed)}getAssetOrder(){return this.#s.order??Mt.Desc}postCreateSegments(){this.months.sort((t,s)=>t.yearMonth.year===s.yearMonth.year?s.yearMonth.month-t.yearMonth.month:s.yearMonth.year-t.yearMonth.year)}postUpsert(t){for(const s of t.existingDayGroups)s.sortAssets(this.#s.order);for(const s of t.bucketsWithNewDayGroups)s.sortDayGroups();for(const s of t.updatedBuckets)s.sortDayGroups(),Pt(this,s,{invalidateHeight:!0});this.updateIntersections()}}var qi=z('<div class="absolute"><!> <!></div>'),Xi=z('<div data-image-grid="" class="relative overflow-clip svelte-yrxz8a"></div>');function Zi(c,t){Gt(t,!0);const s=()=>ht(l,"$isUploading",i),[i,o]=Vt();let{isUploading:l}=fs;const h=S(()=>t.manager.suspendTransitions&&!s()?0:150),m=S(()=>e(h)===0?0:e(h)+100),A=x=>x.filter(({intersecting:C})=>C);var n=Xi();let I;Te(n,29,()=>A(t.viewerAssets),x=>x.id,(x,C)=>{const G=S(()=>e(C).position),y=S(()=>e(C).asset);var O=qi();let N;var $=U(O);se($,()=>t.thumbnail,()=>({asset:e(y),position:e(G)}));var F=Z($,2);se(F,()=>t.customThumbnailLayout??We,()=>e(y)),B(O),Q(()=>{mt(O,"data-asset-id",e(y).id),N=J(O,"",N,{top:e(G).top+"px",left:e(G).left+"px",width:e(G).width+"px",height:e(G).height+"px"})}),Lt(6,O,()=>Ws,()=>({start:.1,duration:e(m)})),Fs(O,()=>Zs,()=>({duration:e(h)})),H(x,O)}),B(n),Q(()=>I=J(n,"",I,{height:t.height+"px",width:t.width+"px"})),H(c,n),Dt(),o()}var Ji=z("<div><!></div>"),Qi=z('<section data-group=""><div class="flex pt-7 pb-5 max-md:pt-5 max-md:pb-3 h-6 place-items-center text-xs font-medium text-immich-fg dark:text-immich-dark-fg md:text-sm"><!> <span class="w-full truncate first-letter:capitalize"> </span></div> <!></section>');function $i(c,t){Gt(t,!0);const s=()=>ht(l,"$isUploading",i),[i,o]=Vt();let{isUploading:l}=fs,h=v(null);const m=S(()=>e(h)!==null),A=S(()=>t.monthGroup.timelineManager.suspendTransitions&&!s()?0:150),n=G=>G.filter(({intersecting:y})=>y),I=G=>{const{month:y,year:O}=G.monthGroup.yearMonth,N=ys({year:O,month:y,day:G.day});return ci(N)};var x=Tt(),C=ut(x);Te(C,19,()=>n(t.monthGroup.dayGroups),G=>G.day,(G,y,O)=>{const N=S(()=>e(y).left),$=S(()=>t.assetInteraction.selectedGroup.has(e(y).groupTitle));var F=Qi();let V;var E=U(F);let Y;var K=U(E);{var w=P=>{var j=Ji();let nt;j.__click=()=>t.onDayGroupSelect(e(y),Re(e(y).getAssets())),j.__keydown=()=>t.onDayGroupSelect(e(y),Re(e(y).getAssets()));var pt=U(j);{var at=R=>{we(R,{get icon(){return Rs},size:"24",class:"text-primary"})},dt=R=>{we(R,{get icon(){return Bs},size:"24",color:"#757575"})};tt(pt,R=>{e($)?R(at):R(dt,!1)})}B(j),Q(R=>nt=Ht(j,1,"hover:cursor-pointer transition-all duration-200 ease-out overflow-hidden w-0",null,nt,R),[()=>({"w-8":e(h)===e(y).groupTitle&&e(m)||t.assetInteraction.selectedGroup.has(e(y).groupTitle)})]),H(P,j)};tt(K,P=>{t.singleSelect||P(w)})}var L=Z(K,2),g=U(L,!0);B(L),B(E);var T=Z(E,2);Zi(T,{get manager(){return t.manager},get viewerAssets(){return e(y).viewerAssets},get height(){return e(y).height},get width(){return e(y).width},get customThumbnailLayout(){return t.customThumbnailLayout},thumbnail:(j,nt)=>{let pt=()=>nt?.().asset,at=()=>nt?.().position;var dt=Tt(),R=ut(dt);se(R,()=>t.thumbnail,()=>({asset:pt(),position:at(),dayGroup:e(y),groupIndex:e(O)})),H(j,dt)},$$slots:{thumbnail:!0}}),B(F),Q(P=>{Ht(F,1,Ie([{"transition-all":!t.monthGroup.timelineManager.suspendTransitions},!t.monthGroup.timelineManager.suspendTransitions&&`delay-${e(A)}`]),"svelte-19t4ggy"),V=J(F,"",V,{position:"absolute",transform:`translate3d(${e(N)}px,${e(y).top}px,0)`}),Y=J(E,"",Y,{width:e(y).width+"px"}),mt(L,"title",P),kt(g,e(y).groupTitle)},[()=>I(e(y))]),rt("mouseenter",F,()=>d(h,e(y).groupTitle,!0)),rt("mouseleave",F,()=>d(h,null)),H(G,F)}),H(c,x),Dt(),o()}cs(["click","keydown"]);var to=z('<div id="time-label"> </div>'),eo=z('<p class="truncate pointer-events-none absolute text-sm rounded-full w-8 py-2 px-4 text-white bg-immich-primary/90 dark:bg-gray-500 hover:cursor-pointer select-none font-semibold"> </p>'),so=z('<div id="time-label" class="rounded-s-full w-8 ps-2 text-white bg-immich-primary dark:bg-gray-600 hover:cursor-pointer select-none"><!> <!> <!></div>'),io=z('<p class="truncate pointer-events-none absolute end-0 bottom-0 min-w-20 max-w-64 w-fit rounded-tl-md border-b-2 border-immich-primary bg-subtle/90 z-1 py-1 px-1 text-sm font-medium shadow-[0_0_8px_rgba(0,0,0,0.25)] dark:border-immich-dark-primary dark:text-immich-dark-fg"> </p>'),oo=z('<div class="absolute end-0 h-0.5 w-10 bg-primary"><!></div>'),ro=z('<div class="absolute end-5 text-[13px] dark:text-immich-dark-fg font-mono bottom-0"> </div>'),no=z('<div class="absolute end-3 bottom-0 h-1 w-1 rounded-full bg-gray-300"></div>'),ao=z("<!> <!>",1),lo=z('<div class="relative" data-id="time-segment"><!></div>'),co=z('<div tabindex="0" role="scrollbar" aria-controls="time-label" data-id="scrubber" class="absolute end-0 z-1 select-none hover:cursor-row-resize" draggable="false"><!> <!> <!> <div class="relative" data-id="lead-in"></div> <!> <div data-id="lead-out" class="relative"></div></div>');function uo(c,t){Gt(t,!0);let s=W(t,"timelineTopOffset",3,0),i=W(t,"timelineBottomOffset",3,0),o=W(t,"height",3,0),l=W(t,"timelineScrollPercent",3,0),h=W(t,"viewportTopMonthScrollPercent",3,0),m=W(t,"viewportTopMonth",3,void 0),A=W(t,"onScrub",3,void 0),n=W(t,"onScrubKeyDown",3,void 0),I=W(t,"startScrub",3,void 0),x=W(t,"stopScrub",3,void 0),C=W(t,"scrubberWidth",15),G=v(!1),y=v(!1),O=v(!1),N=v(!1),$=v(0),F=0,V=v(0),E=v(void 0);const Y=r=>r*(o()-(e(P)+e(j))),K=r=>r/(o()-(e(P)+e(j))),w=S(()=>Be.pointerCoarse),L=20,g=60,T=31.75,P=S(()=>e(w)?25:T),j=S(()=>e(w)?25:10),nt=16,pt=8,at=S(()=>e(y)?"100vw":e(w)?t.timelineManager.scrolling?L+"px":"0px":g+"px");gt(()=>{C(e(w)?L:g)});const dt=(r,a,u)=>{if(r==="lead-in")return e(vt)*a;if(r==="lead-out"){let f=e(vt);for(const b of e(q))f+=b.height;return f+e(Ut)*a}else if(r){let f=e(vt),b=!1;for(const p of e(q)){if(p.month===r.month&&p.year===r.year){f+=a*p.height,b=!0;break}f+=p.height}return b||(f+=a*e(Ut)),f}else return u*(o()-(e(P)+e(j)))},R=S(()=>dt(m(),h(),l())),_t=S(()=>t.timelineManager.scrubberTimelineHeight),vt=S(()=>Y(s()/e(_t))),Ut=S(()=>Y(i()/e(_t))),zt=r=>{let a=0,u=0,f=[],b,p=0;const M=[...r].reverse();for(const D of M){const k=D.height/e(_t),_={top:p,count:D.assetCount,height:Y(k),dateFormatted:D.title,year:D.year,month:D.month,hasLabel:!1,hasDot:!1};p+=_.height,b?(b.year!==_.year&&a>nt&&(a=0,_.hasLabel=!0,b=_),_.height>5&&u>pt&&(_.hasDot=!0,u=0)):(_.hasDot=!0,_.hasLabel=!0,b=_),a+=_.height,u+=_.height,f.push(_)}return f.reverse(),f};let yt=v(void 0);const q=S(()=>zt(t.timelineManager.scrubberMonths)),wt=S(()=>e(O)?e(q).at(0)?.dateFormatted:e(N)?e(q).at(-1)?.dateFormatted:e(yt)?.dataset.label),Et=S(()=>{if(e(yt)?.dataset.id==="lead-in")return"lead-in";if(e(yt)?.dataset.id==="lead-out")return"lead-out";if(!e(yt)?.dataset.segmentYearMonth)return;const[r,a]=e(yt).dataset.segmentYearMonth.split("-").map(Number);return{year:r,month:a}}),st=S(()=>{const r=e(R);let a=e(vt);for(const u of e(q)){if(r<a+u.height)return u;a+=u.height}return null}),xt=S(()=>{if(e(R)!==void 0){if(e(R)<e(vt))return e(q).at(0)?.dateFormatted;{let r=e(vt);for(const a of e(q))r+=a.height;if(e(R)>r)return e(q).at(-1)?.dateFormatted}}return e(st)?.dateFormatted||""}),Nt=(r,a,...u)=>{if(u.length===0)return;const f=r.filter(p=>p instanceof HTMLElement&&p.dataset.id?u.includes(p.dataset.id):!1),b=[];for(const p of f){const M=p.getBoundingClientRect();if(M.y>a){b.push({element:p,boundingClientRect:M});continue}if(a<=M.y+M.height)return{element:p,boundingClientRect:M}}return b.at(0)},Me=(r,a)=>{const u=document.elementsFromPoint(r,a),f=Nt(u,a,"time-segment","lead-in","lead-out");if(f){const D=f.element,k=f.boundingClientRect,_=k.y,ft=(a-_)/k.height;return{isOnPaddingTop:!1,isOnPaddingBottom:!1,segment:D,monthGroupPercentY:ft}}const b=Nt(u,0,"scrubber");let p=!1,M=!1;if(b){const D=b.boundingClientRect;a<D.top+e(P)&&(p=!0),a>D.bottom-e(j)-1&&(M=!0)}return{isOnPaddingTop:p,isOnPaddingBottom:M,segment:void 0,monthGroupPercentY:0}},bt=r=>{const a=e(y);if(d(y,r.isDragging??e(y),!0),F=r.clientY,!e(E))return;const u=e(E).getBoundingClientRect(),f=0,b=u?.height-(e(P)+e(j));d($,Ve(F-u?.top-e(P),f,b),!0);const p=u.left+u.width/2,{segment:M,monthGroupPercentY:D,isOnPaddingTop:k,isOnPaddingBottom:_}=Me(p,F);d(yt,M,!0),d(O,k,!0),d(N,_,!0);const et={scrubberMonth:e(Et),overallScrollPercent:K(e($)),scrubberMonthScrollPercent:D};if(a===!1&&e(y)&&(I()?.(et),A()?.(et)),a&&!e(y)){x()?.(et);return}e(y)&&A()?.(et)},Yt=r=>r.touches.length===1?r.touches[0]:null,Kt=r=>{const a=Yt(r);if(!a){d(G,!1);return}const u=document.elementsFromPoint(a.clientX,a.clientY),f=Nt(u,0,"scrubber","time-label","lead-in","lead-out")!==void 0;d(G,f),f&&bt({clientY:a.clientY,isDragging:!0})},jt=()=>{e(G)&&d(G,!1),bt({clientY:F,isDragging:!1})},qt=r=>{const a=Yt(r);a&&e(y)?bt({clientY:a.clientY}):d(G,!1)};ee(()=>(document.addEventListener("touchmove",qt,{capture:!0,passive:!0}),()=>{document.removeEventListener("touchmove",qt,!0)})),ee(()=>(document.addEventListener("touchstart",Kt,{capture:!0,passive:!0}),document.addEventListener("touchend",jt,{capture:!0,passive:!0}),()=>{document.removeEventListener("touchstart",Kt,!0),document.removeEventListener("touchend",jt,!0)}));const Xt=r=>r?.key==="Tab",oe=r=>Xt(r)&&!r.shiftKey,re=r=>Xt(r)&&r.shiftKey,ne=r=>r?.key==="ArrowUp",ae=r=>r?.key==="ArrowDown",Ge=r=>{const a=oe(r),u=re(r);if(a||u){r.preventDefault();const f=hi(document.body);if(e(E)){const b=f.indexOf(e(E));if(b!==-1){let p;p=a?f[(b+1)%f.length]:f[(b-1)%f.length],p.focus()}}}},ct=r=>{if(Xt(r))return Ge(r),!0;if(ne(r)){let a;if(e(st)){const u=e(q).indexOf(e(st));a=u===-1?e(q).at(-2):e(q)[u-1]}else a=e(q).at(-2);if(a)return r.preventDefault(),A()?.({scrubberMonth:{year:a.year,month:a.month},overallScrollPercent:-1,scrubberMonthScrollPercent:0}),!0}if(ae(r)&&e(st)){const a=e(q).indexOf(e(st));if(a!==-1){const u=e(q)[a+1];if(u)return r.preventDefault(),A()?.({scrubberMonth:{year:u.year,month:u.month},overallScrollPercent:-1,scrubberMonthScrollPercent:0}),!0}}return!1},le=r=>{ct(r)||n()?.(r,r.currentTarget)};var X=co();rt("mousemove",_e,({clientY:r})=>(e(y)||e(G))&&bt({clientY:r})),rt("mousedown",_e,({clientY:r})=>e(G)&&bt({clientY:r,isDragging:!0})),rt("mouseup",_e,({clientY:r})=>bt({clientY:r,isDragging:!1})),X.__keydown=le;let Zt;var Jt=U(X);{var At=r=>{var a=to();let u;var f=U(a,!0);B(a),Q(()=>{Ht(a,1,Ie([{"border-b-2":e(y)},{"rounded-bl-md":!e(y)},"bg-light truncate opacity-85 pointer-events-none absolute end-0 min-w-20 max-w-64 w-fit rounded-ss-md border-b-2 border-primary py-1 px-1 text-sm font-medium shadow-[0_0_8px_rgba(0,0,0,0.25)] z-1"])),u=J(a,"",u,{top:`${e($)+2}px`}),kt(f,e(wt))}),H(r,a)};tt(Jt,r=>{!e(w)&&e(wt)&&(e(G)||e(y))&&r(At)})}var Qt=Z(Jt,2);{var ce=r=>{var a=so();let u;var f=U(a);we(f,{get icon(){return Je},size:"20",class:"-rotate-90 relative top-2.25 -end-0.5"});var b=Z(f,2);we(b,{get icon(){return Je},size:"20",class:"rotate-90 relative top-px -end-0.5"});var p=Z(b,2);{var M=D=>{var k=eo();J(k,"",{},{bottom:"10px",right:"36px",width:"fit-content"});var _=U(k,!0);B(k),Q(()=>kt(_,e(xt))),Lt(3,k,()=>pe,()=>({duration:200})),H(D,k)};tt(p,D=>{(t.timelineManager.scrolling&&e(xt)||e(G)||e(y))&&D(M)})}B(a),Q(()=>u=J(a,"",u,{top:`${e(P)+(e(R)-25)}px`,height:"50px",right:"0",position:"absolute"})),Lt(1,a,()=>pe,()=>({duration:200})),Lt(2,a,()=>pe,()=>({duration:200})),H(r,a)};tt(Qt,r=>{e(w)&&(t.timelineManager.scrolling&&e(xt)||e(G)||e(y))&&r(ce)})}var ue=Z(Qt,2);{var De=r=>{var a=oo();let u;var f=U(a);{var b=p=>{var M=io(),D=U(M,!0);B(M),Q(()=>kt(D,e(xt))),Lt(3,M,()=>pe,()=>({duration:200})),H(p,M)};tt(f,p=>{t.timelineManager.scrolling&&e(xt)&&!e(G)&&p(b)})}B(a),Q(()=>u=J(a,"",u,{top:`${e(R)+e(P)-2}px`})),H(r,a)};tt(ue,r=>{!e(w)&&!e(y)&&r(De)})}var Ot=Z(ue,2);let he;var $t=Z(Ot,2);Te($t,17,()=>e(q),r=>r.year+"-"+r.month,(r,a)=>{var u=lo();let f;var b=U(u);{var p=M=>{var D=ao(),k=ut(D);{var _=it=>{var lt=ro(),me=U(lt,!0);B(lt),Q(()=>kt(me,e(a).year)),H(it,lt)};tt(k,it=>{e(a).hasLabel&&it(_)})}var et=Z(k,2);{var ft=it=>{var lt=no();H(it,lt)};tt(et,it=>{e(a).hasDot&&it(ft)})}H(M,D)};tt(b,M=>{e(w)||M(p)})}B(u),Q(()=>{mt(u,"data-segment-year-month",e(a).year+"-"+e(a).month),mt(u,"data-label",e(a).dateFormatted),f=J(u,"",f,{height:e(a).height+"px"})}),H(r,u)});var de=Z($t,2);let fe;B(X),Fe(X,r=>d(E,r),()=>e(E)),Q((r,a,u,f)=>{mt(X,"aria-valuetext",e(wt)),mt(X,"aria-valuenow",e(R)+e(P)),mt(X,"aria-valuemax",r),mt(X,"aria-valuemin",a),Zt=J(X,"",Zt,{"padding-top":e(P)+"px","padding-bottom":e(j)+"px",width:e(at),height:o()+"px","background-color":(e(y),"transparent")}),mt(Ot,"data-label",u),he=J(Ot,"",he,{height:e(vt)+"px"}),mt(de,"data-label",f),fe=J(de,"",fe,{height:e(Ut)+"px"})},[()=>Y(1),()=>Y(0),()=>e(q).at(0)?.dateFormatted,()=>e(q).at(-1)?.dateFormatted]),ui("innerHeight",r=>d(V,r,!0)),rt("mouseenter",X,()=>d(G,!0)),rt("mouseleave",X,()=>d(G,!1)),Lt(3,X,()=>Vs,()=>({x:50,duration:250})),H(c,X),Dt()}cs(["keydown"]);function ho(c,t){Gt(t,!0);const s=()=>ht(Ke,"$t",l),i=()=>ht(m,"$viewingAsset",l),o=()=>ht(A,"$gridScrollTarget",l),[l,h]=Vt();let{asset:m,gridScrollTarget:A}=be,n=W(t,"invisible",15,!1),I=W(t,"withStacked",3,!1),x=W(t,"isShared",3,!1);const C=g=>Ps(()=>ke.getAsset({...Bt.params,id:g}),s()("error_retrieving_asset_information")),G=async g=>{const T=await t.timelineManager.getEarlierAsset(g);if(T)return C(T.id)},y=async g=>{const T=await t.timelineManager.getLaterAsset(g);if(T)return C(T.id)};let O=v(Rt({current:i(),previousAsset:void 0,nextAsset:void 0}));const N=async g=>{const[T,P]=await Promise.all([G(g),y(g)]);d(O,{current:g,nextAsset:T,previousAsset:P},!0)};gt(()=>{i(),Cs(()=>gs(N(i())))});const $=async()=>{const g=await t.timelineManager.getRandomAsset();if(g)return await ve({targetRoute:"current",assetId:g.id}),{id:g.id}},F=async g=>{n(!0),ds(A,{at:g.id}),await ve({targetRoute:"current",assetId:null,assetGridRouteSearchParams:o()})},V=async g=>{switch(g.type){case t.removeAction:case ot.TRASH:case ot.RESTORE:case ot.DELETE:case ot.ARCHIVE:case ot.SET_VISIBILITY_LOCKED:case ot.SET_VISIBILITY_TIMELINE:{t.timelineManager.removeAssets([g.asset.id]),await ss(e(O)?.nextAsset)||await ss(e(O)?.previousAsset)||await F(g.asset);break}}},E=g=>{switch(g.type){case ot.ARCHIVE:case ot.UNARCHIVE:case ot.ADD:{t.timelineManager.upsertAssets([g.asset]);break}case ot.STACK:{ye(t.timelineManager,{stack:g.stack,toDeleteIds:g.stack.assets.filter(T=>T.id!==g.stack.primaryAssetId).map(T=>T.id)});break}case ot.UNSTACK:{Ee(t.timelineManager,g.assets);break}case ot.REMOVE_ASSET_FROM_STACK:{t.timelineManager.upsertAssets([It(g.asset)]),g.stack&&(Ee(t.timelineManager,g.stack.assets.map(T=>It(T))),ye(t.timelineManager,{stack:g.stack,toDeleteIds:g.stack.assets.filter(T=>T.id!==g.stack?.primaryAssetId).map(T=>T.id)}));break}case ot.SET_STACK_PRIMARY_ASSET:{Ee(t.timelineManager,g.stack.assets.map(T=>It(T))),ye(t.timelineManager,{stack:g.stack,toDeleteIds:g.stack.assets.filter(T=>T.id!==g.stack.primaryAssetId).map(T=>T.id)});break}}},Y=async g=>{if(t.timelineManager.upsertAssets(g),g.length===0)return;const T=g[0],P=await ms({...Bt.params,id:T.id});be.setAsset(P),await ve({targetRoute:"current",assetId:T.id})},K=g=>{g.id===e(O).current.id&&N(g)};ee(()=>{const g=[Ft.on("on_upload_success",T=>K(T)),Ft.on("on_asset_update",T=>K(T))];return()=>{for(const T of g)T()}}),Ne(()=>{ke.invalidate()});var w=Tt(),L=ut(w);wi(L,()=>yi(()=>import("./7ZR7F41Y.js").then(g=>g.a),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99])),null,(g,T)=>{var P=S(()=>{var{default:at}=e(T);return{AssetViewer:at}}),j=S(()=>e(P).AssetViewer),nt=Tt(),pt=ut(nt);zs(pt,()=>e(j),(at,dt)=>{dt(at,{get withStacked(){return I()},get cursor(){return e(O)},get isShared(){return x()},get album(){return t.album},get person(){return t.person},onAssetChange:R=>{t.timelineManager?.upsertAssets([It(R)])},preAction:V,onAction:R=>{E(R),ke.invalidate()},onUndoDelete:Y,onRandom:$,onClose:F})}),H(g,nt)}),H(c,w),Dt(),h()}const ls=new Ai,fo=()=>{const c=document.activeElement;if(c&&c.dataset.thumbnailFocusContainer!==void 0)return c},mo=()=>ws(c=>c.dataset.thumbnailFocusContainer!==void 0,"next"),go=()=>ws(c=>c.dataset.thumbnailFocusContainer!==void 0,"previous"),po=c=>document.querySelector(c),qe=c=>{po(`[data-thumbnail-focus-container][data-asset="${c}"]`)?.focus()},vo=(c,t)=>{c(t)&&qe(t.id)},yo=async(c,t,s,i)=>{if(ls.isActive())return;const o=fo();if(!o)return s==="earlier"?mo():go();const l=ls.startInvocation(),h=o.dataset.asset;if(!o||!h){l.endInvocation();return}const m=s==="earlier"?await t.getEarlierAsset({id:h},i):await t.getLaterAsset({id:h},i);if(!l.isStillValid())return;if(!m){l.endInvocation();return}if(c(m)){if(await us(),!l.isStillValid())return;qe(m.id)}l.endInvocation()};var wo=z('<label class="immich-form-label" for="datetime"> </label>'),bo=z("<!> <!>",1);function Ao(c,t){Gt(t,!0);const s=()=>ht(Ke,"$t",i),[i,o]=Vt(),l=ie.now();let h=v(Rt(l.toFormat("yyyy-MM-dd'T'HH:mm:ss.SSS")));const m=S(()=>gi(e(h)));let A=S(()=>mi(l,void 0,e(m)));const n=async()=>{if(!e(I).isValid||!e(A)){t.onClose();return}const x=fi(e(h),e(A)),C=await t.timelineManager.getClosestAssetToDate(x.toObject());t.onClose(C)},I=S(()=>ie.fromISO(e(h),{zone:e(A)?.value,setZone:!0}));{let x=S(()=>s()("navigate_to_time")),C=S(()=>s()("confirm")),G=S(()=>!e(I).isValid||!e(A));Gi(c,{get title(){return e(x)},get icon(){return Us},onClose:()=>t.onClose(),onSubmit:n,get submitText(){return e(C)},get disabled(){return e(G)},size:"medium",children:(y,O)=>{Di(y,{fullWidth:!0,children:(N,$)=>{var F=bo(),V=ut(F);os(V,{fullWidth:!0,children:(Y,K)=>{var w=wo(),L=U(w,!0);B(w),Q(g=>kt(L,g),[()=>s()("date_and_time")]),H(Y,w)},$$slots:{default:!0}});var E=Z(V,2);os(E,{fullWidth:!0,children:(Y,K)=>{Mi(Y,{class:"immich-form-input text-gray-700 w-full",id:"datetime",type:"datetime-local",get value(){return e(h)},set value(w){d(h,w,!0)}})},$$slots:{default:!0}}),H(N,F)},$$slots:{default:!0}})},$$slots:{default:!0}})}Dt(),o()}function So(c,t){Gt(t,!0);const s=()=>ht(ii,"$showDeleteModal",o),i=()=>ht(h,"$showAssetViewer",o),[o,l]=Vt(),{isViewing:h}=be,m=async w=>{const L=w||!Si.value.trash,g=t.assetInteraction.selectedAssets;s()&&L&&!await Oe.show(pi,{size:g.length})||(await vi(L,T=>{t.timelineManager.removeAssets(T),Ue.emit("AssetsDelete",T)},g,L?void 0:T=>t.timelineManager.upsertAssets(T)),t.assetInteraction.clearMultiselect())},A=()=>{const w=t.assetInteraction.selectedAssets.some(L=>L.isTrashed);gs(m(w))},n=async()=>{const w=await ei(t.assetInteraction.selectedAssets);ye(t.timelineManager,w),t.onEscape?.()},I=async()=>{const w=t.assetInteraction.isAllArchived?es.Timeline:es.Archive,L=await si(t.assetInteraction.selectedAssets,w);t.timelineManager.update(L,g=>g.visibility=w),Ue.emit("AssetsArchive",L),C()};let x=v(!1);const C=()=>{ti(t.assetInteraction)},G=w=>{Ce.isSearchEnabled||w.key==="Shift"&&(w.preventDefault(),d(x,!0))},y=w=>{Ce.isSearchEnabled||w.key==="Shift"&&(w.preventDefault(),d(x,!1))},O=w=>{t.assetInteraction.selectionActive&&e(x)&&w.preventDefault()},N=S(()=>t.timelineManager.isInitialized&&t.timelineManager.months.length===0);let $=!1;const F=async()=>{$||($=!0,await Oe.show(_i,{}),$=!1)};gt(()=>{e(N)&&t.assetInteraction.clearMultiselect()});const V=yo.bind(void 0,t.scrollToAsset,t.timelineManager),E=vo.bind(void 0,t.scrollToAsset),Y=async()=>{const w=await Oe.show(Ao,{timelineManager:t.timelineManager});w&&E(w)},K=S(()=>{if(Ce.isSearchEnabled||i())return[];const w=[{shortcut:{key:"?",shift:!0},onShortcut:F},{shortcut:{key:"/"},onShortcut:()=>Ns(Ii.explore())},{shortcut:{key:"A",ctrl:!0},onShortcut:()=>$s(t.timelineManager,t.assetInteraction)},{shortcut:{key:"ArrowRight"},onShortcut:()=>V("earlier","asset")},{shortcut:{key:"ArrowLeft"},onShortcut:()=>V("later","asset")},{shortcut:{key:"D"},onShortcut:()=>V("earlier","day")},{shortcut:{key:"D",shift:!0},onShortcut:()=>V("later","day")},{shortcut:{key:"M"},onShortcut:()=>V("earlier","month")},{shortcut:{key:"M",shift:!0},onShortcut:()=>V("later","month")},{shortcut:{key:"Y"},onShortcut:()=>V("earlier","year")},{shortcut:{key:"Y",shift:!0},onShortcut:()=>V("later","year")},{shortcut:{key:"G"},onShortcut:Y}];return t.onEscape&&w.push({shortcut:{key:"Escape"},onShortcut:t.onEscape}),t.assetInteraction.selectionActive&&w.push({shortcut:{key:"Delete"},onShortcut:A},{shortcut:{key:"Delete",shift:!0},onShortcut:()=>m(!0)},{shortcut:{key:"D",ctrl:!0},onShortcut:()=>C()},{shortcut:{key:"s"},onShortcut:()=>n()},{shortcut:{key:"a",shift:!0},onShortcut:I}),w});rt("keydown",Wt,G),rt("keyup",Wt,y),rt("selectstart",Wt,O),hs(Wt,(w,L)=>bi?.(w,L),()=>e(K)),Dt(),l()}function To(c,t){Gt(t,!0);const s=[];ee(()=>{}),Ne(()=>{for(const i of s)i()}),Dt()}var Io=z('<div class="flex pt-7 pb-5 max-md:pt-5 max-md:pb-3 h-6 place-items-center text-xs font-medium text-immich-fg dark:text-immich-dark-fg md:text-sm"> </div>'),Mo=z('<div><!> <div class="animate-pulse h-full w-full svelte-1h33p3s" data-skeleton="true"></div></div>');function Go(c,t){let s=W(t,"height",3,0),i=W(t,"invisible",3,!1);var o=Mo();let l;var h=U(o);{var m=A=>{var n=Io(),I=U(n,!0);B(n),Q(()=>kt(I,t.title)),H(A,n)};tt(h,A=>{t.title&&A(m)})}Es(2),B(o),Q(()=>{Ht(o,1,Ie(["overflow-clip",{invisible:i()}]),"svelte-1h33p3s"),l=J(o,"",l,{height:s()+"px"})}),H(c,o)}var Do=z("<div><!></div>"),_o=z('<div class="month-group svelte-bi949n"><!></div>'),xo=z('<!> <!> <!> <section id="asset-grid" tabindex="-1"><section id="virtual-timeline"><section><!> <!></section> <!> <div></div></section></section> <!>',1);function Ar(c,t){Gt(t,!0);const s=()=>ht(V,"$gridScrollTarget",l),i=()=>ht($,"$showAssetViewer",l),o=()=>ht(F,"$viewingAsset",l),[l,h]=Vt();let m=W(t,"isSelectionMode",3,!1),A=W(t,"singleSelect",3,!1),n=W(t,"timelineManager",15),I=W(t,"removeAction",3,null),x=W(t,"withStacked",3,!1),C=W(t,"showArchiveIcon",3,!1),G=W(t,"isShared",3,!1),y=W(t,"albumUsers",19,()=>[]),O=W(t,"onSelect",3,()=>{}),N=W(t,"onEscape",3,()=>{});n(new Se),Ne(()=>n().destroy()),gt(()=>t.options&&void n().updateOptions(t.options));let{isViewing:$,asset:F,gridScrollTarget:V}=be,E=v(void 0),Y=v(void 0),K=v(!0),w=v(0),L=v(void 0),g=v(0),T=v(0);const P=S(()=>n().isInitialized&&n().months.length===0),j=S(()=>Be.maxMd),nt=S(()=>Be.pointerCoarse);gt(()=>{const r=e(j)?{rowHeight:100,headerHeight:32}:{rowHeight:235,headerHeight:48};n().setLayoutOptions(r)}),gt(()=>{n(n().scrollableElement=e(E),!0)});const pt=(r,a)=>a.findAssetAbsolutePosition(r),at=(r,a)=>{const u=pt(r,a);if(!u)return;n().updateSlidingWindow();const f=u.top,b=u.top+u.height,p=n().visibleWindow.top,M=n().visibleWindow.bottom;if(je(f,b,p,M))return;const D=e(E)?.scrollTop||0,k=M-p,_=f,et=Math.abs(_-D),ft=b-k,it=Math.abs(ft-D),lt=et<it?_:ft;n().scrollTo(lt)},dt=async r=>{try{n(n().isScrollingOnLoad=!0,!0);const a=await n().findMonthGroupForAsset({id:r});return a?(at(r,a),!0):!1}finally{n(n().isScrollingOnLoad=!1,!0)}},R=r=>{const a=n().getMonthGroupByAssetId(r.id);return a?(at(r.id,a),!0):!1},_t=async()=>{if(n().viewportHeight===0||n().viewportWidth===0){const u=e(E)?.getBoundingClientRect();u&&(n(n().viewportHeight=u.height,!0),n(n().viewportWidth=u.width,!0))}const r=s()?.at;let a=!1;r&&(a=await dt(r)),a?r&&(await us(),qe(r)):n().scrollTo(0),d(K,!1)};Ys(({from:r,to:a})=>{n(n().suspendTransitions=!0,!0),He(a),He(r)}),Ks(({complete:r})=>{r.finally(()=>{He($e),_t()})});const vt=()=>n(n().scrolling=!0,!0),Ut=({height:r})=>n(n().topSectionHeight=r,!0);ee(()=>{t.enableRouting||d(K,!1)});const zt=(r,a,u)=>{const f=r,b=n().maxScrollPercent,p=a*u,M=(f+p)*b;n().scrollTo(M)},yt=r=>{const{scrubberMonth:a,overallScrollPercent:u,scrubberMonthScrollPercent:f}=r,b=a==="lead-in",p=a==="lead-out";if(!a||n().limitedScroll){const k=n().maxScrollPercent*u*n().totalViewerHeight;n().scrollTo(k)}else if(b)zt(0,n().topSectionHeight,f);else if(p)zt(n().topSectionHeight+n().bodySectionHeight,n().bottomSectionHeight,f);else{const D=n().months.find(({yearMonth:{year:k,month:_}})=>k===a.year&&_===a.month);if(!D)return;zt(D.top,D.height,f)}},q=()=>{if(e(E))if(n().limitedScroll){const r=n().maxScroll;d(g,Math.min(1,e(E).scrollTop/r),!0),d(L,void 0),d(w,0)}else{d(g,0);let r=e(E).scrollTop,a=n().maxScrollPercent;const u=n().months.length;for(let f=-1;f<u+1;f++){let b,p=0;f===-1?(b="lead-in",p=n().topSectionHeight):f===u?(b="lead-out",p=n().bottomSectionHeight):(b=n().months[f].yearMonth,p=n().months[f].height);let M=r-p*a;if(M<-1&&b){d(L,b,!0),d(w,Math.max(0,r/(p*a)),!0),e(w)>.9999&&f+1<u-1&&(d(L,n().months[f+1].yearMonth,!0),d(w,0));break}r=M}}},wt=r=>{n().albumAssets.has(r.id)||t.assetInteraction.selectAsset(r)};let Et=v(null),st=v(!1);const xt=r=>{r.key==="Shift"&&(r.preventDefault(),d(st,!0))},Nt=r=>{r.key==="Shift"&&(r.preventDefault(),d(st,!1))},Me=r=>{r&&Kt(r),d(Et,r,!0)},bt=(r,a)=>{const u=r.groupTitle;if(t.assetInteraction.selectedGroup.has(u)){t.assetInteraction.removeGroupFromMultiselectGroup(u);for(const f of a)t.assetInteraction.removeAssetFromMultiselectGroup(f.id)}else{t.assetInteraction.addGroupToMultiselectGroup(u);for(const f of a)wt(f)}n().assetCount==t.assetInteraction.selectedAssets.length?xe.set(!0):xe.set(!1)},Yt=async r=>{if(!r)return;if(O()(r),A()){n().scrollTo(0);return}const a=t.assetInteraction.assetSelectionCandidates.length>0,u=t.assetInteraction.hasSelectedAsset(r.id);if(u){for(const f of t.assetInteraction.assetSelectionCandidates)t.assetInteraction.removeAssetFromMultiselectGroup(f.id);t.assetInteraction.removeAssetFromMultiselectGroup(r.id)}else{for(const f of t.assetInteraction.assetSelectionCandidates)wt(f);wt(r)}if(t.assetInteraction.clearAssetSelectionCandidates(),t.assetInteraction.assetSelectionStart&&a){let f=n().getMonthGroupByAssetId(t.assetInteraction.assetSelectionStart.id),b=n().getMonthGroupByAssetId(r.id);if(f===null||b===null)return;let p=!1;for(const M of n().months){if(M===b)break;if(p){await n().loadMonthGroup(M.yearMonth);for(const D of M.assetsIterator())u?t.assetInteraction.removeAssetFromMultiselectGroup(D.id):wt(D)}M===f&&(p=!0)}p=!1;for(const M of n().months){if(M===f&&(p=!0),p)for(const D of M.dayGroups){const k=D.groupTitle;D.getAssets().every(_=>t.assetInteraction.hasSelectedAsset(_.id))?t.assetInteraction.addGroupToMultiselectGroup(k):t.assetInteraction.removeGroupFromMultiselectGroup(k)}if(M===b)break}}t.assetInteraction.setAssetSelectionStart(u?null:r)},Kt=async r=>{if(!e(st))return;const a=t.assetInteraction.assetSelectionStart;if(!a)return;const u=Re(await n().retrieveRange(a,r));t.assetInteraction.setAssetSelectionCandidates(u)};gt(()=>{e(Et)||t.assetInteraction.clearAssetSelectionCandidates()}),gt(()=>{e(st)||t.assetInteraction.clearAssetSelectionCandidates()}),gt(()=>{e(st)&&e(Et)&&Kt(e(Et))}),gt(()=>{if(i()){const{localDateTime:r}=vs(o().fileCreatedAt,ie.local().offset/60);n().loadMonthGroup({year:r.year,month:r.month})}});const jt=(r,a,u,f)=>{Yt(a),u.filter(({id:p})=>t.assetInteraction.hasSelectedAsset(p)).length===u.length?t.assetInteraction.addGroupToMultiselectGroup(f):t.assetInteraction.removeGroupFromMultiselectGroup(f),xe.set(r.assetCount===t.assetInteraction.selectedAssets.length)},qt=(r,a,u,f)=>{if(m()||t.assetInteraction.selectionActive){jt(r,f,a,u);return}ve({targetRoute:"current",assetId:f.id})};var Xt={scrollAfterNavigate:_t},oe=xo();rt("keydown",Wt,xt),rt("keyup",Wt,Nt);var re=ut(oe);To(re,{onAfterUpdate:()=>{const r=$e.url.searchParams.get("at");r&&ds(V,{at:r}),_t()},onBeforeUpdate:r=>{r.updates.some(u=>u.path.endsWith("Timeline.svelte"))&&n().destroy()}});var ne=Z(re,2);So(ne,{scrollToAsset:r=>R(r)??!1,get timelineManager(){return n()},get assetInteraction(){return t.assetInteraction},get onEscape(){return N()}});var ae=Z(ne,2);{var Ge=r=>{uo(r,{get timelineManager(){return n()},get height(){return n().viewportHeight},get timelineTopOffset(){return n().topSectionHeight},get timelineBottomOffset(){return n().bottomSectionHeight},get timelineScrollPercent(){return e(g)},get viewportTopMonthScrollPercent(){return e(w)},get viewportTopMonth(){return e(L)},onScrub:yt,onScrubKeyDown:a=>{a.preventDefault();let u=50;e(st)&&(u=500),a.key==="ArrowUp"?(u=-u,e(st)&&e(E)?.scrollBy({top:u,behavior:"smooth"})):a.key==="ArrowDown"&&e(E)?.scrollBy({top:u,behavior:"smooth"})},get scrubberWidth(){return e(T)},set scrubberWidth(a){d(T,a,!0)}})};tt(ae,r=>{n().months.length>0&&r(Ge)})}var ct=Z(ae,2);let le;var X=U(ct);let Zt,Jt;var At=U(X);let Qt;J(At,"",{},{position:"absolute",left:"0",right:"0"});var ce=U(At);se(ce,()=>t.children??We);var ue=Z(ce,2);{var De=r=>{var a=Tt(),u=ut(a);se(u,()=>t.empty??We),H(r,a)};tt(ue,r=>{e(P)&&r(De)})}B(At),hs(At,(r,a)=>js?.(r,a),()=>Ut);var Ot=Z(At,2);Te(Ot,17,()=>n().months,r=>r.viewId,(r,a)=>{const u=S(()=>e(a).intersecting),f=S(()=>e(a).top);var b=Tt(),p=ut(b);{var M=k=>{var _=Do();let et;var ft=U(_);Go(ft,{get invisible(){return e(K)},get height(){return e(a).height},get title(){return e(a).monthGroupTitle}}),B(_),Q(()=>et=J(_,"",et,{height:e(a).height+"px",position:"absolute",transform:`translate3d(0,${e(f)}px,0)`,width:"100%"})),H(k,_)},D=k=>{var _=Tt(),et=ut(_);{var ft=it=>{var lt=_o();let me;var Ms=U(lt);$i(Ms,{get assetInteraction(){return t.assetInteraction},get customThumbnailLayout(){return t.customThumbnailLayout},get singleSelect(){return A()},get monthGroup(){return e(a)},get manager(){return n()},onDayGroupSelect:bt,thumbnail:(Gs,ge)=>{let St=()=>ge?.().asset,Xe=()=>ge?.().position,te=()=>ge?.().dayGroup,Ds=()=>ge?.().groupIndex;const _s=S(()=>t.assetInteraction.hasSelectionCandidate(St().id)),xs=S(()=>t.assetInteraction.hasSelectedAsset(St().id)||n().albumAssets.has(St().id)),ks=S(()=>n().albumAssets.has(St().id));qs(Gs,{get showStackedIcon(){return x()},get showArchiveIcon(){return C()},get asset(){return St()},get albumUsers(){return y()},get groupIndex(){return Ds()},onClick:Ze=>{typeof t.onThumbnailClick=="function"?t.onThumbnailClick(Ze,n(),te(),qt):qt(n(),te().getAssets(),te().groupTitle,Ze)},onSelect:()=>{if(m()||t.assetInteraction.selectionActive){jt(n(),St(),te().getAssets(),te().groupTitle);return}Yt(St())},onMouseEvent:()=>Me(St()),get selected(){return e(xs)},get selectionCandidate(){return e(_s)},get disabled(){return e(ks)},get thumbnailWidth(){return Xe().width},get thumbnailHeight(){return Xe().height}})},$$slots:{thumbnail:!0}}),B(lt),Q(()=>me=J(lt,"",me,{height:e(a).height+"px",position:"absolute",transform:`translate3d(0,${e(f)}px,0)`,width:"100%"})),H(it,lt)};tt(et,it=>{e(u)&&it(ft)},!0)}H(k,_)};tt(p,k=>{e(a).isLoaded?k(D,!1):k(M)})}H(r,b)});var he=Z(Ot,2);let $t;B(X),Fe(X,r=>d(Y,r),()=>e(Y)),B(ct),Fe(ct,r=>d(E,r),()=>e(E));var de=Z(ct,2);di(de,{target:"body",children:(r,a)=>{var u=Tt(),f=ut(u);{var b=p=>{ho(p,{get timelineManager(){return n()},get removeAction(){return I()},get withStacked(){return x()},get isShared(){return G()},get album(){return t.album},get person(){return t.person},get invisible(){return e(K)},set invisible(M){d(K,M,!0)}})};tt(f,p=>{i()&&p(b)})}H(r,u)},$$slots:{default:!0}}),Q(()=>{Ht(ct,1,Ie(["scrollbar-hidden h-full overflow-y-auto outline-none",{"m-0":e(P)},{"ms-0":!e(P)}]),"svelte-bi949n"),le=J(ct,"",le,{"margin-right":(e(nt)?0:e(T))+"px"}),Zt=Ht(X,1,"",null,Zt,{invisible:e(K)}),Jt=J(X,"",Jt,{height:n().totalViewerHeight+"px"}),Qt=Ht(At,1,"",null,Qt,{invisible:e(K)}),$t=J(he,"",$t,{height:n().bottomSectionHeight+"px",position:"absolute",left:"0",right:"0",transform:`translate3d(0,${n().topSectionHeight+n().bodySectionHeight}px,0)`})}),rt("scroll",ct,()=>(q(),n().updateSlidingWindow(),vt())),Qe(ct,"clientHeight",r=>n(n().viewportHeight=r,!0)),Qe(ct,"clientWidth",r=>n(n().viewportWidth=r,!0)),H(c,oe);var fe=Dt(Xt);return h(),fe}export{Ar as T};
