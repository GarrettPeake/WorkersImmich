import"./DsnmJJEf.js";import{p as O,f as X,a as z,g as t,u as n,ad as Z,h as l,j as i,i as D,d as $,V as ee,t as E,s as te,c as M,r as G}from"./D0CSSuTl.js";import{c as se,a as x,f as _}from"./Bd1JH_Ov.js";import{i as T}from"./D8NIUdeB.js";import{q as ae,a1 as ie}from"./DUXNbmIP.js";import{I as re,cd as ne,S as oe,s as S,q as A}from"./D-UYCH9y.js";import{e as le}from"./BpCm29KX.js";import{d as q,p as ce,D as R}from"./CJGyQpNN.js";import{aQ as ue}from"./BP6NvnZ7.js";import{s as he}from"./C8vxa4mj.js";import{p as w,s as de,c as me,a as fe}from"./zonMEKN6.js";import{$ as ge}from"./DWQ0JXRY.js";function Me(s,e){O(e,!0);const a=n(()=>e.action.title),c=n(()=>e.action.icon),m=n(()=>Z(e.action.color,"secondary")),o=n(()=>e.action.onAction);var r=se(),u=X(r);{var g=h=>{re(h,{variant:"ghost",shape:"round",get color(){return t(m)},get icon(){return t(c)},get"aria-label"(){return t(a)},onclick:()=>t(o)(e.action)})};T(u,h=>{t(c)&&ae(e.action)&&h(g)})}x(s,r),z()}const L="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1";var ve=(s=>(s[s.LOAD_MEDIA=0]="LOAD_MEDIA",s[s.ACTIVE_SESSION=1]="ACTIVE_SESSION",s))(ve||{});class K{type=P.GCAST;#e=l(!1);get isAvailable(){return t(this.#e)}set isAvailable(e){i(this.#e,e,!0)}#t=l(!1);get isConnected(){return t(this.#t)}set isConnected(e){i(this.#t,e,!0)}#s=l(null);get currentTime(){return t(this.#s)}set currentTime(e){i(this.#s,e,!0)}#a=l(null);get duration(){return t(this.#a)}set duration(e){i(this.#a,e,!0)}#i=l(D(p.IDLE));get castState(){return t(this.#i)}set castState(e){i(this.#i,e,!0)}#r=l(null);get receiverName(){return t(this.#r)}set receiverName(e){i(this.#r,e,!0)}remotePlayer=null;session=null;currentMedia=null;currentUrl=null;async initialize(){const e=$(ce);if(!e||!e.cast.gCastEnabled)return this.isAvailable=!1,!1;const a=new Promise(r=>{if(this.isAvailable){r(!0);return}if(window.__onGCastApiAvailable=u=>{r(u)},!document.querySelector(`script[src="${L}"]`)){const u=document.createElement("script");u.src=L,document.body.append(u)}}),c=new Promise(r=>{setTimeout(()=>{r(!1)},q.fromObject({seconds:3}).toMillis())});if(this.isAvailable=await Promise.race([a,c]),!this.isAvailable)return!1;const m=cast.framework.CastContext.getInstance();return this.remotePlayer=new cast.framework.RemotePlayer,m.setOptions({receiverApplicationId:chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,autoJoinPolicy:chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}),m.addEventListener(cast.framework.CastContextEventType.SESSION_STATE_CHANGED,r=>this.onSessionStateChanged(r)),m.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,r=>this.onCastStateChanged(r)),new cast.framework.RemotePlayerController(this.remotePlayer).addEventListener(cast.framework.RemotePlayerEventType.ANY_CHANGE,r=>this.onRemotePlayerChange(r)),!0}async loadMedia(e,a,c=!1){if(!this.isAvailable||!this.isConnected||!this.session||this.currentUrl===e&&!c)return;const o=(await fetch(e,{method:"HEAD"})).headers.get("content-type");if(!o)throw new Error("No content type found for media url");const r=`${e}&sessionKey=${a}`,u=new chrome.cast.media.MediaInfo(r,o),g=new chrome.cast.media.LoadRequest(u),h=this.onMediaDiscovered.bind(this,0);return this.currentUrl=e,this.session.loadMedia(g,h,this.onError.bind(this))}play(){if(!this.currentMedia)return;const e=new chrome.cast.media.PlayRequest;this.currentMedia.play(e,()=>{},this.onError.bind(this))}pause(){if(!this.currentMedia)return;const e=new chrome.cast.media.PauseRequest;this.currentMedia.pause(e,()=>{},this.onError.bind(this))}seekTo(e){const a=new cast.framework.RemotePlayer,c=new cast.framework.RemotePlayerController(a);a.currentTime=e,c.seek()}disconnect(){this.session?.leave(()=>{this.session=null,this.castState=p.IDLE,this.isConnected=!1,this.receiverName=null},this.onError.bind(this))}onSessionStateChanged(e){switch(e.sessionState){case cast.framework.SessionState.SESSION_ENDED:{this.session=null;break}case cast.framework.SessionState.SESSION_RESUMED:case cast.framework.SessionState.SESSION_STARTED:{this.session=e.session.getSessionObj();break}}}onCastStateChanged(e){this.isConnected=e.castState===cast.framework.CastState.CONNECTED,this.receiverName=this.session?.receiver.friendlyName??null,e.castState===cast.framework.CastState.NOT_CONNECTED&&(this.currentMedia=null,this.currentUrl=null)}onRemotePlayerChange(e){switch(e.field){case"isConnected":{this.isConnected=e.value;break}case"remotePlayer":{this.remotePlayer=e.value;break}case"duration":{this.duration=e.value;break}case"currentTime":{this.currentTime=e.value;break}case"playerState":{this.castState=e.value;break}}}onError(e){console.error("Google Cast Error:",e)}onMediaDiscovered(e,a){this.currentMedia=a,e===0?this.castState=p.PLAYING:e===1&&(this.castState=a.playerState)}static async showCastDialog(){try{await cast.framework.CastContext.getInstance().requestSession()}catch{return}}}var p=(s=>(s.IDLE="IDLE",s.PLAYING="PLAYING",s.PAUSED="PAUSED",s.BUFFERING="BUFFERING",s))(p||{}),P=(s=>(s.GCAST="GCAST",s))(P||{});class ye{#e=l(D([]));get castDestinations(){return t(this.#e)}set castDestinations(e){i(this.#e,e,!0)}#t=n(()=>this.monitorConnectedDestination());get current(){return t(this.#t)}set current(e){i(this.#t,e)}#s=l(D([]));get availableDestinations(){return t(this.#s)}set availableDestinations(e){i(this.#s,e,!0)}#a=l(!1);get initialized(){return t(this.#a)}set initialized(e){i(this.#a,e,!0)}#i=n(()=>this.current?.isConnected??!1);get isCasting(){return t(this.#i)}set isCasting(e){i(this.#i,e)}#r=n(()=>this.current?.receiverName??null);get receiverName(){return t(this.#r)}set receiverName(e){i(this.#r,e)}#n=n(()=>this.current?.castState??null);get castState(){return t(this.#n)}set castState(e){i(this.#n,e)}#o=n(()=>this.current?.currentTime??null);get currentTime(){return t(this.#o)}set currentTime(e){i(this.#o,e)}#l=n(()=>this.current?.duration??null);get duration(){return t(this.#l)}set duration(e){i(this.#l,e)}sessionKey=null;constructor(){this.castDestinations=[new K],le.on({AppInit:()=>{this.initialize()}})}async initialize(){if(!this.initialized){this.initialized=!0;for(const e of this.castDestinations)await e.initialize()&&this.availableDestinations.push(e)}}monitorConnectedDestination(){return this.castDestinations.find(a=>a.isConnected)||null}isTokenValid(){return!this.sessionKey||!this.sessionKey.expiresAt?!1:R.fromISO(this.sessionKey.expiresAt).minus({seconds:10})>R.now()}async refreshSessionToken(){this.isTokenValid()||(this.sessionKey=await ue({sessionCreateDto:{duration:q.fromObject({minutes:15}).as("seconds"),deviceOS:"Google Cast",deviceType:"Cast"}}))}async loadMedia(e,a=!1){if(!this.current)throw new Error("No active cast destination");if(await this.refreshSessionToken(),!this.sessionKey)throw new Error("No session key available");await this.current.loadMedia(e,this.sessionKey.token,a)}play(){this.current?.play()}pause(){this.current?.pause()}seekTo(e){this.current?.seekTo(e)}disconnect(){this.current?.disconnect()}}let b;b=new ye;const Ge=s=>({Cast:{title:s("cast"),icon:b.isCasting?ne:oe,color:b.isCasting?"primary":"secondary",$if:()=>b.availableDestinations.length>0&&b.availableDestinations[0].type===P.GCAST,onAction:()=>{K.showCastDialog()}}});var Ce=_('<img draggable="false"/>'),be=_("<span> </span>"),ke=_("<figure><!> <!></figure>");function Re(s,e){O(e,!0);const a=()=>fe(ge,"$t",c),[c,m]=de();let o=w(e,"size",3,"full"),r=w(e,"interactive",3,!1),u=w(e,"noTitle",3,!1),g=w(e,"label",3,void 0),h=l(void 0),k=l(!0);const j=async()=>{try{await t(h)?.decode(),i(k,!1)}catch{i(k,!0)}},F={primary:"bg-primary text-light dark:text-light",pink:"bg-pink-400 text-light dark:text-dark",red:"bg-red-500 text-light dark:text-dark",yellow:"bg-yellow-500 text-light dark:text-dark",blue:"bg-blue-500 text-light dark:text-dark",green:"bg-green-600 text-light dark:text-dark",purple:"bg-purple-600 text-light dark:text-dark",orange:"bg-orange-600 text-light dark:text-dark",gray:"bg-gray-600 text-light dark:text-dark",amber:"bg-amber-600 text-light dark:text-dark"},U={full:"w-full h-full",sm:"w-7 h-7",md:"w-10 h-10",lg:"w-12 h-12",xl:"w-16 h-16",xxl:"w-24 h-24",xxxl:"w-28 h-28"};ee(()=>{t(h)&&e.user&&j().catch(console.error)});let H=n(()=>F[e.user.avatarColor]),B=n(()=>U[o()]),N=n(()=>g()??`${e.user.name} (${e.user.email})`),V=n(()=>r()?"border-2 border-immich-primary hover:border-immich-dark-primary dark:hover:border-immich-primary dark:border-immich-dark-primary transition-colors":"");var v=ke(),I=M(v);{var J=f=>{var d=Ce();let y;me(d,C=>i(h,C),()=>t(h)),E((C,Y)=>{S(d,"src",C),S(d,"alt",Y),y=A(d,1,"h-full w-full object-cover",null,y,{hidden:t(k)})},[()=>ie(e.user),()=>a()("profile_image_of_user",{values:{user:t(N)}})]),x(f,d)};T(I,f=>{e.user.profileImagePath&&f(J)})}var Q=te(I,2);{var W=f=>{var d=be();let y;var C=M(d,!0);G(d),E(()=>{y=A(d,1,"uppercase flex h-full w-full select-none items-center justify-center font-medium",null,y,{"text-xs":o()==="sm","text-lg":o()==="lg","text-xl":o()==="xl","text-2xl":o()==="xxl","text-3xl":o()==="xxxl"}),he(C,e.user.name[0]||"")}),x(f,d)};T(Q,f=>{t(k)&&f(W)})}G(v),E(()=>{A(v,1,`${t(B)??""} ${t(H)??""} ${t(V)??""} overflow-hidden shadow-md rounded-full`),S(v,"title",u()?void 0:t(N))}),x(s,v),z(),m()}export{Me as A,p as C,Re as U,b as c,Ge as g};
