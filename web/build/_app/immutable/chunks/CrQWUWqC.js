import"./DsnmJJEf.js";import{s as g,o as We}from"./C8vxa4mj.js";import{p as Be,b as je,s as n,t as f,a as ze,c as F,r as H,f as D,g as t,n as $,u as h,h as be,j as pe,i as Ie,aD as qe}from"./D0CSSuTl.js";import{i as ee}from"./D8NIUdeB.js";import{h as _e,e as Me}from"./DLePdI2u.js";import{a,f as B,c as we,t as k}from"./Bd1JH_Ov.js";import{p as ke,a as xe,s as Ue}from"./zonMEKN6.js";import{H as Ye}from"./Dmvn_pkP.js";import{O as Ve}from"./Cq6696VF.js";import{B as Z}from"./0qPXRVhz.js";import{e as oe}from"./BpCm29KX.js";import{Y as Ge,L as Le,u as Je,l as Ne}from"./DUXNbmIP.js";import{a as Qe}from"./WQ1yKytR.js";import{g as ge,$ as Fe}from"./DWQ0JXRY.js";import{n as Pe,o as ye,p as Ce,i as Se,q as Te,ac as Xe,K as Ze,a5 as et,a as se,aY as tt,T as x,B as at,aC as rt,cw as Ae,cx as st,cy as ot,cz as nt}from"./D-UYCH9y.js";import{b4 as He,M as Oe,b5 as it,V as lt}from"./BP6NvnZ7.js";import{m as Ee,H as ue}from"./BHTYC334.js";import{D as ve}from"./CJGyQpNN.js";import{C as Ke,b as Re,S as De}from"./Tw41aoDi.js";import{C as dt}from"./DCkJo5DD.js";import{s as ct}from"./CMI33r64.js";var ut=B('<div><div class="absolute flex h-full w-full items-center justify-center"><!></div> <div></div></div>');function mt(o,e){Be(e,!0);let l=ke(e,"shape",3,"round"),s=ke(e,"size",3,"medium"),q=ke(e,"color",3,"primary");const Y=Pe({base:"bg-light-100 dark:bg-light-200 dark:border-light-300 relative w-full overflow-hidden border",variants:{shape:ye.shape,size:{tiny:"h-3",small:"h-4",medium:"h-5",large:"h-6",giant:"h-12"},roundedSize:{tiny:"rounded-sm",small:"rounded-md",medium:"rounded-md",large:"rounded-lg",giant:"rounded-xl"}}}),J=Pe({base:"h-full transition-all duration-700 ease-in-out",variants:{color:ye.filledColor,shape:ye.shape}});var P=ut(),G=F(P),te=F(G);ct(te,()=>e.children??je),H(G);var O=n(G,2);H(P),f((E,N)=>{Te(P,1,E),Te(O,1,N),Xe(O,`width: ${e.progress*100}%`)},[()=>Ce(Se(Y({size:s(),shape:l(),roundedSize:l()==="semi-round"?s():void 0}),e.class)),()=>Ce(Se(J({color:q(),shape:l()})))]),a(o,P),ze()}const ft=(o,e)=>{const l={type:o("command"),title:o("download"),icon:et,onAction:()=>_t(e)},s={type:o("command"),title:o("delete"),icon:Ze,color:"danger",onAction:()=>vt(e)};return{Download:l,Delete:s}},pt=async o=>{const e=await ge();if(await Ee.showDialog({confirmText:e("restore"),title:e("admin.maintenance_restore_backup"),prompt:e("admin.maintenance_restore_backup_description")}))try{await He({setMaintenanceModeDto:{action:Oe.RestoreDatabase,restoreBackupFilename:o}})}catch(s){_e(s,e("admin.maintenance_start_error"))}},vt=async(...o)=>{const e=await ge();if(await Ee.showDialog({confirmText:e("delete"),title:e("admin.maintenance_delete_backup"),prompt:e("admin.maintenance_delete_backup_description")}))try{for(const s of o)oe.emit("BackupDeleteStatus",{filename:s,isDeleting:!0});await it({databaseBackupDeleteDto:{backups:o}});for(const s of o)oe.emit("BackupDeleted",{filename:s})}catch(s){_e(s,e("admin.maintenance_delete_error"));for(const q of o)oe.emit("BackupDeleteStatus",{filename:q,isDeleting:!1})}},_t=o=>{location.href=Le()+"/admin/database-backups/"+o},gt=async()=>{const o=await ge();try{const[e]=await Qe({multiple:!1}),l=new FormData;l.append("file",e),await Ge({url:Le()+"/admin/database-backups/upload",data:l,onUploadProgress(s){oe.emit("BackupUpload",{progress:s.loaded/s.total,isComplete:!1})}}),oe.emit("BackupUpload",{progress:1,isComplete:!0})}catch(e){_e(e,o("admin.maintenance_upload_backup_error"))}finally{oe.emit("BackupUpload",{progress:-1,isComplete:!1})}};var $t=B('<div class="flex items-center gap-2"><div class="w-1 h-1 bg-light-500"></div> <!></div>'),ht=B("<!> <!> <!>",1),kt=B("<!> <!>",1),yt=B("<!> <!>",1),bt=B('<div class="flex gap-1"><!> <!></div> <div class="flex gap-1"><!> <!></div>',1),wt=B('<div class="flex justify-between items-center gap-3"><!> <!></div> <!> <!> <!>',1),xt=B("<!> <!>",1);function Dt(o,e){Be(e,!0);const l=()=>xe(Ne,"$locale",q),s=()=>xe(Fe,"$t",q),[q,Y]=Ue(),J=h(()=>Je(e.filesize,1)),P=h(()=>{const c=e.filename.match(/\d+T\d+/);return c?ve.fromFormat(c[0],"yyyyMMdd'T'HHmmss",{zone:"utc"}).toLocal():null}),G=h(()=>t(P)?.toLocaleString(ve.TIME_SIMPLE)),te=h(()=>t(P)?.toRelative({locale:l()})),O=h(()=>e.filename.match(/-v(.*)-/)?.[1]),E=h(()=>t(O)?t(O)!==e.expectedVersion?Z.DifferentVersion:Z.OK:Z.UnknownVersion),N=h(()=>ft(s(),e.filename)),$e=h(()=>t(N).Download),m=h(()=>t(N).Delete);let U=be(!1);function ae(c){c.filename===e.filename&&pe(U,c.isDeleting,!0)}var y=xt(),z=D(y);Ve(z,{onBackupDeleteStatus:ae});var b=n(z,2);Ke(b,{class:"dark:bg-dark-900",children:(c,ne)=>{Re(c,{class:"pt-3 pb-4 px-6",children:(me,ie)=>{De(me,{gap:3,class:"grow min-w-0",children:(le,he)=>{var Q=wt(),p=D(Q),C=F(p);ue(C,{gap:2,class:"min-w-0",children:(i,M)=>{var v=ht(),d=D(v);{var _=r=>{se(r,{get icon(){return tt},size:"18",class:"text-success"})},A=r=>{var u=we(),ce=D(u);{var j=I=>{se(I,{get icon(){return Ae},size:"18",class:"text-warning"})},fe=I=>{se(I,{get icon(){return Ae},size:"18",class:"text-danger"})};ee(ce,I=>{t(E)===Z.DifferentVersion?I(j):I(fe,!1)},!0)}a(r,u)};ee(d,r=>{t(E)===Z.OK?r(_):r(A,!1)})}var L=n(d,2);{var w=r=>{x(r,{class:"font-medium",size:"small",children:(u,ce)=>{$();var j=k();f(()=>g(j,t(G))),a(u,j)},$$slots:{default:!0}})},X=r=>{x(r,{class:"font-medium",size:"small",children:(u,ce)=>{$();var j=k();f(fe=>g(j,fe),[()=>s()("unknown_date")]),a(u,j)},$$slots:{default:!0}})};ee(L,r=>{t(G)?r(w):r(X,!1)})}var W=n(L,2);{var de=r=>{var u=$t(),ce=n(F(u),2);x(ce,{size:"tiny",color:"muted",children:(j,fe)=>{$();var I=k();f(()=>g(I,t(te))),a(j,I)},$$slots:{default:!0}}),H(u),a(r,u)};ee(W,r=>{t(te)&&r(de)})}a(i,v)},$$slots:{default:!0}});var K=n(C,2);ue(K,{gap:1,children:(i,M)=>{var v=kt(),d=D(v);at(d,{size:"small",onclick:()=>pt(e.filename),get disabled(){return t(U)},children:(A,L)=>{$();var w=k();f(X=>g(w,X),[()=>s()("restore")]),a(A,w)},$$slots:{default:!0}});var _=n(d,2);{let A=h(()=>s()("open")),L=h(()=>[t($e),t(m)]);dt(_,{get disabled(){return t(U)},position:"top-right",get"aria-label"(){return t(A)},get items(){return t(L)}})}a(i,v)},$$slots:{default:!0}}),H(p);var V=n(p,2);ue(V,{children:(i,M)=>{var v=yt(),d=D(v);se(d,{get icon(){return rt},size:"16",color:"gray"});var _=n(d,2);x(_,{size:"small",class:"break-all font-mono",children:(A,L)=>{$();var w=k();f(()=>g(w,e.filename)),a(A,w)},$$slots:{default:!0}}),a(i,v)},$$slots:{default:!0}});var R=n(V,2);{var S=i=>{x(i,{size:"small",color:"danger",children:(M,v)=>{$();var d=k();f(_=>g(d,_),[()=>s()("admin.maintenance_restore_backup_unknown_version")]),a(M,d)},$$slots:{default:!0}})},T=i=>{var M=we(),v=D(M);{var d=_=>{x(_,{size:"small",color:"warning",children:(A,L)=>{$();var w=k();f(X=>g(w,X),[()=>s()("admin.maintenance_restore_backup_different_version")]),a(A,w)},$$slots:{default:!0}})};ee(v,_=>{t(E)===Z.DifferentVersion&&_(d)},!0)}a(i,M)};ee(R,i=>{t(E)===Z.UnknownVersion?i(S):i(T,!1)})}var re=n(R,2);ue(re,{gap:8,children:(i,M)=>{var v=bt(),d=D(v),_=F(d);x(_,{size:"tiny",color:"muted",children:(W,de)=>{$();var r=k();f(u=>g(r,`${u??""}:`),[()=>s()("version")]),a(W,r)},$$slots:{default:!0}});var A=n(_,2);x(A,{size:"tiny",fontWeight:"medium",children:(W,de)=>{$();var r=k();f(u=>g(r,u),[()=>t(O)?`v${t(O)}`:s()("unknown")]),a(W,r)},$$slots:{default:!0}}),H(d);var L=n(d,2),w=F(L);x(w,{size:"tiny",color:"muted",children:(W,de)=>{$();var r=k();f(u=>g(r,`${u??""}:`),[()=>s()("size")]),a(W,r)},$$slots:{default:!0}});var X=n(w,2);x(X,{size:"tiny",fontWeight:"medium",children:(W,de)=>{$();var r=k();f(()=>g(r,`${t(J)[0]??""} ${t(J)[1]??""}`)),a(W,r)},$$slots:{default:!0}}),H(L),a(i,v)},$$slots:{default:!0}}),a(le,Q)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),a(o,y),ze(),Y()}var Bt=B('<div class="flex justify-between items-center"><div class="flex gap-2 items-end w-max"><!> <!></div> <!></div>'),zt=B("<!> <!>",1),Mt=B('<div class="mt-5 mb-1"><div class="bg-primary-50 flex gap-2 px-4 py-2 rounded-xl w-max place-items-center"><!> <!></div></div> <!>',1),Pt=B("<!> <hr/> <!>",1),Ct=B("<!> <!>",1);function Zt(o,e){Be(e,!0);const l=()=>xe(Fe,"$t",s),[s,q]=Ue();let Y=be(Ie(e.backups??[]));async function J(){const m=await lt();pe(Y,m.backups,!0)}We(()=>{e.backups||J()});let P=be(-1);function G(m){pe(Y,t(Y).filter(U=>U.filename!==m.filename),!0)}function te(m){pe(P,m.progress,!0),m.isComplete&&J()}const O=h(()=>{const m=new Map,U=l()("unknown_date");for(const y of t(Y)){const z=y.filename.match(/\d+T\d+/);let b,c;z?(c=ve.fromFormat(z[0],"yyyyMMdd'T'HHmmss",{zone:"utc"}),b=c.toFormat("LLLL d, yyyy")):(c=ve.fromMillis(0),b=U),m.has(b)||m.set(b,{date:c.startOf("day"),backups:[]}),m.get(b).backups.push(y)}const ae=[...m.entries()].sort((y,z)=>y[0]===U?-1:z[0]===U?1:z[1].date.toMillis()-y[1].date.toMillis());return new Map(ae.map(([y,z])=>[y,z.backups]))});var E=Ct(),N=D(E);Ve(N,{onBackupDeleted:G,onBackupUpload:te});var $e=n(N,2);De($e,{gap:4,class:"mt-4 text-left",children:(m,U)=>{var ae=Pt(),y=D(ae);Ke(y,{color:"info",children:(b,c)=>{Re(b,{children:(ne,me)=>{var ie=we(),le=D(ie);{var he=p=>{var C=Bt(),K=F(C),V=F(K);se(V,{get icon(){return st},size:"20",class:"text-muted"});var R=n(V,2);x(R,{class:"grow",children:(T,re)=>{$();var i=k();f(M=>g(i,M),[()=>l()("admin.maintenance_upload_backup")]),a(T,i)},$$slots:{default:!0}}),H(K);var S=n(K,2);{let T=h(()=>({color:"primary",title:l()("select_from_computer"),onAction:gt}));Ye(S,{get action(){return t(T)}})}H(C),a(p,C)},Q=p=>{ue(p,{gap:8,children:(C,K)=>{var V=zt(),R=D(V);x(R,{class:"grow",children:(T,re)=>{$();var i=k();f(M=>g(i,M),[()=>l()("asset_uploading")]),a(T,i)},$$slots:{default:!0}});var S=n(R,2);mt(S,{get progress(){return t(P)},size:"tiny"}),a(C,V)},$$slots:{default:!0}})};ee(le,p=>{t(P)===-1?p(he):p(Q,!1)})}a(ne,ie)},$$slots:{default:!0}})},$$slots:{default:!0}});var z=n(y,4);Me(z,17,()=>[...t(O).entries()],([b,c])=>b,(b,c)=>{var ne=h(()=>qe(t(c),2));let me=()=>t(ne)[0],ie=()=>t(ne)[1];De(b,{gap:2,children:(le,he)=>{var Q=Mt(),p=D(Q),C=F(p),K=F(C);se(K,{get icon(){return ot},size:"18"});var V=n(K,2);x(V,{size:"small",fontWeight:"medium",color:"muted",children:(S,T)=>{$();var re=k();f(()=>g(re,me())),a(S,re)},$$slots:{default:!0}}),H(C),H(p);var R=n(p,2);Me(R,17,ie,S=>S.filename,(S,T)=>{Dt(S,{get filename(){return t(T).filename},get filesize(){return t(T).filesize},get expectedVersion(){return e.expectedVersion}})}),a(le,Q)},$$slots:{default:!0}})}),a(m,ae)},$$slots:{default:!0}}),a(o,E),ze(),q()}const ea=o=>({StartMaintenance:{title:o("admin.maintenance_start"),onAction:()=>St({action:Oe.Start}),icon:nt}}),St=async o=>{const e=await ge();try{await He({setMaintenanceModeDto:o})}catch(l){_e(l,e("admin.maintenance_start_error"))}};export{Zt as M,mt as P,ea as g,St as h};
