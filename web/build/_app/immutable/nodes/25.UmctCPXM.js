import{a as Wt,D as Gt,p as qt}from"../chunks/CJGyQpNN.js";import{g as Kt,$ as Fe}from"../chunks/DWQ0JXRY.js";import{K as pt,bf as Qt,E as ft,a6 as Jt,bg as Xt,bh as it,a5 as lt,T as Yt,n as Zt}from"../chunks/BP6NvnZ7.js";import"../chunks/DsnmJJEf.js";import{s as ee,e as er,d as _t,o as tt}from"../chunks/C8vxa4mj.js";import{p as Me,s as o,t as W,a as De,c as n,n as Pe,r as s,g as e,u as c,h as A,i as _e,f as pe,j as t,aD as tr,b as ct}from"../chunks/D0CSSuTl.js";import{i as R}from"../chunks/D8NIUdeB.js";import{B as Ge,q as Be,ac as ht,I as bt,d2 as rr,d3 as ar,F as St,G as wt,d4 as yt,a as sr,bb as or,bc as nr,ag as Pt,d5 as ir,s as lr,v as cr,cb as dt,ah as dr,aj as ur,d6 as gr}from"../chunks/D-UYCH9y.js";import{e as rt,t as $e,h as Ue}from"../chunks/DLePdI2u.js";import{t as xe,a as l,f as x,c as mr}from"../chunks/Bd1JH_Ov.js";import{a as Ze}from"../chunks/IOA7-Wrn.js";import{p as le,a as he,s as ze,c as vr}from"../chunks/zonMEKN6.js";import{g as Te,a as pr,i as fr}from"../chunks/gvLJu3l0.js";import{j as _r,p as hr}from"../chunks/DxRnQWdm.js";import{c as br}from"../chunks/jZIyHVjf.js";import{l as Sr}from"../chunks/BVcN3VUI.js";import{a as wr}from"../chunks/Bu1B-y_V.js";import{I as qe}from"../chunks/CLpfTz4o.js";import{P as xt}from"../chunks/D5KKc-uL.js";import{a as At}from"../chunks/Cc6nBHMJ.js";import{R as Re}from"../chunks/gegweU97.js";import{f as yr}from"../chunks/D3ODmHbk.js";import{q as et}from"../chunks/Tw41aoDi.js";import{C as Ke}from"../chunks/D-550RMt.js";import{x as We,l as Pr,a0 as xr}from"../chunks/DUXNbmIP.js";import{m as Et}from"../chunks/BHTYC334.js";import{s as ut}from"../chunks/CMI33r64.js";import{a as gt,g as D,Q as je,S as Ar}from"../chunks/0qPXRVhz.js";import{O as Er}from"../chunks/Cq6696VF.js";import{B as mt}from"../chunks/GXf5CvES.js";import{M as Cr}from"../chunks/B2VKg7zy.js";import{C as kr,A as vt}from"../chunks/BLnXPQ5q.js";import{F as Ir,A as Tr}from"../chunks/CQ8X2sVV.js";import{C as $r,a as Mr}from"../chunks/DmzJz26a.js";import{C as Dr,T as Nr}from"../chunks/Buf2v_0r.js";import{D as Lr}from"../chunks/DpocfqHG.js";import{D as Or}from"../chunks/vBkll8cH.js";import{S as Br}from"../chunks/C9R8P1Xg.js";import{S as Rr}from"../chunks/BL72B9yC.js";import{A as Ur}from"../chunks/CfdSAoAU.js";import{T as Fr}from"../chunks/BaHAZRvh.js";import"../chunks/CG4KAGH3.js";import{P as zr,g as Vr}from"../chunks/B0cikkZ0.js";import{A as Hr}from"../chunks/MMtgDOP-.js";import{C as jr}from"../chunks/DCkJo5DD.js";const Wr=(async({params:q,url:r})=>{await Wt(r);const[i,h]=await Promise.all([pt({id:q.personId}),Qt({id:q.personId})]),H=await Kt();return{person:i,statistics:h,meta:{title:i.name||H("person")}}}),gs=Object.freeze(Object.defineProperty({__proto__:null,load:Wr},Symbol.toStringTag,{value:"Module"}));var Gr=x('<div><!> <form class="ms-4 flex w-full justify-between gap-16" autocomplete="off"><!> <!></form></div>');function qr(q,r){Me(r,!0);const i=()=>he(Fe,"$t",h),[h,H]=ze();let f=le(r,"name",15),d=le(r,"suggestedPeople",15),g=le(r,"isSearchingPeople",15);const E=w=>{w.preventDefault(),r.onChange(f())};var M=Gr(),b=n(M);qe(b,{circle:!0,shadow:!0,get url(){return r.thumbnailData},get altText(){return r.person.name},widthStyle:"2rem",heightStyle:"2rem"});var N=o(b,2),S=n(N);xt(S,{type:"input",numberPeopleToSearch:5,inputClass:"w-full gap-2 bg-gray-100 dark:bg-gray-700 dark:text-white",get searchName(){return f()},set searchName(w){f(w)},get searchedPeopleLocal(){return d()},set searchedPeopleLocal(w){d(w)},get showLoadingSpinner(){return g()},set showLoadingSpinner(w){g(w)}});var u=o(S,2);Ge(u,{size:"small",shape:"round",type:"submit",children:(w,I)=>{Pe();var L=xe();W(O=>ee(L,O),[()=>i()("done")]),l(w,L)},$$slots:{default:!0}}),s(N),s(M),W(()=>Be(M,1,`flex w-full h-14 place-items-center ${d().length>0?"rounded-t-lg dark:border-immich-dark-gray":"rounded-lg"}  bg-gray-100 p-2 dark:bg-gray-700 border border-gray-200 dark:border-immich-dark-gray`)),er("submit",N,E),l(q,M),De(),H()}var Kr=x("<div></div>"),Qr=x('<span class="w-100 text-white-shadow absolute bottom-2 start-0 w-full text-ellipsis px-1 text-center font-medium text-white hover:cursor-pointer"> </span>'),Jr=x('<button type="button" class="relative rounded-lg transition-all"><div><!></div> <div></div> <!> <!></button>');function Qe(q,r){Me(r,!0);let i=le(r,"selectable",3,!1),h=le(r,"selected",3,!1),H=le(r,"thumbnailSize",3,null),f=le(r,"circle",3,!1),d=le(r,"border",3,!1),g=le(r,"onClick",3,()=>{});var E=Jr();E.__click=()=>g()(r.person);let M;var b=n(E);let N;var S=n(b);{let m=c(()=>We(r.person));qe(S,{get circle(){return f()},get url(){return e(m)},get altText(){return r.person.name},widthStyle:"100%",shadow:!0})}s(b);var u=o(b,2);let w;var I=o(u,2);{var L=m=>{var k=Kr();let K;W(()=>K=Be(k,1,"absolute start-0 top-0 h-full w-full bg-blue-500/80",null,K,{"rounded-full":f(),"rounded-lg":!f()})),l(m,k)};R(I,m=>{h()&&m(L)})}var O=o(I,2);{var y=m=>{var k=Qr(),K=n(k,!0);s(k),W(()=>ee(K,r.person.name)),l(m,k)};R(O,m=>{r.person.name&&m(y)})}s(E),W(()=>{E.disabled=!i(),M=ht(E,"",M,{width:H()?H()+"px":"100%",height:H()?H()+"px":"100%"}),N=Be(b,1,"h-full w-full border-2 brightness-90 filter",null,N,{"rounded-full":f(),"rounded-lg":!f(),"border-transparent":!d(),"dark:border-immich-dark-primary":d(),"border-immich-primary":d()}),w=Be(u,1,"absolute start-0 top-0 h-full w-full bg-immich-primary/30 opacity-0",null,w,{"hover:opacity-100":i(),"rounded-full":f(),"rounded-lg":!f()})}),l(q,E),De()}_t(["click"]);var Xr=x('<div class="w-40 sm:w-48 md:w-full h-14 flex gap-4 place-items-center"><div class="md:w-96"><!></div> <!></div> <div class="immich-scrollbar overflow-y-auto rounded-3xl bg-gray-200 p-10 dark:bg-immich-dark-gray mt-6"><div class="grid-col-2 grid gap-8 md:grid-cols-3 lg:grid-cols-6 xl:grid-cols-8 2xl:grid-cols-10"></div></div>',1);function Ct(q,r){Me(r,!0);const i=()=>he(Fe,"$t",h),[h,H]=ze();let f=A(_e([])),d=A(!1),g=A("");const E=c(()=>(e(g)?e(f):r.people).filter(y=>!r.peopleToNotShow.some(m=>m.id===y.id)));var M=Xr(),b=pe(M),N=n(b),S=n(N);{let y=c(()=>i()("search_people"));xt(S,{type:"searchBar",get placeholder(){return e(y)},get searchName(){return e(g)},set searchName(m){t(g,m,!0)},get searchedPeopleLocal(){return e(f)},set searchedPeopleLocal(m){t(f,m,!0)}})}s(N);var u=o(N,2);{var w=y=>{{let m=c(()=>i()("sort_people_by_similarity"));bt(y,{shape:"round",color:"secondary",variant:"ghost",get icon(){return rr},onclick:()=>{t(d,!e(d)),r.handleSearch(e(d))},get"aria-label"(){return e(m)}})}};R(u,y=>{r.handleSearch&&y(w)})}s(b);var I=o(b,2);let L;var O=n(I);rt(O,21,()=>e(E),y=>y.id,(y,m)=>{Qe(y,{get person(){return e(m)},onClick:()=>r.onSelect(e(m)),circle:!0,border:!0,selectable:!0})}),s(O),s(I),W(()=>L=ht(I,"",L,{"max-height":r.screenHeight-400+"px"})),l(q,M),De(),H()}var Yr=x("<!> <div></div>",1),Zr=x("<div><!></div>"),ea=x('<div class="absolute bottom-2"><!></div>'),ta=x('<div class="relative h-full"><div class="flex flex-col h-full justify-between"><div class="flex h-full items-center justify-center"><!></div> <!></div></div>'),ra=x('<section class="absolute start-0 top-0 h-full w-full bg-light"><!> <section class="px-17.5 pt-25"><section id="merge-face-selector"><div class="mb-10 h-50 place-content-center place-items-center"><p class="mb-4 text-center uppercase dark:text-white"> </p> <div class="grid grid-flow-col-dense place-content-center place-items-center gap-4"><!> <!> <!></div></div> <!></section></section></section>');function aa(q,r){Me(r,!0);const i=()=>he(Fe,"$t",h),[h,H]=ze();let f=le(r,"person",15),d=A(_e([])),g=A(_e([])),E=A(0),M=c(()=>e(g).length>0),b=c(()=>[...e(g),f()]);const N=async(v=!1)=>{const _=await ft({withHidden:!1,closestPersonId:v?f().id:void 0});t(d,_.people,!0)};tt(N);const S=async()=>{(v=>{var _=tr(v,2);f(_[0]),e(g)[0]=_[1]})([e(g)[0],f()]),await Te(Re.viewPerson(f(),{previousRoute:Re.people(),action:"merge"}))},u=async v=>{if(e(g).includes(v)){t(g,e(g).filter(_=>_.id!==v.id),!0);return}if(e(g).length>=5){$e.warning(i()("merge_people_limit"));return}t(g,[v,...e(g)],!0),e(g).length===1&&!f().name&&v.name&&await S()},w=async()=>{if(await Et.showDialog({prompt:i()("merge_people_prompt")}))try{let _=await Jt({id:f().id,mergePersonDto:{ids:e(g).map(({id:$})=>$)}});const U=await pt({id:f().id}),G=_.filter(({success:$})=>$).length;$e.success(i()("merged_people_count",{values:{count:G}})),r.onMerge(U)}catch(_){Ue(_,i()("cannot_merge_people"))}};var I=ra(),L=n(I);Ke(L,{get onClose(){return r.onBack},leading:U=>{var G=Yr(),$=pe(G);{var J=F=>{var z=xe();W(ne=>ee(z,ne),[()=>i()("selected_count",{values:{count:e(g).length}})]),l(F,z)},te=F=>{var z=xe();W(ne=>ee(z,ne),[()=>i()("merge_people")]),l(F,z)};R($,F=>{e(M)?F(J):F(te,!1)})}Pe(2),l(U,G)},trailing:U=>{{let G=c(()=>!e(M));Ge(U,{get leadingIcon(){return yt},size:"small",shape:"round",get disabled(){return e(G)},onclick:w,children:($,J)=>{Pe();var te=xe();W(F=>ee(te,F),[()=>i()("merge")]),l($,te)},$$slots:{default:!0}})}},$$slots:{leading:!0,trailing:!0}});var O=o(L,2),y=n(O),m=n(y),k=n(m),K=n(k,!0);s(k);var ce=o(k,2),ge=n(ce);rt(ge,25,()=>e(g),v=>v.id,(v,_,U,G)=>{var $=Zr(),J=n($);Qe(J,{border:!0,circle:!0,get person(){return e(_)},selectable:!0,thumbnailSize:120,onClick:()=>u(e(_))}),s($),ar($,()=>yr,()=>({duration:250,easing:et})),l(v,$)});var Ae=o(ge,2);{var de=v=>{var _=ta(),U=n(_),G=n(U),$=n(G);sr($,{get icon(){return or},size:"48",class:"rotate-90 dark:text-white"}),s(G);var J=o(G,2);{var te=F=>{var z=ea(),ne=n(z);{let p=c(()=>i()("swap_merge_direction"));bt(ne,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(p)},get icon(){return nr},size:"large",onclick:S})}s(z),l(F,z)};R(J,F=>{e(g).length===1&&F(te)})}s(U),s(_),l(v,_)};R(Ae,v=>{e(M)&&v(de)})}var T=o(Ae,2);Qe(T,{get person(){return f()},border:!0,circle:!0,selectable:!1,thumbnailSize:180}),s(ce),s(m);var Q=o(m,2);Ct(Q,{get people(){return e(d)},get peopleToNotShow(){return e(b)},get screenHeight(){return e(E)},onSelect:u,handleSearch:N}),s(y),s(O),s(I),W(v=>ee(K,v),[()=>i()("choose_matching_people_to_merge")]),At("innerHeight",v=>t(E,v,!0)),St(3,I,()=>wt,()=>({y:500,duration:100,easing:et})),l(q,I),De(),H()}var sa=x("<!> <div></div>",1),oa=x('<div class="flex gap-4"><!> <!></div>'),na=x('<div class="mb-10 h-50 place-content-center place-items-center"><p class="mb-4 text-center uppercase dark:text-white">Choose matching faces to re assign</p> <div class="grid grid-flow-col-dense place-content-center place-items-center gap-4"><!></div></div>'),ia=x('<section class="absolute start-0 top-0 h-full w-full bg-light"><!> <!> <section class="px-17.5 pt-25"><section id="merge-face-selector relative"><!> <!></section></section></section>');function la(q,r){Me(r,!0);const i=()=>he(Fe,"$t",h),[h,H]=ze();let f=A(_e([])),d=A(null),g=A(!1),E=A(!1),M=A(!1),b=A(!1),N=A(0),S=c(()=>e(d)?[r.personAssets,e(d)]:[r.personAssets]);const u=[];for(const T of r.assetIds)u.push({assetId:T,personId:r.personAssets.id});tt(async()=>{const T=await ft({withHidden:!1});t(f,T.people,!0)});const w=T=>{if(e(d)&&e(d).id===T.id){I();return}t(d,T,!0),t(b,!0)},I=()=>{t(d,null),t(b,!1)},L=async()=>{const T=setTimeout(()=>t(E,!0),gt);try{t(g,!0);const Q=await Xt({personCreateDto:{}});await it({id:Q.id,assetFaceUpdateDto:{data:u}}),$e.success(i()("reassigned_assets_to_new_person",{values:{count:r.assetIds.length}}))}catch(Q){Ue(Q,i()("errors.unable_to_reassign_assets_new_person"))}finally{clearTimeout(T)}t(E,!1),r.onConfirm()},O=async()=>{const T=setTimeout(()=>t(M,!0),gt);try{t(g,!0),e(d)&&(await it({id:e(d).id,assetFaceUpdateDto:{data:u}}),$e.success(i()("reassigned_assets_to_existing_person",{values:{count:r.assetIds.length,name:e(d).name||null}})))}catch(Q){Ue(Q,i()("errors.unable_to_reassign_assets_existing_person",{values:{name:e(d)?.name||null}}))}finally{clearTimeout(T)}t(M,!1),r.onConfirm()};var y=ia(),m=n(y);Ke(m,{get onClose(){return r.onClose},leading:v=>{var _=sa(),U=pe(_);ut(U,()=>r.header??ct),Pe(2),l(v,_)},trailing:v=>{var _=oa(),U=n(_);{let $=c(()=>i()("create_new_person_hint")),J=c(()=>e(g)||e(b));Ge(U,{shape:"round",get title(){return e($)},get leadingIcon(){return Pt},get loading(){return e(E)},size:"small",get disabled(){return e(J)},onclick:L,children:(te,F)=>{Pe();var z=xe();W(ne=>ee(z,ne),[()=>i()("create_new_person")]),l(te,z)},$$slots:{default:!0}})}var G=o(U,2);{let $=c(()=>i()("reassing_hint")),J=c(()=>e(g)||!e(b));Ge(G,{size:"small",shape:"round",get title(){return e($)},get leadingIcon(){return yt},get loading(){return e(M)},get disabled(){return e(J)},onclick:O,children:(te,F)=>{Pe();var z=xe();W(ne=>ee(z,ne),[()=>i()("reassign")]),l(te,z)},$$slots:{default:!0}})}s(_),l(v,_)},$$slots:{leading:!0,trailing:!0}});var k=o(m,2);ut(k,()=>r.merge??ct);var K=o(k,2),ce=n(K),ge=n(ce);{var Ae=T=>{var Q=na(),v=o(n(Q),2),_=n(v);Qe(_,{get person(){return e(d)},border:!0,circle:!0,selectable:!0,thumbnailSize:180,onClick:I}),s(v),s(Q),l(T,Q)};R(ge,T=>{e(d)!==null&&T(Ae)})}var de=o(ge,2);Ct(de,{get people(){return e(f)},get peopleToNotShow(){return e(S)},get screenHeight(){return e(N)},onSelect:w}),s(ce),s(K),s(y),At("innerHeight",T=>t(N,T,!0)),St(3,y,()=>wt,()=>({y:500,duration:100,easing:et})),l(q,y),De(),H()}var ca=x('<p class="text-sm text-gray-500 dark:text-gray-400"> </p>'),da=x('<div class="relative"><button type="button" class="flex items-center justify-center"><!> <div class="flex flex-col justify-center text-start px-4 text-primary"><p class="w-40 sm:w-72 font-medium truncate"> </p> <p class="text-sm text-gray-500 dark:text-gray-400"> </p> <!></div></button></div>'),ua=x('<div class="flex border h-14 rounded-b-lg border-gray-400 dark:border-immich-dark-gray place-items-center bg-gray-200 p-2 dark:bg-gray-700"><div class="flex w-full place-items-center"><!></div></div>'),ga=x('<button type="button"><!> <p class="ms-4 text-gray-700 dark:text-gray-100"> </p></button>'),ma=x("<div></div>"),va=x('<div class="absolute w-64 sm:w-96 z-1"><!></div>'),pa=x('<div class="relative w-fit p-4 sm:px-6 pt-12"><section class="flex w-64 sm:w-96 place-items-center border-black"><!></section> <!></div>'),fa=x("<!> <!>",1),_a=x("<!> <!> <!> <!> <!> <!> <!> <!> <!>",1),ha=x("<!> <!> <!> <!> <!>",1),ba=x("<!> <!>",1),Sa=x('<!> <main class="relative z-0 h-dvh overflow-hidden px-2 md:px-6 md:pt-(--navbar-height-md) pt-(--navbar-height)"><!></main> <header><!></header> <!> <!>',1);function ms(q,r){Me(r,!0);const i=()=>he(hr,"$page",d),h=()=>he(Fe,"$t",d),H=()=>he(Pr,"$locale",d),f=()=>he(qt,"$preferences",d),[d,g]=ze();let E=le(r,"data",7),M=c(()=>E().statistics.assets),b=A(void 0);const N=c(()=>({visibility:Zt.Timeline,personId:E().person.id})),S=new Hr;let u=A(_e(D.VIEW_ASSETS)),w=A(!1),I=A(_e(Re.explore())),L=A(void 0),O=A(void 0),y=A(_e([])),m=A(!1),k="",K=A(_e([])),ce=A(!1),ge=A(void 0);tt(()=>{const a=i().url.searchParams.get(je.ACTION),C=i().url.searchParams.get(je.PREVIOUS_ROUTE);return C&&!_r(C)&&t(I,C,!0),a=="merge"&&t(u,D.MERGE_PEOPLE,!0),xr.on("on_person_thumbnail",re=>{e(p).id===re&&t(Je,We(e(p),Date.now().toString()))})});const Ae=async()=>{if(S.selectionActive){S.clearMultiselect();return}await Te(e(I))},de=async()=>{await fr()};pr(({from:a})=>{a?.url&&a.route.id!==i().route.id&&t(I,a.url.href,!0)});const T=()=>{e(b).removeAssets(S.selectedAssets.map(a=>a.id)),S.clearMultiselect(),t(u,D.VIEW_ASSETS,!0)},Q=()=>{t(u,D.UNASSIGN_ASSETS,!0)},v=async a=>{await de(),await F(),E({...E(),person:a})},_=async a=>{if(e(u)===D.SELECT_PERSON){try{t(p,await lt({id:e(p).id,personUpdateDto:{featureFaceAssetId:a.id}})),$e.success(h()("feature_photo_updated"))}catch(C){Ue(C,h()("errors.unable_to_set_feature_photo"))}S.clearMultiselect(),t(u,D.VIEW_ASSETS,!0)}},U=async()=>{if(!e(L)||!e(O))return{merged:!1};const a=await Et.show(zr,{personToMerge:e(L),personToBeMergedInto:e(O),potentialMergePeople:e(y)});if(!a)return{merged:!1};const[,C]=a;return C.name!=k&&e(p).id===C.id?(await de(),{merged:!0}):(await Te(Re.viewPerson(C),{replaceState:!0}),{merged:!0})},G=async a=>{t(w,!1),e(p).id!==a.id&&(t(y,[],!0),k=e(p).name,t(L,e(p),!0),t(O,a,!0),t(m,!0),await U())},$=async()=>{if(t(u,D.VIEW_ASSETS,!0),e(p).name=k,t(w,!1),e(m)){t(m,!1);return}try{t(p,await lt({id:e(p).id,personUpdateDto:{name:k}})),$e.success(h()("change_name_successfully"))}catch(a){Ue(a,h()("errors.unable_to_save_name"))}},J=()=>{t(ce,!1),t(w,!1)},te=async a=>{if(t(w,!1),t(y,[],!0),k=a,e(p).name===k)return;if(a===""){await $();return}const C=await Yt({name:k,withHidden:!0}),re=C.find(({name:X,id:ae})=>X.toLowerCase()===k.toLowerCase()&&ae!==e(p).id&&X);if(re){t(O,re,!0),t(L,e(p),!0),t(y,C.filter(ae=>e(O)?.name.toLowerCase()===ae.name.toLowerCase()&&ae.id!==e(O).id&&ae.id!==e(L)?.id&&!ae.isHidden).slice(0,3),!0);const{merged:X}=await U();if(X)return}await $()},F=async()=>{t(u,D.VIEW_ASSETS,!0),i().url.searchParams.has(je.ACTION)&&(i().url.searchParams.delete(je.ACTION),await Te(i().url))},z=async a=>{e(b).removeAssets(a),await de()},ne=async a=>{e(b).upsertAssets(a),await de()};let p=c(()=>E().person),Je=c(()=>We(e(p)));const kt=a=>{e(b).removeAssets(a),S.clearMultiselect()},It=async a=>{if(a.id===e(p).id){if(a.isHidden){await Te(e(I));return}t(p,a)}},Ne=c(()=>Vr(h(),e(p))),Tt=c(()=>e(Ne).SetDateOfBirth),$t=c(()=>e(Ne).Favorite),Mt=c(()=>e(Ne).Unfavorite),Dt=c(()=>e(Ne).HidePerson),Nt=c(()=>e(Ne).ShowPerson),Lt={title:h()("select_featured_photo"),icon:gr,onAction:()=>{t(u,D.SELECT_PERSON,!0)}},Ot={title:h()("merge_people"),icon:dt,onAction:()=>{t(u,D.MERGE_PEOPLE,!0)}};var at=Sa(),st=pe(at);Er(st,{onPersonUpdate:It,onAssetsDelete:de,onAssetsArchive:de});var Ve=o(st,2),Bt=n(Ve);ir(Bt,()=>e(p).id,a=>{{let C=c(()=>e(u)===D.SELECT_PERSON),re=c(()=>e(u)===D.SELECT_PERSON);Fr(a,{enableRouting:!0,get person(){return e(p)},get options(){return e(N)},get assetInteraction(){return S},get isSelectionMode(){return e(C)},get singleSelect(){return e(re)},onSelect:_,onEscape:Ae,get timelineManager(){return e(b)},set timelineManager(X){t(b,X,!0)},children:(X,ae)=>{var be=mr(),se=pe(be);{var Ee=me=>{var j=pa(),Y=n(j),Le=n(Y);{var Se=V=>{qr(V,{get person(){return e(p)},get name(){return e(p).name},onChange:te,get thumbnailData(){return e(Je)},get suggestedPeople(){return e(K)},set suggestedPeople(B){t(K,B,!0)},get isSearchingPeople(){return e(ce)},set isSearchingPeople(B){t(ce,B,!0)}})},we=V=>{var B=da(),ve=n(B);ve.__click=()=>t(w,!0);var ye=n(ve);qe(ye,{circle:!0,shadow:!0,get url(){return e(Je)},get altText(){return e(p).name},widthStyle:"3.375rem",heightStyle:"3.375rem"});var ke=o(ye,2),Z=n(ke),oe=n(Z,!0);s(Z);var P=o(Z,2),ue=n(P,!0);s(P);var Oe=o(P,2);{var nt=ie=>{var fe=ca(),Ie=n(fe,!0);s(fe),W(Ye=>ee(Ie,Ye),[()=>h()("person_birthdate",{values:{date:Gt.fromISO(e(p).birthDate).toLocaleString({month:"numeric",day:"numeric",year:"numeric"},{locale:H()})}})]),l(ie,fe)};R(Oe,ie=>{e(p).birthDate&&ie(nt)})}s(ke),s(ve),s(B),W((ie,fe,Ie)=>{lr(ve,"title",ie),ee(oe,fe),ee(ue,Ie)},[()=>h()("edit_name"),()=>e(p).name||h()("add_a_name"),()=>h()("assets_count",{values:{count:e(M)}})]),l(V,B)};R(Le,V=>{e(w)?V(Se):V(we,!1)})}s(Y);var Ce=o(Y,2);{var He=V=>{var B=va(),ve=n(B);{var ye=Z=>{var oe=ua(),P=n(oe),ue=n(P);cr(ue,{}),s(P),s(oe),l(Z,oe)},ke=Z=>{var oe=ma();rt(oe,23,()=>e(K),P=>P.id,(P,ue,Oe,nt)=>{var ie=ga();ie.__click=()=>G(e(ue));var fe=n(ie);{let jt=c(()=>We(e(ue)));qe(fe,{circle:!0,shadow:!0,get url(){return e(jt)},get altText(){return e(ue).name},widthStyle:"2rem",heightStyle:"2rem"})}var Ie=o(fe,2),Ye=n(Ie,!0);s(Ie),s(ie),W(()=>{Be(ie,1,`flex w-full border border-gray-200 dark:border-immich-dark-gray h-14 place-items-center bg-gray-100 p-2 dark:bg-gray-700 hover:bg-gray-300 hover:dark:bg-[#232932] focus:bg-gray-300 focus:dark:bg-[#232932] ${e(Oe)===e(K).length-1?"rounded-b-lg border-b":""}`),ee(Ye,e(ue).name)}),l(P,ie)}),s(oe),vr(oe,P=>t(ge,P),()=>e(ge)),l(Z,oe)};R(ve,Z=>{e(ce)?Z(ye):Z(ke,!1)})}s(B),l(V,B)};R(Ce,V=>{e(w)&&V(He)})}s(j),Ze(j,(V,B)=>br?.(V,B),()=>({onOutclick:J,onEscape:J})),Ze(j,(V,B)=>Sr?.(V,B),()=>e(ge)),l(me,j)};R(se,me=>{e(u)===D.VIEW_ASSETS&&me(Ee)})}l(X,be)},$$slots:{default:!0}})}}),s(Ve),Ze(Ve,(a,C)=>wr?.(a,C),()=>({routeStartsWith:Re.people(),beforeClear:()=>{sessionStorage.removeItem(Ar.INFINITE_SCROLL_PAGE)}}));var Xe=o(Ve,2),Rt=n(Xe);{var Ut=a=>{Ur(a,{get assets(){return S.selectedAssets},clearSelect:()=>S.clearMultiselect(),children:(C,re)=>{var X=ha(),ae=pe(X);kr(ae,{});var be=o(ae,2);Br(be,{get timelineManager(){return e(b)},get assetInteraction(){return S}});var se=o(be,2);{let j=c(()=>h()("add_to"));mt(se,{get icon(){return Pt},get title(){return e(j)},children:(Y,Le)=>{var Se=fa(),we=pe(Se);vt(we,{});var Ce=o(we,2);vt(Ce,{shared:!0}),l(Y,Se)},$$slots:{default:!0}})}var Ee=o(se,2);Ir(Ee,{get removeFavorite(){return S.isAllFavorite},onFavorite:(j,Y)=>e(b).update(j,Le=>Le.isFavorite=Y)});var me=o(Ee,2);{let j=c(()=>h()("menu"));mt(me,{get icon(){return dr},get title(){return e(j)},children:(Y,Le)=>{var Se=_a(),we=pe(Se);{let P=c(()=>e(p).name||"immich");Or(we,{menuItem:!0,get filename(){return`${e(P)??""}.zip`}})}var Ce=o(we,2);{let P=c(()=>h()("fix_incorrect_match"));Cr(Ce,{get icon(){return dt},get text(){return e(P)},onClick:Q})}var He=o(Ce,2);$r(He,{menuItem:!0});var V=o(He,2);Dr(V,{menuItem:!0});var B=o(V,2);Mr(B,{menuItem:!0});var ve=o(B,2);Tr(ve,{menuItem:!0,get unarchive(){return S.isAllArchived},onArchive:(P,ue)=>e(b).update(P,Oe=>Oe.visibility=ue)});var ye=o(ve,2);{var ke=P=>{Nr(P,{menuItem:!0})};R(ye,P=>{f().tags.enabled&&S.isAllUserOwned&&P(ke)})}var Z=o(ye,2);Rr(Z,{menuItem:!0,onVisibilitySet:kt});var oe=o(Z,2);Lr(oe,{menuItem:!0,onAssetDelete:P=>z(P),onUndoDelete:P=>ne(P)}),l(Y,Se)},$$slots:{default:!0}})}l(C,X)},$$slots:{default:!0}})},Ft=a=>{var C=ba(),re=pe(C);{var X=se=>{Ke(se,{showBackButton:!0,get backIcon(){return ur},onClose:()=>Te(e(I)),trailing:me=>{{let j=c(()=>[Lt,e(Dt),e(Nt),e(Tt),Ot,e($t),e(Mt)]),Y=c(()=>h()("open"));jr(me,{get items(){return e(j)},get"aria-label"(){return e(Y)}})}},$$slots:{trailing:!0}})};R(re,se=>{e(u)===D.VIEW_ASSETS&&se(X)})}var ae=o(re,2);{var be=se=>{Ke(se,{onClose:()=>t(u,D.VIEW_ASSETS,!0),leading:me=>{Pe();var j=xe();W(Y=>ee(j,Y),[()=>h()("select_featured_photo")]),l(me,j)},$$slots:{leading:!0}})};R(ae,se=>{e(u)===D.SELECT_PERSON&&se(be)})}l(a,C)};R(Rt,a=>{S.selectionActive?a(Ut):a(Ft,!1)})}s(Xe);var ot=o(Xe,2);{var zt=a=>{{let C=c(()=>S.selectedAssets.map(re=>re.id));la(a,{get assetIds(){return e(C)},get personAssets(){return e(p)},onClose:()=>t(u,D.VIEW_ASSETS,!0),onConfirm:T})}};R(ot,a=>{e(u)===D.UNASSIGN_ASSETS&&a(zt)})}var Vt=o(ot,2);{var Ht=a=>{aa(a,{get person(){return e(p)},onBack:F,onMerge:v})};R(Vt,a=>{e(u)===D.MERGE_PEOPLE&&a(Ht)})}l(q,at),De(),g()}_t(["click"]);export{ms as component,gs as universal};
