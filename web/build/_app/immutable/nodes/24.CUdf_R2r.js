import{a as ot}from"../chunks/CJGyQpNN.js";import{g as it,$ as Ue}from"../chunks/DWQ0JXRY.js";import{E as Re,aL as nt,a5 as xe,T as st,K as lt}from"../chunks/BP6NvnZ7.js";import"../chunks/DsnmJJEf.js";import{d as $e,s as de,e as De,o as dt}from"../chunks/C8vxa4mj.js";import{p as Le,g as e,V as ct,a as He,h as x,f as ee,c as v,b as ze,r as u,j as o,i as fe,$ as ut,s as S,n as Ge,t as Q,u as g}from"../chunks/D0CSSuTl.js";import{i as te}from"../chunks/D8NIUdeB.js";import{a as b,f as k,c as Ie,t as Qe}from"../chunks/Bd1JH_Ov.js";import{I as Te,w as pt,c7 as mt,B as qe,s as _e,c8 as vt,c9 as gt,ca as ft,a as Ke,ai as _t,_ as ht,cb as bt,ah as yt,ay as Pt,az as wt,cc as xt,$ as St,f as Et,r as It,F as Nt,G as Lt}from"../chunks/D-UYCH9y.js";import{a as Ne}from"../chunks/IOA7-Wrn.js";import{p as Je,c as Xe,a as ce,s as Be}from"../chunks/zonMEKN6.js";import{a as Ht}from"../chunks/Cc6nBHMJ.js";import{g as Ve}from"../chunks/gvLJu3l0.js";import{f as kt,p as Ot}from"../chunks/DxRnQWdm.js";import{f as Ct}from"../chunks/dsDpGkcL.js";import{s as Mt}from"../chunks/Bu1B-y_V.js";import{a as Ye}from"../chunks/BVZhy_zG.js";import{I as Ze}from"../chunks/CLpfTz4o.js";import{s as We}from"../chunks/CMI33r64.js";import{e as At,t as he,h as le}from"../chunks/DLePdI2u.js";import{f as A,Q as Se,S as Ee}from"../chunks/0qPXRVhz.js";import{l as et,x as tt,h as je,a0 as Dt}from"../chunks/DUXNbmIP.js";import{f as Tt}from"../chunks/DCmy867i.js";import{A as Ft}from"../chunks/C_T4m_n1.js";import{B as Rt}from"../chunks/GXf5CvES.js";import{R as be}from"../chunks/gegweU97.js";import{g as Ut,P as Bt}from"../chunks/B0cikkZ0.js";import{M as Fe}from"../chunks/B2VKg7zy.js";import{P as zt}from"../chunks/D5KKc-uL.js";import{U as Vt}from"../chunks/tK_U6--f.js";import{O as Wt}from"../chunks/Cq6696VF.js";import{q as jt}from"../chunks/Tw41aoDi.js";import{m as $t}from"../chunks/BHTYC334.js";const Gt=(async({url:U})=>{await ot(U);const a=await Re({withHidden:!0}),l=await it();return{people:a,meta:{title:l("people")}}}),Vr=Object.freeze(Object.defineProperty({__proto__:null,load:Gt},Symbol.toStringTag,{value:"Module"}));var Qt=k("<div><!></div>"),qt=k('<div class="w-full grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 xl:grid-cols-7 2xl:grid-cols-10 gap-1"></div>');function rt(U,a){Le(a,!0);let l=Je(a,"hasNextPage",3,void 0),p=x(void 0);const B=new IntersectionObserver(D=>{D.find(s=>s.target===e(p))?.isIntersecting&&a.loadNextPage()});ct(()=>{e(p)&&(B.disconnect(),B.observe(e(p)))});var N=qt();At(N,23,()=>a.people,D=>D.id,(D,P,s)=>{var h=Ie(),O=ee(h);{var y=E=>{var f=Qt(),F=v(f);We(F,()=>a.children??ze,()=>({person:e(P),index:e(s)})),u(f),Xe(f,m=>o(p,m),()=>e(p)),b(E,f)},T=E=>{var f=Ie(),F=ee(f);We(F,()=>a.children??ze,()=>({person:e(P),index:e(s)})),b(E,f)};te(O,E=>{l()&&e(s)===a.people.length-1?E(y):E(T,!1)})}b(D,h)}),u(N),b(U,N),He()}var Kt=k('<span class="absolute bottom-2 start-0 w-full select-text px-1 text-center font-medium text-white"> </span>'),Jt=k('<button type="button" class="group relative w-full h-full"><!> <!></button>'),Xt=k('<div class="fixed top-0 z-1 flex h-16 w-full items-center justify-between border-b bg-white p-1 dark:border-immich-dark-gray dark:bg-black dark:text-immich-dark-fg md:p-8"><div class="flex items-center"><!> <div class="flex gap-2 items-center"><p class="ms-2"> </p> <p class="text-sm text-gray-400 dark:text-gray-600"> </p></div></div> <div class="flex items-center justify-end"><div class="flex items-center md:me-4"><!> <!></div> <!></div></div> <div class="flex flex-wrap gap-1 p-2 pb-8 md:px-8 mt-16"><!></div>',1);function Yt(U,a){Le(a,!0);const l=()=>ce(Ue,"$t",B),p=()=>ce(et,"$locale",B),[B,N]=Be();let D=Je(a,"titleId",3,void 0),P=x(fe(A.SHOW_ALL)),s=x(!1);const h=c=>{const d={};for(const M of c)d[M.id]=M.isHidden;return d},O=c=>c===A.SHOW_ALL?A.HIDE_UNNANEMD:c===A.HIDE_UNNANEMD?A.HIDE_ALL:A.SHOW_ALL,y=()=>{o(P,O(e(P)),!0);for(const c of a.people)e(P)===A.HIDE_ALL?e(f)[c.id]=!0:e(P)===A.SHOW_ALL?e(f)[c.id]=!1:e(P)===A.HIDE_UNNANEMD&&!c.name&&(e(f)[c.id]=!0)},T=()=>o(f,h(a.people),!0),E=async()=>{o(s,!0);const c=a.people.filter(d=>d.isHidden!==e(f)[d.id]).map(d=>({id:d.id,isHidden:e(f)[d.id]}));try{if(c.length>0){const d=await nt({peopleUpdateDto:{people:c}}),M=d.filter(({success:W})=>W).length,H=d.length-M;H>0&&he.warning(l()("errors.unable_to_change_visibility",{values:{count:H}})),he.success(l()("visibility_changed",{values:{count:M}}))}for(const d of a.people)d.isHidden=e(f)[d.id];a.onClose()}catch(d){le(d,l()("errors.unable_to_change_visibility",{values:{count:c.length}}))}finally{o(s,!1)}};let f=x(fe(h(a.people))),F=g(()=>({[A.HIDE_ALL]:{icon:ft,label:l()("hide_all_people")},[A.HIDE_UNNANEMD]:{icon:gt,label:l()("hide_unnamed_people")},[A.SHOW_ALL]:{icon:vt,label:l()("show_all_people")}})),m=g(()=>e(F)[O(e(P))]);var L=Xt();Ne(ut,(c,d)=>Ye?.(c,d),()=>({shortcut:{key:"Escape"},onShortcut:a.onClose}));var C=ee(L),q=v(C),K=v(q);{let c=g(()=>l()("close"));Te(K,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(c)},get icon(){return pt},get onclick(){return a.onClose}})}var ue=S(K,2),z=v(ue),re=v(z,!0);u(z);var J=S(z,2),ae=v(J);u(J),u(ue),u(q);var oe=S(q,2),i=v(oe),ie=v(i);{let c=g(()=>l()("reset_people_visibility"));Te(ie,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(c)},get icon(){return mt},onclick:T})}var pe=S(ie,2);Te(pe,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return e(m).label},get icon(){return e(m).icon},onclick:y}),u(i);var ke=S(i,2);qe(ke,{get loading(){return e(s)},onclick:E,size:"small",children:(c,d)=>{Ge();var M=Qe();Q(H=>de(M,H),[()=>l()("done")]),b(c,M)},$$slots:{default:!0}}),u(oe),u(C);var ye=S(C,2),Oe=v(ye);rt(Oe,{get people(){return a.people},hasNextPage:!0,get loadNextPage(){return a.loadNextPage},children:(d,M)=>{let H=()=>M?.().person;const W=g(()=>e(f)[H().id]);var V=Jt();V.__click=()=>e(f)[H().id]=!e(W);var me=v(V);{let t=g(()=>tt(H()));Ze(me,{get hidden(){return e(W)},shadow:!0,get url(){return e(t)},get altText(){return H().name},widthStyle:"100%",hiddenIconClass:"text-white group-hover:text-black transition-colors",preload:!1})}var Ce=S(me,2);{var Me=t=>{var r=Kt(),n=v(r,!0);u(r),Q(()=>de(n,H().name)),b(t,r)};te(Ce,t=>{H().name&&t(Me)})}u(V),Q(t=>{_e(V,"aria-pressed",e(W)),_e(V,"aria-label",t)},[()=>H().name?l()("hide_named_person",{values:{name:H().name}}):l()("hide_person")]),b(d,V)},$$slots:{default:!0}}),u(ye),Q((c,d)=>{_e(z,"id",D()),de(re,c),de(ae,`(${d??""})`)},[()=>l()("show_and_hide_people"),()=>a.totalPeopleCount.toLocaleString(p())]),b(U,L),He(),N()}$e(["click"]);var Zt=k('<div class="absolute top-4 start-4"><!></div>'),er=k("<!> <!> <!> <!>",1),tr=k('<div class="absolute top-2 end-2 z-1"><!></div>'),rr=k('<div id="people-card" class="relative" role="group"><a draggable="false"><div class="w-full h-full rounded-xl brightness-95 filter"><!> <!></div></a> <!></div>');function ar(U,a){Le(a,!0);const l=()=>ce(Ue,"$t",p),[p,B]=Be();let N=x(!1);const D=g(()=>Ut(l(),a.person)),P=g(()=>e(D).SetDateOfBirth);var s=rr(),h=v(s),O=v(h),y=v(O);{let m=g(()=>tt(a.person));Ze(y,{shadow:!0,get url(){return e(m)},get altText(){return a.person.name},get title(){return a.person.name},widthStyle:"100%",circle:!0,preload:!1})}var T=S(y,2);{var E=m=>{var L=Zt(),C=v(L);Ke(C,{get icon(){return _t},size:"24",class:"text-white"}),u(L),b(m,L)};te(T,m=>{a.person.isFavorite&&m(E)})}u(O),u(h);var f=S(h,2);{var F=m=>{var L=tr(),C=v(L);{let q=g(()=>l()("show_person_options"));Rt(C,{buttonClass:"icon-white-drop-shadow",color:"secondary",size:"medium",variant:"filled",get icon(){return yt},get title(){return e(q)},children:(K,ue)=>{var z=er(),re=ee(z);{let i=g(()=>l()("hide_person"));Fe(re,{get onClick(){return a.onHidePerson},get icon(){return ht},get text(){return e(i)}})}var J=S(re,2);Ft(J,{get action(){return e(P)}});var ae=S(J,2);{let i=g(()=>l()("merge_people"));Fe(ae,{get onClick(){return a.onMergePeople},get icon(){return bt},get text(){return e(i)}})}var oe=S(ae,2);{let i=g(()=>a.person.isFavorite?Pt:wt),ie=g(()=>a.person.isFavorite?l()("unfavorite"):l()("to_favorite"));Fe(oe,{get onClick(){return a.onToggleFavorite},get icon(){return e(i)},get text(){return e(ie)}})}b(K,z)},$$slots:{default:!0}})}u(L),b(m,L)};te(f,m=>{e(N)&&m(F)})}u(s),Ne(s,(m,L)=>Tt?.(m,L),()=>({onFocusOut:()=>o(N,!1)})),Q(m=>_e(h,"href",m),[()=>be.viewPerson(a.person,{previousRoute:be.people()})]),De("mouseenter",s,()=>o(N,!0)),De("mouseleave",s,()=>o(N,!1)),De("focus",h,()=>o(N,!0)),b(U,s),He(),B()}var or=k('<div class="flex gap-2 items-center justify-center"><div class="hidden sm:block"><div class="w-40 lg:w-80 h-10"><!></div></div> <!></div>'),ir=k('<div class="p-2 rounded-xl hover:bg-gray-200 border-2 hover:border-immich-primary/50 hover:shadow-sm dark:hover:bg-immich-dark-primary/20 hover:dark:border-immich-dark-primary/25 border-transparent transition-all"><!> <input type="text" class=" bg-white dark:bg-immich-dark-gray border-gray-100 placeholder-gray-400 text-center dark:border-gray-900 w-full rounded-2xl mt-2 py-2 text-sm text-primary"/></div>'),nr=k('<div class="flex min-h-[calc(66vh-11rem)] w-full place-content-center items-center dark:text-white"><div class="flex flex-col content-center items-center text-center"><!> <p class="mt-5 text-3xl font-medium max-w-lg line-clamp-2 overflow-hidden"> </p></div></div>'),sr=k('<dialog open class="absolute start-0 top-0 h-full w-full bg-light" aria-modal="true" aria-labelledby="manage-visibility-title"><!></dialog>'),lr=k("<!> <!> <!>",1);function Wr(U,a){Le(a,!0);const l=()=>ce(Ot,"$page",N),p=()=>ce(Ue,"$t",N),B=()=>ce(et,"$locale",N),[N,D]=Be();let P=x(!1),s=x(""),h=x(""),O=x(1),y=x(fe(a.data.people.hasNextPage?2:null)),T=x(void 0),E=x(void 0),f=x(fe([])),F=x(null),m=x(fe([])),L=x(0),C=x(void 0);dt(()=>{const t=l().url.searchParams.get(Se.SEARCHED_PEOPLE);return t&&(o(s,t,!0),e(C)&&je(e(C).searchPeople(!0,e(s)))),Dt.on("on_person_thumbnail",r=>{for(const n of e(i))n.id===r&&(n.updatedAt=new Date().toISOString())})});const q=()=>new Promise(t=>{let r=sessionStorage.getItem(Ee.INFINITE_SCROLL_PAGE);if(r&&e(y)){let n=e(y),_=Number.parseInt(r)-e(y);_?je(Promise.all(Array.from({length:_}).map((w,X)=>Re({withHidden:!0,page:n+X}))).then(w=>{for(const X of w)o(i,e(i).concat(X.people));o(O,n+_-1),o(y,w.at(-1)?.hasNextPage?n+_:null,!0),t()})):t(),sessionStorage.removeItem(Ee.INFINITE_SCROLL_PAGE)}}),K=async()=>{if(e(y))try{const{people:t,hasNextPage:r}=await Re({withHidden:!0,page:e(y)});o(i,e(i).concat(t)),e(y)!==null&&o(O,e(y),!0),o(y,r?e(y)+1:null,!0)}catch(t){le(t,p()("errors.failed_to_load_people"))}},ue=async()=>{l().url.searchParams.get(Se.SEARCHED_PEOPLE)!==e(s)&&(l().url.searchParams.set(Se.SEARCHED_PEOPLE,e(s)),await Ve(l().url,{keepFocus:!0}))},z=async()=>{if(!e(F)||!e(T)||!e(E))return;const t=await $t.show(Bt,{personToMerge:e(T),personToBeMergedInto:e(E),potentialMergePeople:e(f)});if(!t){await d(e(T).id,e(h));return}const[r,n]=t,_=await lt({id:n.id});if(o(i,e(i).filter(w=>w.id!==r.id)),o(i,e(i).map(w=>w.id===n.id?_:w)),n.name!==e(h)&&e(F).id===n.id)try{await xe({id:n.id,personUpdateDto:{name:e(h)}});for(const w of e(i))if(w.id===n.id){w.name=e(h);break}he.success(p()("change_name_successfully"))}catch(w){le(w,p()("errors.unable_to_save_name"))}},re=async t=>{try{const r=await xe({id:t.id,personUpdateDto:{isHidden:!0}});o(i,e(i).map(n=>n.id===r.id?r:n)),he.success(p()("changed_visibility_successfully"))}catch(r){le(r,p()("errors.unable_to_hide_person"))}},J=async t=>{try{const r=await xe({id:t.id,personUpdateDto:{isFavorite:!t.isFavorite}});o(i,e(i).map(n=>n.id===r.id?r:n)),he.success(r.isFavorite?p()("added_to_favorites"):p()("removed_from_favorites"))}catch(r){le(r,p()("errors.unable_to_add_remove_favorites",{values:{favorite:t.isFavorite}}))}},ae=async t=>{await Ve(be.viewPerson(t,{previousRoute:be.people(),action:"merge"}))},oe=async()=>{await kt(Se.SEARCHED_PEOPLE,l().url)};let i=g(()=>a.data.people.people),ie=g(()=>e(i).filter(t=>!t.isHidden)),pe=g(()=>e(s)?e(m).length:a.data.people.total-a.data.people.hidden),ke=g(()=>e(s)?e(m):e(ie));const ye=t=>{o(F,t,!0),o(h,t.name,!0)},Oe=async(t,r)=>{try{if(t==r.name)return;if(t===""){await d(r.id,"");return}const n=await M(t,r.id);if(n){o(T,r,!0),o(E,n,!0),o(f,e(i).filter(_=>e(E)?.name.toLowerCase()===_.name.toLowerCase()&&_.id!==e(E).id&&_.id!==e(T)?.id&&!_.isHidden).slice(0,3),!0),await z();return}await d(r.id,t)}catch(n){le(n,p()("errors.unable_to_save_name"))}},c=t=>{t.target&&o(h,t.target.value,!0)},d=async(t,r)=>{await xe({id:t,personUpdateDto:{name:r}}),o(h,"")},M=async(t,r)=>(await st({name:t,withHidden:!0})).find(_=>_.name.toLowerCase()===t.toLowerCase()&&_.id!==r&&_.name),H=t=>{o(i,e(i).map(r=>r.id===t.id?t:r))};var W=lr(),V=ee(W);Wt(V,{onPersonUpdate:H});var me=S(V,2);{const t=w=>{var X=Ie(),Pe=ee(X);{var Ae=ve=>{var ge=or(),R=v(ge),j=v(R),ne=v(j);{let $=g(()=>p()("search_people"));Xe(zt(ne,{type:"searchBar",get placeholder(){return e($)},onReset:oe,onSearch:ue,get searchName(){return e(s)},set searchName(I){o(s,I,!0)},get searchedPeopleLocal(){return e(m)},set searchedPeopleLocal(I){o(m,I,!0)}}),I=>o(C,I,!0),()=>e(C))}u(j),u(R);var se=S(R,2);qe(se,{get leadingIcon(){return St},onclick:()=>o(P,!e(P)),size:"small",variant:"ghost",color:"secondary",children:($,I)=>{Ge();var G=Qe();Q(we=>de(G,we),[()=>p()("show_and_hide_people")]),b($,G)},$$slots:{default:!0}}),u(ge),b(ve,ge)};te(Pe,ve=>{e(i).length>0&&ve(Ae)})}b(w,X)};let r=g(()=>p()("people")),n=g(()=>e(pe)===0&&!e(s)?void 0:`(${e(pe).toLocaleString(B())})`),_=g(()=>[[Mt,{routeStartsWith:be.people(),beforeSave:()=>{e(O)&&sessionStorage.setItem(Ee.INFINITE_SCROLL_PAGE,e(O).toString())},beforeClear:()=>{sessionStorage.removeItem(Ee.INFINITE_SCROLL_PAGE)},beforeLoad:q}]]);Vt(me,{get title(){return e(r)},get description(){return e(n)},get use(){return e(_)},buttons:t,children:(w,X)=>{var Pe=Ie(),Ae=ee(Pe);{var ve=R=>{{const j=(se,$)=>{let I=()=>$?.().person;var G=ir(),we=v(G);ar(we,{get person(){return I()},onMergePeople:()=>ae(I()),onHidePerson:()=>re(I()),onToggleFavorite:()=>J(I())});var Y=S(we,2);It(Y),Y.__focusin=()=>ye(I()),Y.__focusout=()=>Oe(e(h),I()),Y.__input=Z=>c(Z),Ne(Y,(Z,at)=>Ye?.(Z,at),()=>({shortcut:{key:"Enter"},onShortcut:Z=>Z.currentTarget.blur()})),u(G),Q(Z=>{Et(Y,I().name),_e(Y,"placeholder",Z)},[()=>p()("add_a_name")]),b(se,G)};let ne=g(()=>!!e(y)&&!e(s));rt(R,{get people(){return e(ke)},get hasNextPage(){return e(ne)},loadNextPage:K,children:j,$$slots:{default:!0}})}},ge=R=>{var j=nr(),ne=v(j),se=v(ne);Ke(se,{get icon(){return xt},size:"3.5em"});var $=S(se,2),I=v($,!0);u($),u(ne),u(j),Q(G=>de(I,G),[()=>p()(e(s)?"search_no_people_named":"search_no_people",{values:{name:e(s)}})]),b(R,j)};te(Ae,R=>{e(pe)>0&&(!e(s)||e(m).length>0)?R(ve):R(ge,!1)})}b(w,Pe)},$$slots:{buttons:!0,default:!0}})}var Ce=S(me,2);{var Me=t=>{var r=sr(),n=v(r);Yt(n,{get totalPeopleCount(){return a.data.people.total},titleId:"manage-visibility-title",onClose:()=>o(P,!1),loadNextPage:K,get people(){return e(i)},set people(_){o(i,_)}}),u(r),Ne(r,_=>Ct?.(_)),Nt(3,r,()=>Lt,()=>({y:e(L),duration:150,easing:jt,opacity:0})),b(t,r)};te(Ce,t=>{e(P)&&t(Me)})}Ht("innerHeight",t=>o(L,t,!0)),b(U,W),He(),D()}$e(["focusin","focusout","input"]);export{Wr as component,Vr as universal};
