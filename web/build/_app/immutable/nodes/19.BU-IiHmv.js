import{Q as le}from"../chunks/0qPXRVhz.js";import{h as V,g as c,j as q,i as Z,p as de,f as w,u as p,c as F,a as ce,s as t,t as me,n as ue,r as C}from"../chunks/D0CSSuTl.js";import{e as fe}from"../chunks/BpCm29KX.js";import{T as he,j as ve}from"../chunks/DxfhPdFw.js";import{a3 as ge,a4 as J}from"../chunks/BP6NvnZ7.js";import{a as _e,p as Ae}from"../chunks/CJGyQpNN.js";import{g as pe,$ as be}from"../chunks/DWQ0JXRY.js";import"../chunks/DsnmJJEf.js";import{s as we}from"../chunks/C8vxa4mj.js";import{a as d,t as Pe,f as h}from"../chunks/Bd1JH_Ov.js";import{i as U}from"../chunks/D8NIUdeB.js";import{b as W}from"../chunks/Dgf_MdoC.js";import{s as Te,a as E}from"../chunks/zonMEKN6.js";import{a as ye,g as Se,i as $e}from"../chunks/gvLJu3l0.js";import{U as Fe,S as Ce,h as Ie}from"../chunks/tK_U6--f.js";import{B as K}from"../chunks/GXf5CvES.js";import{G as ke}from"../chunks/B6eBVnDA.js";import{B as xe,T as Be,a as De}from"../chunks/DdV_UXgK.js";import{C as ze,A as X}from"../chunks/BLnXPQ5q.js";import{F as Le,A as Oe}from"../chunks/CQ8X2sVV.js";import{A as Ue}from"../chunks/BmVzuLMt.js";import{C as je,a as He}from"../chunks/DmzJz26a.js";import{C as Ne,T as Me}from"../chunks/Buf2v_0r.js";import{D as Re}from"../chunks/DpocfqHG.js";import{D as Ge}from"../chunks/vBkll8cH.js";import{A as Qe}from"../chunks/CfdSAoAU.js";import{S as Ve}from"../chunks/DMMOBWd8.js";import{R as qe}from"../chunks/gegweU97.js";import{A as Je}from"../chunks/MMtgDOP-.js";import{e as I}from"../chunks/DUXNbmIP.js";import{t as We}from"../chunks/CF_nq223.js";import{b7 as Ee,b8 as Y,T as Ke,aS as Xe,I as Ye,a7 as Ze,ag as et,ah as tt}from"../chunks/D-UYCH9y.js";class at{#e=V(null);get folders(){return c(this.#e)}set folders(e){q(this.#e,e)}initialized=!1;#t=V(Z({}));get assets(){return c(this.#t)}set assets(e){q(this.#t,e,!0)}constructor(){fe.on({AuthLogout:()=>this.clearCache()})}async fetchTree(){return this.initialized?this.folders:(this.initialized=!0,this.folders=he.fromPaths(await ge()),this.folders.collapse(),this.folders)}bustAssetCache(){this.assets={}}async refreshAssetsByPath(e){return this.assets[e]=await J({path:e})}async fetchAssetsByPath(e){return this.assets[e]??=await J({path:e})}clearCache(){this.initialized=!1,this.assets={},this.folders=null}}const P=new at,rt=(async({url:T})=>{await _e(T);const[,e]=await Promise.all([P.fetchTree(),pe()]);let s=P.folders;const y=T.searchParams.get(le.PATH);y?s=s.traverse(y):y===null&&P.bustAssetCache();const k=s.hasAssets?await P.fetchAssetsByPath(s.path):null;return{tree:s,pathAssets:k,meta:{title:e("folders")}}}),Qt=Object.freeze(Object.defineProperty({__proto__:null,load:rt},Symbol.toStringTag,{value:"Module"}));var st=h('<!> <section><!> <div class="h-full"><!></div></section>',1),ot=h('<div class="mt-2"><!></div>'),it=h('<!> <section class="mt-2 h-[calc(100%-(--spacing(25)))] overflow-auto immich-scrollbar"><!> <!></section>',1),nt=h("<!> <!>",1),lt=h("<!> <!> <!> <!> <!> <!> <!> <hr/> <!>",1),dt=h("<!> <!> <!> <!> <!>",1),ct=h('<div class="fixed top-0 start-0 w-full"><!></div>'),mt=h("<!> <!>",1);function Vt(T,e){de(e,!0);const s=()=>E(be,"$t",k),y=()=>E(Ae,"$preferences",k),[k,ee]=Te(),z=Z({width:0,height:0}),o=new Je,te=a=>ae(ve(e.data.tree.path,a)),L=a=>qe.folders({path:a});ye(function(){I(o)});function ae(a){return Se(L(a),{keepFocus:!0,noScroll:!0})}async function x(){I(o),e.data.tree.path&&await P.refreshAssetsByPath(e.data.tree.path),await $e()}function re(){e.data.pathAssets&&o.selectAssets(e.data.pathAssets.map(a=>We(a)))}var j=mt(),H=w(j);Fe(H,{get title(){return e.data.meta.title},sidebar:v=>{Ce(v,{children:(B,S)=>{var b=st(),m=w(b);{let r=p(()=>`#${Ie}`),i=p(()=>s()("skip_to_folders"));Ve(m,{get target(){return c(r)},get text(){return c(i)},breakpoint:"md"})}var u=t(m,2),g=F(u);Ke(g,{class:"ps-4 mb-4",size:"small",children:(r,i)=>{ue();var n=Pe();me($=>we(n,$),[()=>s()("explorer")]),d(r,n)},$$slots:{default:!0}});var _=t(g,2),l=F(_);{let r=p(()=>({default:Xe,active:Y}));De(l,{get icons(){return c(r)},get tree(){return P.folders},get active(){return e.data.tree.path},getLink:L})}C(_),C(u),d(B,b)},$$slots:{default:!0}})},children:(v,B)=>{var S=it(),b=w(S);{let l=p(()=>s()("folders"));xe(b,{get node(){return e.data.tree},get icon(){return Ee},get title(){return c(l)},getLink:L})}var m=t(b,2),u=F(m);Be(u,{get items(){return e.data.tree.children},get icon(){return Y},onClick:te});var g=t(u,2);{var _=l=>{var r=ot(),i=F(r);ke(i,{get assets(){return e.data.pathAssets},get assetInteraction(){return o},get viewport(){return z},showAssetName:!0,pageHeaderOffset:54,onReload:x}),C(r),W(r,"clientHeight",n=>z.height=n),W(r,"clientWidth",n=>z.width=n),d(l,r)};U(g,l=>{e.data.pathAssets&&e.data.pathAssets.length>0&&l(_)})}C(m),d(v,S)},$$slots:{sidebar:!0,default:!0}});var se=t(H,2);{var oe=a=>{var v=ct(),B=F(v);Qe(B,{get assets(){return o.selectedAssets},clearSelect:()=>I(o),children:(S,b)=>{var m=dt(),u=w(m);ze(u,{});var g=t(u,2);{let i=p(()=>s()("select_all"));Ye(g,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return c(i)},get icon(){return Ze},onclick:re})}var _=t(g,2);{let i=p(()=>s()("add_to"));K(_,{get icon(){return et},get title(){return c(i)},children:(n,$)=>{var f=nt(),A=w(f);X(A,{onAddToAlbum:()=>I(o)});var D=t(A,2);X(D,{onAddToAlbum:()=>I(o),shared:!0}),d(n,f)},$$slots:{default:!0}})}var l=t(_,2);Le(l,{get removeFavorite(){return o.isAllFavorite},onFavorite(i,n){if(e.data.pathAssets&&e.data.pathAssets.length>0)for(const $ of i){const f=e.data.pathAssets.find(A=>A.id===$);f&&(f.isFavorite=n)}}});var r=t(l,2);{let i=p(()=>s()("menu"));K(r,{get icon(){return tt},get title(){return c(i)},children:(n,$)=>{var f=lt(),A=w(f);Ge(A,{menuItem:!0});var D=t(A,2);je(D,{menuItem:!0});var N=t(D,2);Ne(N,{menuItem:!0});var M=t(N,2);He(M,{menuItem:!0});var R=t(M,2);Oe(R,{menuItem:!0,get unarchive(){return o.isAllArchived},onArchive:x});var G=t(R,2);{var ie=O=>{Me(O,{menuItem:!0})};U(G,O=>{y().tags.enabled&&o.isAllUserOwned&&O(ie)})}var Q=t(G,2);Re(Q,{menuItem:!0,onAssetDelete:x,onUndoDelete:x});var ne=t(Q,4);Ue(ne,{}),d(n,f)},$$slots:{default:!0}})}d(S,m)},$$slots:{default:!0}}),C(v),d(a,v)};U(se,a=>{o.selectionActive&&a(oe)})}d(T,j),ce(),ee()}export{Vt as component,Qt as universal};
