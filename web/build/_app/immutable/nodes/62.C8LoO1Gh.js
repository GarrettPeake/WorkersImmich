import{s as Z}from"../chunks/D1613R3V.js";import{r as gt,R as P}from"../chunks/gegweU97.js";import{g as mt,$ as ft}from"../chunks/DWQ0JXRY.js";import"../chunks/DsnmJJEf.js";import{o as pt,s as j,e as ht}from"../chunks/C8vxa4mj.js";import{p as vt,a as _t,f as I,g as t,s as c,j as o,t as B,c as D,u as f,h as $,n as K,r as R}from"../chunks/D0CSSuTl.js";import{i as p}from"../chunks/D8NIUdeB.js";import{h as $t}from"../chunks/DN3LYAN4.js";import{a as h,c as bt,t as N,f as O}from"../chunks/Bd1JH_Ov.js";import{s as wt,a as yt}from"../chunks/zonMEKN6.js";import{g as k}from"../chunks/gvLJu3l0.js";import{A as xt}from"../chunks/aAP1iED5.js";import{e as Pt}from"../chunks/BpCm29KX.js";import{f as g}from"../chunks/oXVv5nIS.js";import{R as b}from"../chunks/DUXNbmIP.js";import{g as Q,h as Lt}from"../chunks/DLePdI2u.js";import{Y as At}from"../chunks/BP6NvnZ7.js";import{S as Mt}from"../chunks/Tw41aoDi.js";import{A as T}from"../chunks/B2XNhc0s.js";import{F as V}from"../chunks/BgQCgJ0_.js";import{I as kt}from"../chunks/s_2UW97Q.js";import{P as Tt}from"../chunks/BzOEcAd-.js";import{B as X}from"../chunks/D-UYCH9y.js";const Ot=(async({parent:S,url:w})=>(await S(),Z.value.isInitialized||gt(307,P.register()),{meta:{title:(await mt())("login")},continueUrl:w.searchParams.get("continue")||P.photos()})),lr=Object.freeze(Object.defineProperty({__proto__:null,load:Ot},Symbol.toStringTag,{value:"Module"}));var St=O('<form class="flex flex-col gap-4"><!> <!> <!> <!></form>'),zt=O('<div class="inline-flex w-full items-center justify-center my-4"><hr class="my-4 h-px w-3/4 border-0 bg-gray-200 dark:bg-gray-600"/> <span class="absolute start-1/2 -translate-x-1/2 bg-gray-50 px-3 font-medium text-gray-900 dark:bg-neutral-900 dark:text-white uppercase"> </span></div>'),Ct=O("<!> <!> <!>",1),Et=O("<!> <!> <!> <!>",1);function nr(S,w){vt(w,!0);const l=()=>yt(ft,"$t",tt),[tt,rt]=wt();let L=$(""),z=$(""),C=$(""),y=$(""),x=$(!1),d=$(!0);const A=f(()=>Z.value),U=async r=>{await k(w.data.continueUrl,{invalidateAll:!0}),Pt.emit("AuthLogin",r)},et=()=>k(P.changePassword()),E=()=>k(P.onboarding());pt(async()=>{if(!g.value.oauth){o(d,!1);return}if(b.isCallback(globalThis.location))try{const r=await b.login(globalThis.location);if(!r.isOnboarded){await E();return}await U(r);return}catch(r){console.error("Error [login-form] [oauth.callback]",r),o(y,Q(r)||l()("errors.unable_to_complete_oauth_login"),!0),o(d,!1);return}try{if(g.value.oauthAutoLaunch&&!b.isAutoLaunchDisabled(globalThis.location)||b.isAutoLaunchEnabled(globalThis.location)){await k(P.login({autoLaunch:0}),{replaceState:!0}),await b.authorize(globalThis.location);return}}catch(r){Lt(r,l()("errors.unable_to_connect"))}o(d,!1)});const at=async()=>{try{o(L,""),o(x,!0);const r=await At({loginCredentialDto:{email:t(z),password:t(C)}});if(r.isAdmin&&!t(A).isOnboarded){await E();return}if(!r.isAdmin&&r.shouldChangePassword){await et();return}if(!r.isOnboarded){await E();return}await U(r);return}catch(r){o(L,Q(r)||l()("errors.incorrect_email_or_password"),!0),o(x,!1);return}},ot=async()=>{o(d,!0),o(y,""),await b.authorize(globalThis.location)||(o(d,!1),o(y,l()("errors.unable_to_login_with_oauth"),!0))},st=async r=>{r.preventDefault(),await at()};xt(S,{get title(){return w.data.meta.title},children:(r,Ft)=>{Mt(r,{gap:4,children:(lt,jt)=>{var W=Et(),Y=I(W);{var nt=a=>{T(a,{color:"primary",class:"mb-6",children:(s,v)=>{var _=bt(),m=I(_);$t(m,()=>t(A).loginPageMessage),h(s,_)},$$slots:{default:!0}})};p(Y,a=>{t(A).loginPageMessage&&a(nt)})}var q=c(Y,2);{var it=a=>{var s=St(),v=D(s);{var _=e=>{T(e,{color:"danger",get title(){return t(L)},closable:!0})};p(v,e=>{t(L)&&e(_)})}var m=c(v,2);{let e=f(()=>l()("email"));V(m,{get label(){return t(e)},children:(n,i)=>{kt(n,{id:"email",name:"email",type:"email",autocomplete:"email",get value(){return t(z)},set value(u){o(z,u,!0)}})},$$slots:{default:!0}})}var M=c(m,2);{let e=f(()=>l()("password"));V(M,{get label(){return t(e)},children:(n,i)=>{Tt(n,{id:"password",autocomplete:"current-password",get value(){return t(C)},set value(u){o(C,u,!0)}})},$$slots:{default:!0}})}var F=c(M,2);X(F,{type:"submit",size:"large",shape:"round",fullWidth:!0,get loading(){return t(x)},class:"mt-6",children:(e,n)=>{K();var i=N();B(u=>j(i,u),[()=>l()("to_login")]),h(e,i)},$$slots:{default:!0}}),R(s),ht("submit",s,st),h(a,s)};p(q,a=>{!t(d)&&g.value.passwordLogin&&a(it)})}var G=c(q,2);{var ut=a=>{var s=Ct(),v=I(s);{var _=e=>{var n=zt(),i=c(D(n),2),u=D(i,!0);R(i),R(n),B(H=>j(u,H),[()=>l()("or")]),h(e,n)};p(v,e=>{g.value.passwordLogin&&e(_)})}var m=c(v,2);{var M=e=>{T(e,{color:"danger",get title(){return t(y)},closable:!0})};p(m,e=>{t(y)&&e(M)})}var F=c(m,2);{let e=f(()=>t(x)||t(d)),n=f(()=>t(x)||t(d)),i=f(()=>g.value.passwordLogin?"secondary":"primary");X(F,{shape:"round",get loading(){return t(e)},get disabled(){return t(n)},size:"large",fullWidth:!0,get color(){return t(i)},onclick:ot,children:(u,H)=>{K();var J=N();B(()=>j(J,t(A).oauthButtonText)),h(u,J)},$$slots:{default:!0}})}h(a,s)};p(G,a=>{g.value.oauth&&a(ut)})}var ct=c(G,2);{var dt=a=>{{let s=f(()=>l()("login_has_been_disabled"));T(a,{color:"warning",get title(){return t(s)}})}};p(ct,a=>{!g.value.passwordLogin&&!g.value.oauth&&a(dt)})}h(lt,W)},$$slots:{default:!0}})},$$slots:{default:!0}}),_t(),rt()}export{nr as component,lr as universal};
