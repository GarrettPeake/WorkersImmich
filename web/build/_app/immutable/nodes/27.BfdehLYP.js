import{a as ue}from"../chunks/CJGyQpNN.js";import{g as pe,$ as L}from"../chunks/DWQ0JXRY.js";import{ba as de,F as ge}from"../chunks/BP6NvnZ7.js";import"../chunks/DsnmJJEf.js";import{d as me,p as T,f as j,g as e,s as P,a as W,W as ee,u as l,c as g,r as p,n as ve,t as J,V as te,i as K,h as F,j as U}from"../chunks/D0CSSuTl.js";import{a as $,f as I,c as E}from"../chunks/Bd1JH_Ov.js";import{a as fe}from"../chunks/Cc6nBHMJ.js";import{p as V,a as z,s as q,f as _e}from"../chunks/zonMEKN6.js";import{U as he}from"../chunks/tK_U6--f.js";import{i as A}from"../chunks/D8NIUdeB.js";import{I as re,a_ as ye,a$ as xe,F as be,b2 as we,b4 as $e,G as Ge,a as oe,bR as ke,s as D,cN as Ce}from"../chunks/D-UYCH9y.js";import{D as Se}from"../chunks/GyRE5G4-.js";import{S as Oe}from"../chunks/C0GZEybY.js";import{ac as y,ad as Q,y as Be,l as Ne}from"../chunks/DUXNbmIP.js";import{d as Pe,s as H}from"../chunks/C8vxa4mj.js";import{e as ne}from"../chunks/DLePdI2u.js";import{n as ae}from"../chunks/CS-10t6W.js";import{R as ze}from"../chunks/gegweU97.js";import{g as Ie}from"../chunks/jIGarhcu.js";const Re=(async({url:n})=>{await ue(n);const t=await de(),a=await pe();return{items:t,meta:{title:a("places")}}}),gt=Object.freeze(Object.defineProperty({__proto__:null,load:Re},Symbol.toStringTag,{value:"Module"})),X=[{id:y.None,isDisabled:()=>!1},{id:y.Country,isDisabled:()=>!1}],le=n=>{const t=X[0];return X.find(({id:a})=>n===a)??t},ie=n=>{const t=y.None,a=n.groupBy??t;return le(a).isDisabled()?t:a},Y=n=>{n.collapsedGroups??={};const{collapsedGroups:t,groupBy:a}=n;return t[a]??=[],t[a]},Qe=(n,t)=>n.groupBy===y.None?!1:Y(n).includes(t),Ve=n=>{const t=me(Q);if(t.groupBy===y.None)return;const a=Y(t),d=a.indexOf(n);d===-1?a.push(n):a.splice(d,1),Q.set(t)},ce=n=>{Q.update(t=>{const a=Y(t);return a.length=0,a.push(...n),t})},Me=()=>{ce([])};var je=I('<span><div class="hidden xl:flex gap-0"><div class="block"><!></div> <div class="block"><!></div></div></span>'),Ae=I('<div class="hidden md:block h-10 xl:w-60 2xl:w-80"><!></div> <!> <!>',1);function Fe(n,t){T(t,!0);const a=()=>z(Q,"$placesViewSettings",O),d=()=>z(L,"$t",O),[O,w]=q();let x=V(t,"searchQuery",15);const f=({id:o})=>{_e(Q,ee(a).groupBy=o,ee(a))};let B=l(()=>e(b).id===y.None?we:$e),b=l(()=>le(a().groupBy)),G=l(()=>({[y.None]:d()("group_no"),[y.Country]:d()("group_country")}));var k=Ae(),C=j(k),_=g(C);{let o=l(()=>d()("search_places"));Oe(_,{get placeholder(){return e(o)},showLoadingSpinner:!1,get name(){return x()},set name(r){x(r)}})}p(C);var N=P(C,2);{let o=l(()=>d()("group_places_by")),r=l(()=>Object.values(X));Se(N,{position:"bottom-right",get title(){return e(o)},get options(){return e(r)},get selectedOption(){return e(b)},onSelect:f,render:({id:s,isDisabled:u})=>({title:e(G)[s],icon:e(B),disabled:u()})})}var h=P(N,2);{var m=o=>{var r=je(),s=g(r),u=g(s),v=g(u);{let S=l(()=>d()("expand_all")),R=l(()=>d()("expand_all"));re(v,{get title(){return e(S)},onclick:()=>Me(),variant:"ghost",color:"secondary",shape:"round",get icon(){return ye},get"aria-label"(){return e(R)}})}p(u);var i=P(u,2),c=g(i);{let S=l(()=>d()("collapse_all")),R=l(()=>d()("collapse_all"));re(c,{get title(){return e(S)},onclick:()=>ce(t.placesGroups),variant:"ghost",color:"secondary",shape:"round",get icon(){return xe},get"aria-label"(){return e(R)}})}p(i),p(s),p(r),be(1,r,()=>Ge,()=>({x:-50,duration:250})),$(o,r)};A(h,o=>{ie(a())!==y.None&&o(m)})}$(n,k),W(),w()}var Ue=I('<div class="grid"><button type="button" class="w-fit mt-2 pt-2 pe-2 mb-2 dark:text-immich-dark-fg"><!> <span class="font-bold text-3xl text-black dark:text-white"> </span> <span class="ms-1.5"> </span></button> <hr class="dark:border-immich-dark-gray"/></div>'),De=I('<a class="relative" draggable="false"><div class="flex w-[calc((100vw-(72px+5rem))/2)] max-w-39 justify-center overflow-hidden rounded-xl brightness-75 filter"><img class="object-cover w-39 h-39" loading="lazy"/></div> <span class="absolute bottom-2 w-full text-ellipsis px-1 text-center text-sm font-medium capitalize text-white backdrop-blur-[1px] hover:cursor-pointer"> </span></a>'),He=I('<div class="flex flex-row flex-wrap gap-4"></div>'),Le=I('<!> <div class="mt-4"><!></div>',1);function se(n,t){T(t,!0);const a=()=>z(Q,"$placesViewSettings",O),d=()=>z(L,"$t",O),[O,w]=q();let x=V(t,"group",3,void 0),f=l(()=>!!x()&&Qe(a(),x().id)),B=l(()=>e(f)?"rotate-0":"rotate-90");var b=Le(),G=j(b);{var k=h=>{var m=Ue(),o=g(m);o.__click=()=>Ve(x().id);var r=g(o);oe(r,{get icon(){return ke},size:"24",get class(){return`inline-block -mt-2.5 transition-all duration-250 ${e(B)??""}`}});var s=P(r,2),u=g(s,!0);p(s);var v=P(s,2),i=g(v);p(v),p(o),ve(2),p(m),J(c=>{D(o,"aria-expanded",!e(f)),H(u,x().name),H(i,`(${c??""})`)},[()=>d()("places_count",{values:{count:t.places.length}})]),$(h,m)};A(G,h=>{x()&&h(k)})}var C=P(G,2),_=g(C);{var N=h=>{var m=He();ne(m,21,()=>t.places,o=>o.id,(o,r)=>{const s=l(()=>e(r).exifInfo?.city);var u=De(),v=g(u),i=g(v);p(v);var c=P(v,2),S=g(c,!0);p(c),p(u),J((R,M)=>{D(u,"href",R),D(i,"src",M),D(i,"alt",e(s)),H(S,e(s))},[()=>ze.search({city:e(s)}),()=>Be({id:e(r).id,size:ge.Thumbnail})]),$(o,u)}),p(m),$(h,m)};A(_,h=>{e(f)||h(N)})}p(C),$(n,b),W(),w()}Pe(["click"]);var Te=I('<div class="flex min-h-[calc(66vh-11rem)] w-full place-content-center items-center dark:text-white"><div class="flex flex-col content-center items-center text-center"><!> <p class="mt-5 text-3xl font-medium"> </p></div></div>');function We(n,t){T(t,!0);const a=()=>z(L,"$t",d),[d,O]=q();let w=V(t,"places",27,()=>K([])),x=V(t,"searchQuery",3,""),f=V(t,"searchResultCount",15,0),B=V(t,"placesGroupIds",31,()=>K([]));const b={[y.None]:r=>[{id:a()("places"),name:a()("places"),places:r}],[y.Country]:r=>{const s=a()("unknown_country"),u=Ie(r,i=>i.exifInfo?.country??s);return Object.entries(u).sort(([i],[c])=>i===s?1:c===s?-1:i.localeCompare(c)).map(([i,c])=>({id:i,name:i,places:c}))}},G=l(()=>{const r=ae(x());return r?w().filter(s=>ae(s.exifInfo?.city??"").includes(r)):w()}),k=l(()=>ie(t.userSettings)),C=l(()=>b[e(k)]??b[y.None]),_=l(()=>e(C)(e(G)));te(()=>{f(e(G).length)}),te(()=>{B(e(_).map(({id:r})=>r))});var N=E(),h=j(N);{var m=r=>{var s=E(),u=j(s);{var v=c=>{se(c,{get places(){return e(_)[0].places}})},i=c=>{var S=E(),R=j(S);ne(R,17,()=>e(_),M=>M.id,(M,Z)=>{se(M,{get places(){return e(Z).places},get group(){return e(Z)}})}),$(c,S)};A(u,c=>{e(k)===y.None?c(v):c(i,!1)})}$(r,s)},o=r=>{var s=Te(),u=g(s),v=g(u);oe(v,{get icon(){return Ce},size:"3.5em"});var i=P(v,2),c=g(i,!0);p(i),p(u),p(s),J(S=>H(c,S),[()=>a()("no_places")]),$(r,s)};A(h,r=>{w().length>0?r(m):r(o,!1)})}$(n,N),W(),O()}var qe=I('<div class="flex place-items-center gap-2"><!></div>');function mt(n,t){T(t,!0);const a=()=>z(L,"$t",w),d=()=>z(Ne,"$locale",w),O=()=>z(Q,"$placesViewSettings",w),[w,x]=q();let f=F(""),B=F(0),b=F(K([])),G=l(()=>t.data.items.filter(_=>!!_.exifInfo?.city)),k=l(()=>e(f)?e(B):e(G).length),C=F(0);{const _=m=>{var o=qe(),r=g(o);Fe(r,{get placesGroups(){return e(b)},get searchQuery(){return e(f)},set searchQuery(s){U(f,s,!0)}}),p(o),$(m,o)};let N=l(()=>a()("places")),h=l(()=>e(k)===0&&!e(f)?void 0:`(${e(k).toLocaleString(d())})`);he(n,{get title(){return e(N)},get description(){return e(h)},buttons:_,children:(m,o)=>{We(m,{get places(){return e(G)},get userSettings(){return O()},get searchQuery(){return e(f)},get searchResultCount(){return e(B)},set searchResultCount(r){U(B,r,!0)},get placesGroupIds(){return e(b)},set placesGroupIds(r){U(b,r,!0)}})},$$slots:{buttons:!0,default:!0}})}fe("innerHeight",_=>U(C,_,!0)),W(),x()}export{mt as component,gt as universal};
