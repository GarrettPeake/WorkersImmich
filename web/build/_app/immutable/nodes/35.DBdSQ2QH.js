import{Q as Vt,b as Rt,A as jt}from"../chunks/0qPXRVhz.js";import{a as zt,p as Bt,u as Lt}from"../chunks/CJGyQpNN.js";import{g as K,$ as X}from"../chunks/DWQ0JXRY.js";import{p as _t,b0 as Et,b1 as Nt,o as Ht}from"../chunks/BP6NvnZ7.js";import"../chunks/DsnmJJEf.js";import{p as Y,h as Z,i as ht,f as S,n as $t,t as At,s,j as q,g as t,u as o,a as tt,c as j,r as z}from"../chunks/D0CSSuTl.js";import{s as Tt}from"../chunks/C8vxa4mj.js";import{t as bt,a as f,f as A}from"../chunks/Bd1JH_Ov.js";import{i as J}from"../chunks/D8NIUdeB.js";import{a as B,s as et}from"../chunks/zonMEKN6.js";import{g as Qt}from"../chunks/gvLJu3l0.js";import{O as qt}from"../chunks/Cq6696VF.js";import{U as Kt,S as Gt,h as Jt}from"../chunks/tK_U6--f.js";import{B as pt}from"../chunks/GXf5CvES.js";import{B as Wt,a as Xt,T as ft}from"../chunks/DdV_UXgK.js";import{A as Yt}from"../chunks/CfdSAoAU.js";import{T as Zt}from"../chunks/BaHAZRvh.js";import{C as te,A as vt}from"../chunks/BLnXPQ5q.js";import{F as ee,A as re}from"../chunks/CQ8X2sVV.js";import{C as ae,a as oe}from"../chunks/DmzJz26a.js";import{C as se,T as ne}from"../chunks/Buf2v_0r.js";import{D as ie}from"../chunks/DpocfqHG.js";import{D as le}from"../chunks/vBkll8cH.js";import{S as ce}from"../chunks/C9R8P1Xg.js";import{S as ue}from"../chunks/BL72B9yC.js";import{S as me}from"../chunks/DMMOBWd8.js";import"../chunks/CG4KAGH3.js";import{R as de}from"../chunks/gegweU97.js";import"../chunks/DxRnQWdm.js";import"../chunks/DUXNbmIP.js";import{e as rt}from"../chunks/BpCm29KX.js";import{T as wt,aa as x,K as ge,br as pe,ag as Ct,cu as fe,ah as ve}from"../chunks/D-UYCH9y.js";import{F as yt}from"../chunks/BMcevgEe.js";import{F as _e}from"../chunks/BgQCgJ0_.js";import{I as he}from"../chunks/s_2UW97Q.js";import{S as $e}from"../chunks/BmwRoygt.js";import{t as at,h as ot}from"../chunks/DLePdI2u.js";import{m as W}from"../chunks/BHTYC334.js";import{A as Ae}from"../chunks/MMtgDOP-.js";import{j as Te,T as be}from"../chunks/DxfhPdFw.js";const we=(async({url:a})=>{await zt(a);const e=await K(),r=await _t();return{path:a.searchParams.get(Vt.PATH)??"",tags:r,meta:{title:e("tags")}}}),Cr=Object.freeze(Object.defineProperty({__proto__:null,load:we},Symbol.toStringTag,{value:"Module"}));var Ce=A("<!> <!>",1);function ye(a,e){Y(e,!0);const r=()=>B(X,"$t",u),[u,v]=et();let p=Z(ht(e.baseTag?.path?`${e.baseTag.path}/`:""));const M=async()=>{await De(t(p))&&e.onClose()};{let l=o(()=>r()("create_tag")),D=o(()=>r()("create"));yt(a,{size:"small",get title(){return t(l)},get submitText(){return t(D)},get icon(){return x},get onClose(){return e.onClose},onSubmit:M,children:(F,i)=>{var c=Ce(),L=S(c);wt(L,{size:"small",children:(T,U)=>{$t();var k=bt();At(b=>Tt(k,b),[()=>r()("create_tag_description")]),f(T,k)},$$slots:{default:!0}});var E=s(L,2);{let T=o(()=>r()("tag"));_e(E,{get label(){return t(T)},required:!0,children:(U,k)=>{he(U,{autofocus:!0,get value(){return t(p)},set value(b){q(p,b,!0)}})},$$slots:{default:!0}})}f(F,c)},$$slots:{default:!0}})}tt(),v()}function Ie(a,e){Y(e,!0);const r=()=>B(X,"$t",u),[u,v]=et();let p=Z(ht(e.tag.color??""));const M=async()=>{await Pe(e.tag,{color:t(p)})&&e.onClose()};{let l=o(()=>r()("edit_tag"));yt(a,{get title(){return t(l)},size:"small",get icon(){return x},get onClose(){return e.onClose},onSubmit:M,children:(D,F)=>{{let i=o(()=>r()("color"));$e(D,{get inputType(){return Rt.COLOR},get label(){return t(i)},get value(){return t(p)},set value(c){q(p,c,!0)}})}},$$slots:{default:!0}})}tt(),v()}const Se=(a,e)=>{const r={title:a("create_tag"),icon:Ct,onAction:()=>W.show(ye,{baseTag:e})},u={title:a("edit_tag"),icon:pe,$if:()=>e.path.length>0,onAction:()=>W.show(Ie,{tag:e})},v={title:a("delete_tag"),icon:ge,$if:()=>e.path.length>0,onAction:()=>xe(e)};return{Create:r,Update:u,Delete:v}},De=async a=>{const e=await K();try{const[r]=await Ht({tagUpsertDto:{tags:[a]}});return r?(at.success(e("tag_created",{values:{tag:r.value}})),rt.emit("TagCreate",r),!0):void 0}catch(r){ot(r,e("errors.something_went_wrong"))}},Pe=async(a,e)=>{const r=await K();if(a.id)try{const u=await Nt({id:a.id,tagUpdateDto:e});return at.success(r("tag_updated",{values:{tag:a.value}})),rt.emit("TagUpdate",u),!0}catch(u){ot(u,r("errors.something_went_wrong"))}},xe=async a=>{const e=await K(),r=a.id;if(!(!r||!await W.showDialog({title:e("delete_tag"),prompt:e("delete_tag_confirmation_prompt",{values:{tagName:a.value}}),confirmText:e("delete")})))try{await Et({id:r}),rt.emit("TagDelete",a),at.success()}catch(v){ot(v,e("errors.something_went_wrong"))}};var Me=A('<!> <section><!> <div class="h-full"><!></div></section>',1),Fe=A('<!> <section class="mt-2 h-[calc(100%-(--spacing(20)))] overflow-auto immich-scrollbar"><!></section>',1),Ue=A("<!> <!>",1),ke=A("<!> <!> <!> <!> <!> <!> <!> <!>",1),Oe=A("<!> <!> <!> <!> <!>",1),Ve=A('<div class="fixed top-0 start-0 w-full"><!></div>'),Re=A("<!> <!> <section><!></section>",1);function yr(a,e){Y(e,!0);const r=()=>B(X,"$t",p),u=()=>B(Lt,"$user",p),v=()=>B(Bt,"$preferences",p),[p,M]=et(),l=new Ae;let D=o(()=>e.data.tags);const F=o(()=>be.fromTags(t(D))),i=o(()=>t(F).traverse(e.data.path));let c=Z(void 0);const L=o(()=>({deferInit:!t(i),tagId:t(i)?.id})),E=n=>U(Te(e.data.path,n)),T=n=>de.tags({path:n}),U=n=>Qt(T(n)),k=n=>{t(c).removeAssets(n),l.clearMultiselect()},b=async()=>{q(D,await _t())},It=async n=>{n.path===t(i).path&&await U(t(i).parent?t(i).parent.path:""),await b()},G=o(()=>Se(r(),t(i))),St=o(()=>t(G).Create),Dt=o(()=>t(G).Update),Pt=o(()=>t(G).Delete);var st=Re(),nt=S(st);qt(nt,{onTagCreate:b,onTagUpdate:b,onTagDelete:It});var it=s(nt,2);{const n=V=>{Gt(V,{children:(N,H)=>{var h=Me(),$=S(h);{let d=o(()=>`#${Jt}`),g=o(()=>r()("skip_to_tags"));me($,{get target(){return t(d)},get text(){return t(g)},breakpoint:"md"})}var w=s($,2),C=j(w);wt(C,{class:"ps-4 mb-4",size:"small",children:(d,g)=>{$t();var P=bt();At(I=>Tt(P,I),[()=>r()("explorer")]),f(d,P)},$$slots:{default:!0}});var y=s(C,2),m=j(y);{let d=o(()=>({default:x,active:x}));Xt(m,{get icons(){return t(d)},get tree(){return t(F)},get active(){return t(i).path},getLink:T})}z(y),z(w),f(N,h)},$$slots:{default:!0}})};let O=o(()=>[t(St),t(Dt),t(Pt)]);Kt(it,{get title(){return e.data.meta.title},get actions(){return t(O)},sidebar:n,children:(V,N)=>{var H=Fe(),h=S(H);{let m=o(()=>r()("tags"));Wt(h,{get node(){return t(i)},get icon(){return fe},get title(){return t(m)},getLink:T})}var $=s(h,2),w=j($);{var C=m=>{Zt(m,{enableRouting:!0,get options(){return t(L)},get assetInteraction(){return l},get removeAction(){return jt.UNARCHIVE},get timelineManager(){return t(c)},set timelineManager(g){q(c,g,!0)},empty:g=>{ft(g,{get items(){return t(i).children},get icon(){return x},onClick:E})},$$slots:{empty:!0}})},y=m=>{ft(m,{get items(){return t(i).children},get icon(){return x},onClick:E})};J(w,m=>{t(i).hasAssets?m(C):m(y,!1)})}z($),f(V,H)},$$slots:{sidebar:!0,default:!0}})}var lt=s(it,2),xt=j(lt);{var Mt=n=>{var O=Ve(),V=j(O);Yt(V,{get ownerId(){return u().id},get assets(){return l.selectedAssets},clearSelect:()=>l.clearMultiselect(),children:(N,H)=>{var h=Oe(),$=S(h);te($,{});var w=s($,2);ce(w,{get timelineManager(){return t(c)},get assetInteraction(){return l}});var C=s(w,2);{let d=o(()=>r()("add_to"));pt(C,{get icon(){return Ct},get title(){return t(d)},children:(g,P)=>{var I=Ue(),R=S(I);vt(R,{});var Q=s(R,2);vt(Q,{shared:!0}),f(g,I)},$$slots:{default:!0}})}var y=s(C,2);ee(y,{get removeFavorite(){return l.isAllFavorite},onFavorite:(d,g)=>t(c).update(d,P=>P.isFavorite=g)});var m=s(y,2);{let d=o(()=>r()("menu"));pt(m,{get icon(){return ve},get title(){return t(d)},children:(g,P)=>{var I=ke(),R=S(I);le(R,{menuItem:!0});var Q=s(R,2);ae(Q,{menuItem:!0});var ct=s(Q,2);se(ct,{menuItem:!0});var ut=s(ct,2);oe(ut,{menuItem:!0});var mt=s(ut,2);re(mt,{menuItem:!0,onArchive:(_,kt)=>t(c).update(_,Ot=>Ot.visibility=kt)});var dt=s(mt,2);{var Ft=_=>{ne(_,{menuItem:!0})};J(dt,_=>{v().tags.enabled&&_(Ft)})}var gt=s(dt,2);ie(gt,{menuItem:!0,onAssetDelete:_=>t(c).removeAssets(_),onUndoDelete:_=>t(c).upsertAssets(_)});var Ut=s(gt,2);ue(Ut,{menuItem:!0,onVisibilitySet:k}),f(g,I)},$$slots:{default:!0}})}f(N,h)},$$slots:{default:!0}}),z(O),f(n,O)};J(xt,n=>{l.selectionActive&&n(Mt)})}z(lt),f(a,st),tt(),M()}export{yr as component,Cr as universal};
