import{a as tt,p as rt,u as at}from"../chunks/CJGyQpNN.js";import{g as st,$ as ot}from"../chunks/DWQ0JXRY.js";import"../chunks/DsnmJJEf.js";import{p as nt,i as se,h as B,V as we,g as t,W as it,j as p,f as b,a as lt,u as N,s as n,c as u,a1 as ct,r as c,t as L}from"../chunks/D0CSSuTl.js";import{s as T}from"../chunks/C8vxa4mj.js";import{a as s,f as g,c as z,t as Z}from"../chunks/Bd1JH_Ov.js";import{a as $e}from"../chunks/Biw8UfMB.js";import{i as _}from"../chunks/D8NIUdeB.js";import{h as mt,e as ut}from"../chunks/DLePdI2u.js";import{q as dt,v as vt,I as ft,a7 as pt,ag as _t,ah as gt,aj as ht,a as yt,ak as At}from"../chunks/D-UYCH9y.js";import{b as Ie}from"../chunks/Dgf_MdoC.js";import{c as bt,a as K,s as xt}from"../chunks/zonMEKN6.js";import{b as wt}from"../chunks/Cc6nBHMJ.js";import{a as $t,g as It}from"../chunks/gvLJu3l0.js";import{p as Se}from"../chunks/CG4KAGH3.js";import{B as ke}from"../chunks/GXf5CvES.js";import{C as St}from"../chunks/D-550RMt.js";import{G as kt}from"../chunks/B6eBVnDA.js";import{a as Pt}from"../chunks/eS1Q_jdJ.js";import{C as Dt,A as Pe}from"../chunks/BLnXPQ5q.js";import{F as Nt,A as Ot}from"../chunks/CQ8X2sVV.js";import{A as Rt}from"../chunks/BmVzuLMt.js";import{C as Ct,a as Tt}from"../chunks/DmzJz26a.js";import{C as jt,T as Ft}from"../chunks/Buf2v_0r.js";import{D as qt}from"../chunks/DpocfqHG.js";import{D as De}from"../chunks/vBkll8cH.js";import{S as Bt}from"../chunks/BL72B9yC.js";import{A as Lt}from"../chunks/CfdSAoAU.js";import{Q as Mt}from"../chunks/0qPXRVhz.js";import{f as Ut}from"../chunks/oXVv5nIS.js";import{R as ue}from"../chunks/gegweU97.js";import{A as Et}from"../chunks/MMtgDOP-.js";import{h as Qt,r as Vt,e as Ne,l as zt}from"../chunks/DUXNbmIP.js";import{p as Ht}from"../chunks/BRztk81V.js";import{i as Jt,c as Wt}from"../chunks/DxRnQWdm.js";import{t as Yt}from"../chunks/CF_nq223.js";import{I as Gt,J as Xt,K as Zt,L as Kt}from"../chunks/BP6NvnZ7.js";const er=(async({url:oe})=>(await tt(oe),{meta:{title:(await st())("search")}})),Xr=Object.freeze(Object.defineProperty({__proto__:null,load:er},Symbol.toStringTag,{value:"Module"}));var tr=g('<div class="bg-gray-300 py-2 px-4 dark:bg-gray-800 dark:text-white rounded-e-full"><!></div>'),rr=g('<div class="flex place-content-center place-items-center items-stretch text-xs"><div> </div> <!></div>'),ar=g('<section id="search-chips" class="mt-24 text-center w-full flex gap-5 place-content-center place-items-center flex-wrap px-24"></section>'),sr=g('<div class="flex min-h-[calc(66vh-11rem)] w-full place-content-center items-center dark:text-white"><div class="flex flex-col content-center items-center text-center"><!> <p class="mt-5 text-3xl font-medium"> </p> <p class="text-base font-normal"> </p></div></div>'),or=g('<div class="flex justify-center py-16 items-center"><!></div>'),nr=g("<!> <!>",1),ir=g("<!> <!> <!> <!> <!> <!> <!> <!> <hr/> <!>",1),lr=g("<!> <!>",1),cr=g("<!> <!> <!> <!>",1),mr=g('<div class="fixed top-0 start-0 w-full"><!></div>'),ur=g('<div class="absolute bg-light"></div> <div class="w-full flex-1 ps-4"><!></div>',1),dr=g('<div class="fixed top-0 start-0 w-full"><!></div>'),vr=g('<!> <section class="mb-12 bg-immich-bg dark:bg-immich-dark-bg m-4 max-h-screen"><section id="search-content"><!> <!></section> <section><!></section></section>',1);function Zr(oe,de){nt(de,!0);const ve=()=>K(at,"$user",H),Oe=()=>K(Vt,"$lang",H),a=()=>K(ot,"$t",H),Re=()=>K(zt,"$locale",H),Ce=()=>K(rt,"$preferences",H),[H,Te]=xt(),ne=se({width:0,height:0});let ie=B(void 0),ee=B(se(ue.explore())),te=B(1),fe=B(se([])),I=B(se([])),J=B(!0),re=B(0),pe=0;const h=new Et;let _e=N(()=>Se.url.searchParams.get(Mt.QUERY)),je=N(()=>Ut.value.smartSearch),O=N(()=>t(_e)?JSON.parse(t(_e)):{});const Fe=N(()=>ve()&&h.selectedAssets.every(e=>e.ownerId===ve().id));we(()=>{t(O),it(()=>Qt(le()))}),we(()=>{t(re)&&(pe=t(re))}),$t(({from:e})=>{e?.url&&e.route.id!==Se.route.id&&p(ee,e.url.href,!0);const r=e?.route?.id;Jt(r)&&p(ee,ue.photos(),!0),Wt(r)&&p(ee,ue.explore(),!0),ct().then(()=>{window.scrollTo(0,pe)}).catch(()=>{})});const ge=e=>{const r=new Set(e);p(I,t(I).filter(o=>!r.has(o.id)),!0)},qe=e=>{h.clearMultiselect(),ge(e)},Be=()=>{h.selectAssets(t(I).map(e=>Yt(e)))};async function le(){p(te,1),p(I,[],!0),p(fe,[],!0),await ce(!0)}const ce=async e=>{if(!t(te)||t(J)&&!e)return;p(J,!0);const r={page:t(te),withExif:!0,isVisible:!0,language:Oe(),...t(O)};try{const{albums:o,assets:i}=("query"in r||"queryAssetId"in r)&&t(je)?await Gt({smartSearchDto:r}):await Xt({metadataSearchDto:r});t(fe).push(...o.items),t(I).push(...i.items),p(te,Number(i.nextPage)||0,!0)}catch(o){mt(o,a()("loading_search_results_failed"))}finally{p(J,!1)}};function Le(e){return Ht(e).startOf("day").toLocaleString({year:"numeric",month:"long",day:"numeric"},{locale:Re()})}function Me(e){return{takenAfter:a()("start_date"),takenBefore:a()("end_date"),visibility:a()("in_archive"),isFavorite:a()("favorite"),isNotInAlbum:a()("not_in_any_album"),type:a()("media_type"),query:a()("context"),city:a()("city"),country:a()("country"),state:a()("state"),make:a()("camera_brand"),model:a()("camera_model"),lensModel:a()("lens_model"),personIds:a()("people"),tagIds:a()("tags"),originalFileName:a()("file_name"),description:a()("description"),queryAssetId:a()("query_asset_id"),ocr:a()("ocr")}[e]||e}async function Ue(e){return(await Promise.all(e.map(async o=>{const i=await Zt({id:o});return i.name==""?a()("no_name"):i.name}))).join(", ")}async function Ee(e){return e===null?a()("untagged"):(await Promise.all(e.map(async o=>(await Kt({id:o})).value))).join(", ")}const he=e=>{if(Ne(h),t(O).isNotInAlbum.toString()=="true"){const r=new Set(e);p(I,t(I).filter(o=>!r.has(o.id)),!0)}};function Qe(e){return Object.keys(e)}var Ve={loadNextPage:ce},ye=vr(),Ae=b(ye);{var ze=e=>{var r=ar();ut(r,20,()=>Qe(t(O)),o=>o,(o,i)=>{const l=N(()=>t(O)[i]);var d=rr(),v=u(d),P=u(v,!0);c(v);var S=n(v,2);{var Y=k=>{var j=tr(),m=u(j);{var R=x=>{var y=Z();L(D=>T(y,D),[()=>Le(t(l))]),s(x,y)},G=x=>{var y=z(),D=b(y);{var ae=w=>{var C=z(),M=b(C);$e(M,()=>Ue(t(l)),null,(U,E)=>{var A=Z();L(()=>T(A,t(E))),s(U,A)}),s(w,C)},F=w=>{var C=z(),M=b(C);{var U=A=>{var q=z(),Q=b(q);$e(Q,()=>Ee(t(l)),null,(X,V)=>{var $=Z();L(()=>T($,t(V))),s(X,$)}),s(A,q)},E=A=>{var q=z(),Q=b(q);{var X=$=>{var f=Z();L(et=>T(f,et),[()=>a()("unknown")]),s($,f)},V=$=>{var f=Z();L(()=>T(f,t(l))),s($,f)};_(Q,$=>{t(l)===null||t(l)===""?$(X):$(V,!1)},!0)}s(A,q)};_(M,A=>{i==="tagIds"&&(Array.isArray(t(l))||t(l)===null)?A(U):A(E,!1)},!0)}s(w,C)};_(D,w=>{i==="personIds"&&Array.isArray(t(l))?w(ae):w(F,!1)},!0)}s(x,y)};_(m,x=>{(i==="takenAfter"||i==="takenBefore")&&typeof t(l)=="string"?x(R):x(G,!1)})}c(j),s(k,j)};_(S,k=>{t(l)!==!0&&k(Y)})}c(d),L(k=>{dt(v,1,`flex items-center justify-center bg-immich-primary py-2 px-4 text-white dark:text-black dark:bg-immich-dark-primary
          ${t(l)===!0?"rounded-full":"rounded-s-full"}`),T(P,k)},[()=>Me(i)]),s(o,d)}),c(r),s(e,r)};_(Ae,e=>{t(O)&&e(ze)})}var W=n(Ae,2),me=u(W),be=u(me);{var He=e=>{kt(e,{get assets(){return t(I)},get assetInteraction(){return h},onIntersected:ce,showArchiveIcon:!0,get viewport(){return ne},onReload:le,get slidingWindowOffset(){return t(ie).offsetTop}})},Je=e=>{var r=z(),o=b(r);{var i=l=>{var d=sr(),v=u(d),P=u(v);yt(P,{get icon(){return At},size:"3.5em"});var S=n(P,2),Y=u(S,!0);c(S);var k=n(S,2),j=u(k,!0);c(k),c(v),c(d),L((m,R)=>{T(Y,m),T(j,R)},[()=>a()("no_results"),()=>a()("no_results_description")]),s(l,d)};_(o,l=>{t(J)||l(i)},!0)}s(e,r)};_(be,e=>{t(I).length>0?e(He):e(Je,!1)})}var We=n(be,2);{var Ye=e=>{var r=or(),o=u(r);vt(o,{size:"giant"}),c(r),s(e,r)};_(We,e=>{t(J)&&e(Ye)})}c(me);var xe=n(me,2),Ge=u(xe);{var Xe=e=>{var r=mr(),o=u(r);Lt(o,{get assets(){return h.selectedAssets},clearSelect:()=>Ne(h),children:(i,l)=>{var d=cr(),v=b(d);Dt(v,{});var P=n(v,2);{let m=N(()=>a()("select_all"));ft(P,{shape:"round",color:"secondary",variant:"ghost",get"aria-label"(){return t(m)},get icon(){return pt},onclick:Be})}var S=n(P,2);{let m=N(()=>a()("add_to"));ke(S,{get icon(){return _t},get title(){return t(m)},children:(R,G)=>{var x=nr(),y=b(x);Pe(y,{onAddToAlbum:he});var D=n(y,2);Pe(D,{shared:!0,onAddToAlbum:he}),s(R,x)},$$slots:{default:!0}})}var Y=n(S,2);{var k=m=>{var R=lr(),G=b(R);Nt(G,{get removeFavorite(){return h.isAllFavorite},onFavorite:(y,D)=>{for(const ae of y){const F=t(I).find(w=>w.id===ae);F&&(F.isFavorite=D)}}});var x=n(G,2);{let y=N(()=>a()("menu"));ke(x,{get icon(){return gt},get title(){return t(y)},children:(D,ae)=>{var F=ir(),w=b(F);De(w,{menuItem:!0});var C=n(w,2);Ct(C,{menuItem:!0});var M=n(C,2);jt(M,{menuItem:!0});var U=n(M,2);Tt(U,{menuItem:!0});var E=n(U,2);Ot(E,{menuItem:!0,get unarchive(){return h.isAllArchived}});var A=n(E,2);{var q=f=>{Bt(f,{menuItem:!0,onVisibilitySet:qe})};_(A,f=>{h.isAllUserOwned&&f(q)})}var Q=n(A,2);{var X=f=>{Ft(f,{menuItem:!0})};_(Q,f=>{Ce().tags.enabled&&h.isAllUserOwned&&f(X)})}var V=n(Q,2);qt(V,{menuItem:!0,onAssetDelete:ge,onUndoDelete:le});var $=n(V,4);Rt($,{}),s(D,F)},$$slots:{default:!0}})}s(m,R)},j=m=>{De(m,{})};_(Y,m=>{t(Fe)?m(k):m(j,!1)})}s(i,d)},$$slots:{default:!0}}),c(r),s(e,r)},Ze=e=>{var r=dr(),o=u(r);St(o,{onClose:()=>It(t(ee)),get backIcon(){return ht},children:(i,l)=>{var d=ur(),v=n(b(d),2),P=u(v);{let S=N(()=>t(O)?.query??"");Pt(P,{grayTheme:!1,get value(){return t(S)},get searchQuery(){return t(O)}})}c(v),s(i,d)},$$slots:{default:!0}}),c(r),s(e,r)};_(Ge,e=>{h.selectionActive?e(Xe):e(Ze,!1)})}c(xe),c(W),bt(W,e=>p(ie,e),()=>t(ie)),wt("y",()=>t(re),e=>p(re,e,!0)),Ie(W,"clientHeight",e=>ne.height=e),Ie(W,"clientWidth",e=>ne.width=e),s(oe,ye);var Ke=lt(Ve);return Te(),Ke}export{Zr as component,Xr as universal};
