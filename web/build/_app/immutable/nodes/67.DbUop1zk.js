import{l as He,a as Ce}from"../chunks/169FoBhI.js";import{W as De,b8 as Te,M as oe}from"../chunks/BP6NvnZ7.js";import"../chunks/DsnmJJEf.js";import{p as ke,f as v,n as c,t as o,s as n,c as se,g as h,u as Y,r as ne,a as ye,h as je,j as Ee,aQ as Ve}from"../chunks/D0CSSuTl.js";import{o as Oe,s}from"../chunks/C8vxa4mj.js";import{t as l,a as e,c as le,f as b}from"../chunks/Bd1JH_Ov.js";import{i as x}from"../chunks/D8NIUdeB.js";import{a as fe,s as we}from"../chunks/zonMEKN6.js";import{A as We}from"../chunks/aAP1iED5.js";import{e as Re}from"../chunks/DLePdI2u.js";import{T as D,a as Pe,W as Ae,w as Be,cB as Qe,B as te,aM as Ie,cC as Ue,aj as qe}from"../chunks/D-UYCH9y.js";import{$ as Se}from"../chunks/DWQ0JXRY.js";import{H as pe,S as Le}from"../chunks/Tw41aoDi.js";import{H as ue}from"../chunks/BHTYC334.js";import{M as Ge,P as Je,h as Ke}from"../chunks/CrQWUWqC.js";import{S as Fe}from"../chunks/DjfA5PU5.js";import{F as Ne}from"../chunks/DS0yfrVF.js";import{m as Xe}from"../chunks/DUXNbmIP.js";import{L as Ye}from"../chunks/CTSOIQJr.js";const Ze=(async()=>{await Promise.allSettled([He(),Ce()]);try{const{major:U,minor:g,patch:t}=await De();return{expectedVersion:`${U}.${g}.${t}`}}catch{return{expectedVersion:"0.0.0"}}}),Dt=Object.freeze(Object.defineProperty({__proto__:null,load:Ze},Symbol.toStringTag,{value:"Module"}));var et=b("<!> <!>",1),tt=b("<!> <!> <!>",1),rt=b("<!> <!>",1),at=b("<!> <!>",1),ot=b("<!> <!> <!>",1),st=b("<!> <!>",1),nt=b("<!> <!>",1),lt=b('<!> <!> <div class="bg-white dark:bg-black w-full m-4 p-6 rounded-xl border border-light-300"><!></div> <!> <!>',1);function it(U,g){ke(g,!0);const t=()=>fe(Se,"$t",P),[P,q]=we();let B=je(void 0);const G=async()=>{Ee(B,await Te(),!0)},I=(V,k)=>V?t()("maintenance_restore_library_folder_pass"):k?t()("maintenance_restore_library_folder_write_fail"):t()("maintenance_restore_library_folder_read_fail");Oe(()=>G());var re=lt(),j=v(re);pe(j,{size:"large",color:"primary",tag:"h1",children:(V,k)=>{c();var u=l();o(F=>s(u,F),[()=>t()("maintenance_restore_library")]),e(V,u)},$$slots:{default:!0}});var J=n(j,2);D(J,{children:(V,k)=>{c();var u=l();o(F=>s(u,F),[()=>t()("maintenance_restore_library_description")]),e(V,u)},$$slots:{default:!0}});var T=n(J,2),O=se(T);Le(O,{children:(V,k)=>{var u=le(),F=v(u);{var ie=R=>{var w=ot(),E=v(w);Re(E,17,()=>h(B).storage,({folder:i,readable:d,writable:r})=>i,(i,d)=>{let r=()=>h(d).folder,_=()=>h(d).readable,y=()=>h(d).writable;ue(i,{children:(W,m)=>{var f=et(),p=v(f);{let H=Y(()=>y()?Ae:Be),a=Y(()=>y()?"text-success":"text-danger");Pe(p,{get icon(){return h(H)},get class(){return h(a)}})}var Q=n(p,2);D(Q,{children:(H,a)=>{c();var S=l();o(A=>s(S,`${r()??""} (${A??""})`),[()=>I(y(),_())]),e(H,S)},$$slots:{default:!0}}),e(W,f)},$$slots:{default:!0}})});var K=n(E,2);Re(K,17,()=>h(B).storage,({folder:i,files:d})=>i,(i,d)=>{let r=()=>h(d).folder,_=()=>h(d).files;var y=le(),W=v(y);{var m=f=>{ue(f,{class:"items-start",children:(p,Q)=>{var H=at(),a=v(H);{let A=Y(()=>`mt-1  ${_()?"text-success":r()==="profile"||r()==="upload"?"text-danger":"text-warning"}`),$=Y(()=>_()?Ae:r()==="profile"||r()==="upload"?Be:Qe);Pe(a,{get class(){return h(A)},get icon(){return h($)}})}var S=n(a,2);Le(S,{gap:0,class:"items-start",children:(A,$)=>{var C=rt(),ge=v(C);D(ge,{children:(ce,he)=>{var de=le(),xe=v(de);{var me=N=>{var ee=l();o(M=>s(ee,M),[()=>t()("maintenance_restore_library_folder_has_files",{values:{folder:r(),count:_()}})]),e(N,ee)},be=N=>{var ee=l();o(M=>s(ee,M),[()=>t()("maintenance_restore_library_folder_no_files",{values:{folder:r()}})]),e(N,ee)};x(xe,N=>{_()?N(me):N(be,!1)})}e(ce,de)},$$slots:{default:!0}});var $e=n(ge,2);{var ze=ce=>{var he=tt(),de=v(he);{var xe=M=>{D(M,{variant:"italic",children:(_e,Me)=>{c();var X=l();o(ve=>s(X,ve),[()=>t()("maintenance_restore_library_hint_missing_files")]),e(_e,X)},$$slots:{default:!0}})};x(de,M=>{(r()==="profile"||r()==="upload")&&M(xe)})}var me=n(de,2);{var be=M=>{D(M,{variant:"italic",children:(_e,Me)=>{c();var X=l();o(ve=>s(X,ve),[()=>t()("maintenance_restore_library_hint_regenerate_later")]),e(_e,X)},$$slots:{default:!0}})};x(me,M=>{(r()==="encoded-video"||r()==="thumbs")&&M(be)})}var N=n(me,2);{var ee=M=>{D(M,{variant:"italic",children:(_e,Me)=>{c();var X=l();o(ve=>s(X,ve),[()=>t()("maintenance_restore_library_hint_storage_template_missing_files")]),e(_e,X)},$$slots:{default:!0}})};x(N,M=>{r()==="library"&&M(ee)})}e(ce,he)};x($e,ce=>{_()||ce(ze)})}e(A,C)},$$slots:{default:!0}}),e(p,H)},$$slots:{default:!0}})};x(W,f=>{r()!=="backups"&&f(m)})}e(i,y)});var L=n(K,2);te(L,{get leadingIcon(){return Ie},variant:"ghost",onclick:G,children:(i,d)=>{c();var r=l();o(_=>s(r,_),[()=>t()("refresh")]),e(i,r)},$$slots:{default:!0}}),e(R,w)},z=R=>{ue(R,{children:(w,E)=>{var K=st(),L=v(K);Pe(L,{get icon(){return Ie},color:"rgb(var(--immich-ui-primary))"});var i=n(L,2);D(i,{children:(d,r)=>{c();var _=l();o(y=>s(_,y),[()=>t()("maintenance_restore_library_loading")]),e(d,_)},$$slots:{default:!0}}),e(w,K)},$$slots:{default:!0}})};x(F,R=>{h(B)?R(ie):R(z,!1)})}e(V,u)},$$slots:{default:!0}}),ne(T);var ae=n(T,2);D(ae,{children:(V,k)=>{c();var u=l();o(F=>s(u,F),[()=>t()("maintenance_restore_library_confirm")]),e(V,u)},$$slots:{default:!0}});var Z=n(ae,2);ue(Z,{children:(V,k)=>{var u=nt(),F=v(u);te(F,{get onclick(){return g.end},variant:"ghost",children:(z,R)=>{c();var w=l();o(E=>s(w,E),[()=>t()("cancel")]),e(z,w)},$$slots:{default:!0}});var ie=n(F,2);te(ie,{get onclick(){return g.next},get trailingIcon(){return Ue},children:(z,R)=>{c();var w=l();o(E=>s(w,E),[()=>t()("next")]),e(z,w)},$$slots:{default:!0}}),e(V,u)},$$slots:{default:!0}}),e(U,re),ye(),q()}var ct=b("<!> <!>",1),dt=b("<!> <!> <!>",1);function _t(U,g){ke(g,!0);const t=()=>fe(Se,"$t",P),[P,q]=we();var B=dt(),G=v(B);pe(G,{size:"large",color:"primary",tag:"h1",children:(j,J)=>{c();var T=l();o(O=>s(T,O),[()=>t()("maintenance_restore_from_backup")]),e(j,T)},$$slots:{default:!0}});var I=n(G,2);Fe(I,{class:"max-h-120 bg-white dark:bg-black p-4 rounded-2xl border border-light-300 w-full",children:(j,J)=>{Ge(j,{get expectedVersion(){return g.expectedVersion}})},$$slots:{default:!0}});var re=n(I,2);ue(re,{children:(j,J)=>{var T=ct(),O=v(T);te(O,{get onclick(){return g.end},variant:"ghost",children:(Z,V)=>{c();var k=l();o(u=>s(k,u),[()=>t()("cancel")]),e(Z,k)},$$slots:{default:!0}});var ae=n(O,2);te(ae,{get onclick(){return g.previous},variant:"ghost",get leadingIcon(){return qe},children:(Z,V)=>{c();var k=l();o(u=>s(k,u),[()=>t()("back")]),e(Z,k)},$$slots:{default:!0}}),e(j,T)},$$slots:{default:!0}}),e(U,B),ye(),q()}function vt(U,g){let t=je(0);var P=le(),q=v(P);{var B=I=>{it(I,{next:()=>Ve(t),get end(){return g.end}})},G=I=>{_t(I,{previous:()=>Ve(t,-1),get end(){return g.end},get expectedVersion(){return g.expectedVersion}})};x(q,I=>{h(t)===0?I(B):I(G,!1)})}e(U,P)}var ut=b('<pre class="text-left text-sm"><code> </code></pre>'),ft=b("<!> <!>",1),$t=b("<!> <!> <!> <!> <!>",1),mt=b("<!> <!>",1),pt=b("<p> </p> <!>",1),gt=b("<!> <p><!></p> <!>",1),ht=b('<div class="flex flex-col place-items-center text-center gap-8"><!></div>');function Tt(U,g){ke(g,!0);const t=()=>fe(re,"$status",B),P=()=>fe(Se,"$t",B),q=()=>fe(I,"$auth",B),[B,G]=we(),{auth:I,status:re}=Xe,j=new URL(location.href);j.searchParams.get("token")&&(j.searchParams.delete("token"),history.replaceState({},document.title,j));const J=()=>Ke({action:oe.End}),T=Y(()=>t()?.error?.split(`
`).filter(O=>!O.includes("drop cascades")).join(`
`));{let O=Y(()=>t()?.action===oe.Start||t()?.action===oe.End),ae=Y(()=>t()?.action===oe.Start);We(U,{get withHeader(){return h(O)},get withBackdrop(){return h(ae)},children:(Z,V)=>{var k=ht(),u=se(k);{var F=z=>{var R=mt(),w=v(R);pe(w,{size:"large",color:"primary",tag:"h1",children:(i,d)=>{c();var r=l();o(_=>s(r,_),[()=>P()("maintenance_action_restore")]),e(i,r)},$$slots:{default:!0}});var E=n(w,2);{var K=i=>{var d=ft(),r=v(d);Fe(r,{class:"max-h-80",children:(y,W)=>{var m=ut(),f=se(m),p=se(f,!0);ne(f),ne(m),o(()=>s(p,h(T))),e(y,m)},$$slots:{default:!0}});var _=n(r,2);te(_,{onclick:J,children:(y,W)=>{c();var m=l();o(f=>s(m,f),[()=>P()("maintenance_end")]),e(y,m)},$$slots:{default:!0}}),e(i,d)},L=i=>{var d=$t(),r=v(d);{let a=Y(()=>t().progress||0);Je(r,{get progress(){return h(a)}})}var _=n(r,2);{var y=a=>{D(a,{children:(S,A)=>{c();var $=l();o(C=>s($,C),[()=>P()("maintenance_task_backup")]),e(S,$)},$$slots:{default:!0}})};x(_,a=>{t().task==="backup"&&a(y)})}var W=n(_,2);{var m=a=>{D(a,{children:(S,A)=>{c();var $=l();o(C=>s($,C),[()=>P()("maintenance_task_restore")]),e(S,$)},$$slots:{default:!0}})};x(W,a=>{t().task==="restore"&&a(m)})}var f=n(W,2);{var p=a=>{D(a,{children:(S,A)=>{c();var $=l();o(C=>s($,C),[()=>P()("maintenance_task_migrations")]),e(S,$)},$$slots:{default:!0}})};x(f,a=>{t().task==="migrations"&&a(p)})}var Q=n(f,2);{var H=a=>{D(a,{children:(S,A)=>{c();var $=l();o(C=>s($,C),[()=>P()("maintenance_task_rollback")]),e(S,$)},$$slots:{default:!0}})};x(Q,a=>{t().task==="rollback"&&a(H)})}e(i,d)};x(E,i=>{t().error?i(K):i(L,!1)})}e(z,R)},ie=z=>{var R=le(),w=v(R);{var E=L=>{vt(L,{end:J,get expectedVersion(){return g.data.expectedVersion}})},K=L=>{var i=gt(),d=v(i);pe(d,{size:"large",color:"primary",tag:"h1",children:(m,f)=>{c();var p=l();o(Q=>s(p,Q),[()=>P()("maintenance_title")]),e(m,p)},$$slots:{default:!0}});var r=n(d,2),_=se(r);Ne(_,{key:"maintenance_description",children:(f,p)=>{let Q=()=>p?.().tag,H=()=>p?.().message;var a=le(),S=v(a);{var A=$=>{Ye($,{href:"https://docs.immich.app/administration/maintenance-mode",children:(C,ge)=>{c();var $e=l();o(()=>s($e,H())),e(C,$e)},$$slots:{default:!0}})};x(S,$=>{Q()==="link"&&$(A)})}e(f,a)},$$slots:{default:!0}}),ne(r);var y=n(r,2);{var W=m=>{var f=pt(),p=v(f),Q=se(p,!0);ne(p);var H=n(p,2);te(H,{onclick:J,children:(a,S)=>{c();var A=l();o($=>s(A,$),[()=>P()("maintenance_end")]),e(a,A)},$$slots:{default:!0}}),o(a=>s(Q,a),[()=>P()("maintenance_logged_in_as",{values:{user:q().username}})]),e(m,f)};x(y,m=>{q()&&m(W)})}e(L,i)};x(w,L=>{t()?.action===oe.SelectDatabaseRestore&&q()?L(E):L(K,!1)},!0)}e(z,R)};x(u,z=>{t()?.action===oe.RestoreDatabase?z(F):z(ie,!1)})}ne(k),e(Z,k)},$$slots:{default:!0}})}ye(),G()}export{Tt as component,Dt as universal};
