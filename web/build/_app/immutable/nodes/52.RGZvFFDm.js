import{a as Ke}from"../chunks/CJGyQpNN.js";import{g as We,$ as ie}from"../chunks/DWQ0JXRY.js";import{aB as Xe,aG as A,aE as j,aF as Ye}from"../chunks/BP6NvnZ7.js";import"../chunks/DsnmJJEf.js";import{d as Ze,s as b,o as ea}from"../chunks/C8vxa4mj.js";import{c as n,b as fe,r as s,t as y,p as le,s as d,f as S,g as a,a as de,u,n as Pe,al as aa,aD as ta,j as ra}from"../chunks/D0CSSuTl.js";import{a as m,f,t as qe,c as _e}from"../chunks/Bd1JH_Ov.js";import{i as $}from"../chunks/D8NIUdeB.js";import{p as ne,a as Z,s as ce,e as sa,b as oa}from"../chunks/zonMEKN6.js";import{A as na}from"../chunks/CaRu5ymf.js";import{O as ia}from"../chunks/Cq6696VF.js";import{e as la,t as da,h as ca}from"../chunks/DLePdI2u.js";import{q as ee,a as I,I as Se,dE as ma,w as Qe,cw as ua,dF as va,bp as ga,dG as fa,bo as _a,dH as pa,aB as xa,s as ha}from"../chunks/D-UYCH9y.js";import{s as pe}from"../chunks/CMI33r64.js";import{R as ge}from"../chunks/gegweU97.js";import{a as Fe,q as oe,b as ba}from"../chunks/COojjwIi.js";import{ak as ya,l as Ca}from"../chunks/DUXNbmIP.js";import{L as ka}from"../chunks/CTSOIQJr.js";import"../chunks/69_IOA4Y.js";import{i as wa}from"../chunks/9chJ2bcr.js";import{O as $a}from"../chunks/0qPXRVhz.js";import{F as Ta}from"../chunks/DS0yfrVF.js";import{f as Pa}from"../chunks/oXVv5nIS.js";import{m as qa}from"../chunks/BHTYC334.js";import{C as Sa}from"../chunks/CG2BHJh0.js";import{C as Qa}from"../chunks/cX31cXxY.js";const ja=(async({url:T})=>{await Ke(T,{admin:!0});const t=await Xe(),e=await We();return{queues:t,meta:{title:e("admin.queues")}}}),St=Object.freeze(Object.defineProperty({__proto__:null,load:ja},Symbol.toStringTag,{value:"Module"}));var za=f("<div><!></div>");function je(T,t){const e={success:"bg-green-500/70 text-gray-900 dark:bg-green-700/90 dark:text-gray-100",warning:"bg-orange-400/70 text-gray-900 dark:bg-orange-900 dark:text-gray-100"};var g=za(),P=n(g);pe(P,()=>t.children??fe),s(g),y(()=>ee(g,1,`w-full p-2 text-center text-sm ${e[t.color]??""}`)),m(T,g)}var Fa=f('<button type="button"><!></button>');function H(T,t){let e=ne(t,"disabled",3,!1),g=ne(t,"onClick",3,()=>{});const P={"light-gray":"bg-gray-300/80 dark:bg-gray-700",gray:"bg-gray-300/90 dark:bg-gray-700/90","dark-gray":"bg-gray-300 dark:bg-gray-700/80"},x=e()?"cursor-not-allowed":"hover:bg-immich-primary hover:text-white dark:hover:bg-immich-dark-primary dark:hover:text-black";var h=Fa();h.__click=function(...O){g()?.apply(this,O)};var D=n(h);pe(D,()=>t.children??fe),s(h),y(()=>{h.disabled=e(),ee(h,1,`flex h-full w-full flex-col place-content-center place-items-center gap-2 px-8 py-2 text-xs text-gray-600 transition-colors dark:text-gray-200 ${P[t.color]??""} ${x}`)}),m(T,h)}Ze(["click"]);var Ma=f("<span><!></span>");function ze(T,t){let e=ne(t,"rounded",3,!0);var g=Ma();let P;var x=n(g);pe(x,()=>t.children??fe),s(g),y(()=>P=ee(g,1,"bg-primary text-subtle inline-block h-min whitespace-nowrap px-3 py-1 text-center align-baseline text-xs leading-none",null,P,{"rounded-md":e()===!0,"rounded-full":e()==="full"})),m(T,g)}var La=f("<!> <span> </span>",1),Da=f('<div class="flex flex-row gap-1"><span class="text-sm"> </span> <!></div>'),Oa=f('<span class="text-sm"> </span>'),Ra=f('<div class="whitespace-pre-line text-sm dark:text-white"> </div>'),Ea=f('<div class="text-sm dark:text-white"><!></div>'),Aa=f("<!> <span> </span>",1),Ba=f("<!> <span> </span>",1),Ia=f("<!> <span> </span>",1),Ga=f("<!> <span> </span>",1),Ja=f("<!> <!>",1),Na=f("<!> <span> </span>",1),Ha=f("<!> <span> </span>",1),Ua=f("<!> <span> </span>",1),Va=f("<!> <!> <!>",1),Ka=f("<!> <span> </span>",1),Wa=f('<div class="flex flex-col overflow-hidden rounded-2xl bg-gray-100 dark:bg-immich-dark-gray sm:flex-row sm:rounded-9"><div class="flex w-full flex-col"><!> <div class="flex flex-col gap-2 p-5 sm:p-7 md:p-9"><div class="flex items-center gap-2 text-xl font-semibold text-primary"><!> <!> <div class="flex gap-2"><!> <!></div></div> <!> <!> <div class="mt-2 flex w-full max-w-md flex-col sm:flex-row"><div><p> </p> <p class="text-2xl"> </p></div> <div><p class="text-2xl"> </p> <p> </p></div></div></div></div> <div class="flex w-full flex-row overflow-hidden sm:w-32 sm:flex-col"><!> <!> <!> <!></div></div>');function Xa(T,t){le(t,!0);const e=()=>Z(ie,"$t",P),g=()=>Z(Ca,"$locale",P),[P,x]=ce();let h=ne(t,"disabled",3,!1);const D=u(()=>Fe(e(),t.queue)),O=u(()=>a(D).icon),R=u(()=>a(D).title),C=u(()=>a(D).subtitle),v=u(()=>t.queue.statistics);let Q=u(()=>a(v).waiting+a(v).paused+a(v).delayed),F=u(()=>a(v).active+a(v).waiting===0&&!t.queue.isPaused),U=u(()=>t.allText||t.refreshText);var G=Wa(),z=n(G),B=n(z);{var W=r=>{je(r,{color:"warning",children:(i,_)=>{Pe();var l=qe();y(c=>b(l,c),[()=>e()("paused")]),m(i,l)}})},J=r=>{var i=_e(),_=S(i);{var l=c=>{je(c,{color:"success",children:(p,M)=>{Pe();var o=qe();y(L=>b(o,L),[()=>e()("active")]),m(p,o)}})};$(_,c=>{a(v).active>0&&c(l)},!0)}m(r,i)};$(B,r=>{t.queue.isPaused?r(W):r(J,!1)})}var V=d(B,2),ae=n(V),X=n(ae);{let r=u(()=>ge.viewQueue(t.queue));ka(X,{class:"flex items-center gap-2 hover:underline",get href(){return a(r)},underline:!1,children:(i,_)=>{var l=La(),c=S(l);I(c,{get icon(){return a(O)},size:"1.25em",class:"hidden shrink-0 sm:block"});var p=d(c,2),M=n(p,!0);s(p),y(o=>b(M,o),[()=>ya(a(R))]),m(i,l)},$$slots:{default:!0}})}var te=d(X,2);{let r=u(()=>e()("view_details")),i=u(()=>ge.viewQueue(t.queue));Se(te,{color:"primary",get icon(){return ma},get"aria-label"(){return a(r)},size:"small",variant:"ghost",get href(){return a(i)}})}var re=d(te,2),K=n(re);{var Me=r=>{ze(r,{children:(i,_)=>{var l=Da(),c=n(l),p=n(c,!0);s(c);var M=d(c,2);{let o=u(()=>e()("clear_message"));Se(M,{color:"primary",get icon(){return Qe},get"aria-label"(){return a(o)},size:"tiny",shape:"round",onclick:()=>t.onCommand({command:A.ClearFailed,force:!1})})}s(l),y(o=>b(p,o),[()=>e()("admin.jobs_failed",{values:{jobCount:a(v).failed.toLocaleString(g())}})]),m(i,l)},$$slots:{default:!0}})};$(K,r=>{a(v).failed>0&&r(Me)})}var Le=d(K,2);{var De=r=>{ze(r,{children:(i,_)=>{var l=Oa(),c=n(l,!0);s(l),y(p=>b(c,p),[()=>e()("admin.jobs_delayed",{values:{jobCount:a(v).delayed.toLocaleString(g())}})]),m(i,l)},$$slots:{default:!0}})};$(Le,r=>{a(v).delayed>0&&r(De)})}s(re),s(ae);var xe=d(ae,2);{var Oe=r=>{var i=Ra(),_=n(i,!0);s(i),y(()=>b(_,a(C))),m(r,i)};$(xe,r=>{a(C)&&r(Oe)})}var he=d(xe,2);{var Re=r=>{const i=u(()=>t.description);var _=Ea(),l=n(_);sa(l,()=>a(i),(c,p)=>{p(c,{})}),s(_),m(r,_)};$(he,r=>{t.description&&r(Re)})}var be=d(he,2),se=n(be);ee(se,1,"flex place-items-center justify-between w-full py-2 sm:py-4 pe-4 ps-6 rounded-t-lg bg-immich-primary text-white dark:bg-immich-dark-primary dark:text-immich-dark-gray sm:rounded-s-lg sm:rounded-e-none");var me=n(se),Ee=n(me,!0);s(me);var ye=d(me,2),Ae=n(ye,!0);s(ye),s(se);var ue=d(se,2);ee(ue,1,"flex place-items-center justify-between w-full py-2 sm:py-4 pe-4 ps-6 flex-row-reverse rounded-b-lg bg-gray-200 text-immich-dark-bg dark:bg-gray-700 dark:text-immich-gray sm:rounded-s-none sm:rounded-e-lg");var ve=n(ue),Be=n(ve,!0);s(ve);var Ce=d(ve,2),Ie=n(Ce,!0);s(Ce),s(ue),s(be),s(V),s(z);var ke=d(z,2),we=n(ke);{var Ge=r=>{H(r,{disabled:!0,color:"light-gray",onClick:()=>t.onCommand({command:A.Start,force:!1}),children:(i,_)=>{var l=Aa(),c=S(l);I(c,{get icon(){return ua},size:"36"});var p=d(c,2),M=n(p,!0);s(p),y(o=>b(M,o),[()=>e()("disabled")]),m(i,l)},$$slots:{default:!0}})};$(we,r=>{h()&&r(Ge)})}var $e=d(we,2);{var Je=r=>{var i=Ja(),_=S(i);{var l=o=>{H(o,{color:"gray",onClick:()=>t.onCommand({command:A.Empty,force:!1}),children:(L,N)=>{var q=Ba(),k=S(q);I(k,{get icon(){return Qe},size:"24"});var w=d(k,2),E=n(w,!0);s(w),y(Y=>b(E,Y),[()=>e()("clear")]),m(L,q)},$$slots:{default:!0}})};$(_,o=>{a(Q)>0&&o(l)})}var c=d(_,2);{var p=o=>{const L=u(()=>a(Q)>0?"24":"48");H(o,{color:"light-gray",onClick:()=>t.onCommand({command:A.Resume,force:!1}),children:(N,q)=>{var k=Ia(),w=S(k);I(w,{get icon(){return fa},get size(){return a(L)}});var E=d(w,2),Y=n(E,!0);s(E),y(Ve=>b(Y,Ve),[()=>e()("resume")]),m(N,k)},$$slots:{default:!0}})},M=o=>{H(o,{color:"light-gray",onClick:()=>t.onCommand({command:A.Pause,force:!1}),children:(L,N)=>{var q=Ga(),k=S(q);I(k,{get icon(){return _a},size:"24"});var w=d(k,2),E=n(w,!0);s(w),y(Y=>b(E,Y),[()=>e()("pause")]),m(L,q)},$$slots:{default:!0}})};$(c,o=>{t.queue.isPaused?o(p):o(M,!1)})}m(r,i)};$($e,r=>{!h()&&!a(F)&&r(Je)})}var Te=d($e,2);{var Ne=r=>{var i=Va(),_=S(i);{var l=o=>{H(o,{color:"dark-gray",onClick:()=>t.onCommand({command:A.Start,force:!0}),children:(L,N)=>{var q=Na(),k=S(q);I(k,{get icon(){return pa},size:"24"});var w=d(k,2),E=n(w,!0);s(w),y(()=>b(E,t.allText)),m(L,q)},$$slots:{default:!0}})};$(_,o=>{t.allText&&o(l)})}var c=d(_,2);{var p=o=>{H(o,{color:"gray",onClick:()=>t.onCommand({command:A.Start,force:void 0}),children:(L,N)=>{var q=Ha(),k=S(q);I(k,{get icon(){return xa},size:"24"});var w=d(k,2),E=n(w,!0);s(w),y(()=>b(E,t.refreshText)),m(L,q)},$$slots:{default:!0}})};$(c,o=>{t.refreshText&&o(p)})}var M=d(c,2);H(M,{color:"light-gray",onClick:()=>t.onCommand({command:A.Start,force:!1}),children:(o,L)=>{var N=Ua(),q=S(N);I(q,{get icon(){return va},size:"24"});var k=d(q,2),w=n(k,!0);s(k),y(()=>b(w,t.missingText)),m(o,N)},$$slots:{default:!0}}),m(r,i)};$(Te,r=>{!h()&&a(U)&&a(F)&&r(Ne)})}var He=d(Te,2);{var Ue=r=>{H(r,{color:"light-gray",onClick:()=>t.onCommand({command:A.Start,force:!1}),children:(i,_)=>{var l=Ka(),c=S(l);I(c,{get icon(){return ga},size:"48"});var p=d(c,2),M=n(p,!0);s(p),y(()=>b(M,t.missingText)),m(i,l)},$$slots:{default:!0}})};$(He,r=>{!h()&&!a(U)&&a(F)&&r(Ue)})}s(ke),s(G),y((r,i,_,l)=>{b(Ee,r),b(Ae,i),b(Be,_),b(Ie,l)},[()=>e()("active"),()=>a(v).active.toLocaleString(g()),()=>a(Q).toLocaleString(g()),()=>e()("waiting")]),m(T,G),de(),x()}var Ya=f('<a class="text-primary"> </a>');function Za(T,t){le(t,!1);const e=()=>Z(ie,"$t",g),[g,P]=ce();wa();{const x=(D,O)=>{let R=()=>O?.().message;var C=Ya(),v=n(C,!0);s(C),y(Q=>{ha(C,"href",Q),b(v,R())},[()=>ge.systemSettings({isOpen:$a.STORAGE_TEMPLATE})]),m(D,C)};let h=aa(()=>({template:e()("admin.storage_template_settings")}));Ta(T,{key:"admin.storage_template_migration_description",get values(){return a(h)},children:x,$$slots:{default:!0}})}de(),P()}var et=f('<div class="flex flex-col gap-7 mt-10"></div>');function at(T,t){le(t,!0);const e=()=>Z(ie,"$t",g),[g,P]=ce(),x=Pa.value,h={[j.ThumbnailGeneration]:{allText:e()("all"),missingText:e()("missing")},[j.MetadataExtraction]:{allText:e()("all"),missingText:e()("missing")},[j.Library]:{missingText:e()("rescan")},[j.Sidecar]:{allText:e()("sync"),missingText:e()("discover"),disabled:!x.sidecar},[j.SmartSearch]:{allText:e()("all"),missingText:e()("missing"),disabled:!x.smartSearch},[j.DuplicateDetection]:{allText:e()("all"),missingText:e()("missing"),disabled:!x.duplicateDetection},[j.FaceDetection]:{allText:e()("reset"),refreshText:e()("refresh"),missingText:e()("missing"),disabled:!x.facialRecognition},[j.FacialRecognition]:{allText:e()("reset"),missingText:e()("missing"),disabled:!x.facialRecognition},[j.Ocr]:{allText:e()("all"),missingText:e()("missing"),disabled:!x.ocr},[j.VideoConversion]:{allText:e()("all"),missingText:e()("missing")},[j.StorageTemplateMigration]:{missingText:e()("start"),description:Za},[j.Migration]:{missingText:e()("start")}};let D=Object.entries(h);const O=async(C,v)=>{const Q=Fe(e(),{name:C});switch(C){case j.FaceDetection:case j.FacialRecognition:if(v.force){if(!await qa.showDialog({prompt:e()("admin.confirm_reprocess_all_faces")}))return;break}}try{await Ye({name:C,queueCommandDto:v}),await oe.refresh(),v.command===A.Empty&&da.success(e()("admin.cleared_jobs",{values:{job:Q.title}}))}catch(F){ca(F,e()("admin.failed_job_command",{values:{command:v.command,job:Q.title}}))}};var R=et();la(R,21,()=>D,([C,v])=>C,(C,v)=>{var Q=u(()=>ta(a(v),2));let F=()=>a(Q)[0],U=()=>a(Q)[1];const G=u(()=>t.queues.find(({name:J})=>J===F()));var z=_e(),B=S(z);{var W=J=>{Xa(J,oa({get queue(){return a(G)},onCommand:V=>O(F(),V)},U))};$(B,J=>{a(G)&&J(W)})}m(C,z)}),s(R),m(T,R),de(),P()}var tt=f("<!> <!> <!>",1);function Qt(T,t){le(t,!0);const e=()=>Z(ie,"$t",g),[g,P]=ce();ea(()=>oe.listen());let x=u(()=>oe.queues);const h=u(()=>ba(e(),oe.queues)),D=u(()=>a(h).ResumePaused),O=u(()=>a(h).CreateJob),R=u(()=>a(h).ManageConcurrency),C=u(()=>[a(O),a(R)]),v=z=>{ra(x,a(x).map(B=>B.name===z.name?z:B))};var Q=tt(),F=S(Q);{let z=u(()=>e()("admin.queues"));Sa(F,{get name(){return a(z)},get actions(){return a(C)}})}var U=d(F,2);ia(U,{onQueueUpdate:v});var G=d(U,2);{let z=u(()=>[{title:t.data.meta.title}]),B=u(()=>[a(D),a(O),a(R)]);na(G,{get breadcrumbs(){return a(z)},get actions(){return a(B)},children:(W,J)=>{Qa(W,{size:"medium",center:!0,children:(V,ae)=>{var X=_e(),te=S(X);{var re=K=>{at(K,{get queues(){return a(x)}})};$(te,K=>{a(x)&&K(re)})}m(V,X)},$$slots:{default:!0}})},$$slots:{default:!0}})}m(T,Q),de(),P()}export{Qt as component,St as universal};
