const u="1769922625246",i=`cache-${u}`;let r;const l=async()=>r||(r=await caches.open(i),r),f=async t=>{const e=await l();if(e)return e.match(t)},w=async(t,e)=>{if(e.status!==200)return;const n=await l();n&&n.put(t,e.clone())},p=async()=>{for(const t of await caches.keys())t!==i&&await caches.delete(t)},c=new Map,g=t=>t.href!==void 0,y=t=>t.url!==void 0,R=t=>{if(!(t instanceof Response))throw new TypeError("Fetch did not return a valid Response object")},h=t=>{if(g(t))return t.toString();if(y(t))return t.url;throw new Error(`Invalid request: ${t}`)},E=async t=>{try{return await d(t)}catch(e){console.error(`Preload failed: ${e}`)}},d=async t=>{const e=h(t),n=await f(e);if(n)return n;try{const a=new AbortController;c.set(e,a);const o=await fetch(t,{signal:a.signal});return R(o),w(e,o),o}catch(a){if(a.name==="AbortError")return new Response(void 0,{status:204});throw console.log("Not an abort error",a),a}finally{c.delete(e)}},b=t=>{const e=h(t),n=c.get(e);n&&(n.abort(),c.delete(e))},m=()=>{const t=new BroadcastChannel("immich");t.onmessage=e=>{if(!e.data)return;const n=new URL(e.data.url,e.origin);switch(e.data.type){case"preload":{E(n);break}case"cancel":{b(n);break}}}},C=/^\/api\/assets\/[a-f0-9-]+\/(original|thumbnail)/,s=globalThis,v=t=>{t.waitUntil(s.clients.claim()),t.waitUntil(p())},L=t=>{t.waitUntil(s.skipWaiting())},U=t=>{if(t.request.method!=="GET")return;const e=new URL(t.request.url);if(e.origin===self.location.origin&&C.test(e.pathname)){t.respondWith(d(t.request));return}};s.addEventListener("install",L,{passive:!0});s.addEventListener("activate",v,{passive:!0});s.addEventListener("fetch",U,{passive:!0});m();
